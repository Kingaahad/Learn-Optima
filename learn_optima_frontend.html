<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Optima - Professional Tutoring Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --secondary-color: #8b5cf6;
            --accent-color: #06b6d4;
            --info-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--gray-800);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Global Components */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.95rem;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--primary-dark), #7c3aed);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--gray-700);
            border: 2px solid var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: var(--white);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--white);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: var(--white);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: var(--white);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-info {
            background: linear-gradient(135deg, var(--info-color), #0891b2);
            color: var(--white);
            box-shadow: var(--shadow);
        }
        
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, #0891b2, #0e7490);
        }

        .btn-sm {
            padding: 0.5rem 1.25rem;
            font-size: 0.85rem;
        }

        .btn-lg {
            padding: 1.25rem 3rem;
            font-size: 1.1rem;
            border-radius: 1rem;
        }

        .btn-xl {
            padding: 1.5rem 4rem;
            font-size: 1.25rem;
            border-radius: 1.25rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Header & Navigation */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }

        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-color);
            text-decoration: none;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.2rem;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-link {
            color: var(--gray-600);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            border-radius: 0.75rem;
            box-shadow: var(--shadow-xl);
            min-width: 200px;
            padding: 0.75rem 0;
            margin-top: 0.5rem;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .user-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.25rem;
            color: var(--gray-700);
            text-decoration: none;
            transition: background 0.2s ease;
        }

        .dropdown-item:hover {
            background: var(--gray-50);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--white);
            padding: 6rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 107, 0.3) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--white), rgba(255, 255, 255, 0.8));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.1;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 3rem;
            opacity: 0.9;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-actions {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 4rem;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 4rem;
            margin-top: 4rem;
            flex-wrap: wrap;
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            display: block;
        }

        .hero-stat-label {
            font-size: 0.95rem;
            opacity: 0.8;
        }

        /* Features Section */
        .features {
            padding: 6rem 0;
            background: var(--gray-50);
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 1rem;
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--gray-600);
            max-width: 600px;
            margin: 0 auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
        }

        .feature-card {
            background: var(--white);
            border-radius: 1.5rem;
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--gray-200);
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 2rem;
            color: var(--white);
        }

        .feature-card h3 {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--gray-900);
        }

        .feature-card p {
            color: var(--gray-600);
            line-height: 1.7;
        }

        /* How It Works Section */
        .how-it-works {
            padding: 6rem 0;
            background: var(--white);
        }

        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-top: 4rem;
        }

        .step-card {
            text-align: center;
            position: relative;
        }

        .step-number {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 auto 1.5rem;
        }

        .step-card h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--gray-900);
        }

        .step-card p {
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* Testimonials Section */
        .testimonials {
            padding: 6rem 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-top: 4rem;
        }

        .testimonial-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1.5rem;
            padding: 2.5rem;
            text-align: center;
        }

        .testimonial-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0 auto 1.5rem;
        }

        .testimonial-text {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
            font-style: italic;
        }

        .testimonial-author {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .testimonial-role {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* CTA Section */
        .cta {
            padding: 6rem 0;
            background: var(--gray-900);
            color: var(--white);
            text-align: center;
        }

        .cta h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .cta p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Footer */
        .footer {
            background: var(--gray-900);
            color: var(--white);
            padding: 4rem 0 2rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-section h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.75rem;
        }

        .footer-links a {
            color: var(--gray-400);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: var(--white);
        }

        .footer-bottom {
            border-top: 1px solid var(--gray-800);
            padding-top: 2rem;
            text-align: center;
            color: var(--gray-400);
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .social-link {
            width: 50px;
            height: 50px;
            background: var(--gray-800);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-400);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .social-link:hover {
            background: var(--primary-color);
            color: var(--white);
            transform: translateY(-3px);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.875rem 1.25rem;
            border: 2px solid var(--gray-300);
            border-radius: 0.75rem;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .card {
            background: var(--white);
            border-radius: 1.25rem;
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .card-header {
            padding: 2rem;
            border-bottom: 1px solid var(--gray-200);
            background: var(--gray-50);
        }

        .card-body {
            padding: 2rem;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1.5rem;
            }

            .nav-menu {
                gap: 1.5rem;
                flex-wrap: wrap;
                justify-content: center;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero-actions {
                flex-direction: column;
                align-items: center;
            }

            .hero-stats {
            gap: 2rem;
            }

            .features-grid,
            .steps-grid,
            .testimonials-grid {
                grid-template-columns: 1fr;
            }

            .btn-lg {
                padding: 1rem 2rem;
                font-size: 1rem;
            }

            .btn-xl {
                padding: 1.25rem 2.5rem;
                font-size: 1.1rem;
            }
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* Page Transitions */
        .page {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Message Styles */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: var(--white);
            font-weight: 500;
            z-index: 3000;
            max-width: 400px;
            animation: slideInRight 0.3s ease-out;
        }

        .message.success {
            background: var(--success-color);
        }

        .message.error {
            background: var(--error-color);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 1.5rem;
            box-shadow: var(--shadow-xl);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-400);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .modal-body {
            padding: 2rem;
        }
        
        /* Additional Styles for New Pages */
        .btn-full {
            width: 100%;
        }
        
        /* Auth Pages */
        .auth-container {
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
        }
        
        .auth-card {
            background: var(--white);
            border-radius: 1rem;
            box-shadow: var(--shadow-xl);
            padding: 2.5rem;
            width: 100%;
            max-width: 400px;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .auth-header h2 {
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .auth-header p {
            color: var(--gray-600);
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-group label {
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .form-group input,
        .form-group select {
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-200);
        }
        
        .auth-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        
        .auth-footer a:hover {
            text-decoration: underline;
        }
        
        /* Dashboard */
        .dashboard-header {
            margin-bottom: 2rem;
        }
        
        .dashboard-header h2 {
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .dashboard-header p {
            color: var(--gray-600);
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            color: var(--gray-600);
            font-weight: 500;
        }

        .dashboard-insights {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
        }
        
        .dashboard-insights h3 {
            color: var(--gray-900);
            margin-bottom: 1rem;
        }
        
        .insight-card {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: 0.5rem;
        }
        
        .insight-card p {
            margin-bottom: 0.5rem;
            color: var(--gray-700);
        }
        
        /* Sessions */
        .sessions-header {
            margin-bottom: 2rem;
        }

        .sessions-header h2 {
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .sessions-header p {
            color: var(--gray-600);
        }
        
        .session-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-info h3 {
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .session-info p {
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }
        
        .session-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Message Container */
        .message-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }
        
        .message {
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease-out;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Tutors Page */
        .tutors-header {
            margin-bottom: 2rem;
        }
        
        .tutors-header h2 {
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .tutors-header p {
            color: var(--gray-600);
        }
        
        .tutor-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .tutor-avatar {
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .tutor-info {
            flex: 1;
        }
        
        .tutor-info h3 {
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .tutor-subjects {
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }
        
        .tutor-rating {
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }
        
        .tutor-region {
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }
        
        .tutor-rate {
            color: var(--gray-600);
            font-weight: 500;
        }

        /* Enhanced Tutor Selection Styles */
        .tutors-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 1.5rem;
            color: white;
        }

        .header-content h2 {
            font-size: 2rem;
            font-weight: 800;
            margin: 0 0 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-content p {
            font-size: 1.125rem;
            opacity: 0.9;
            margin: 0;
        }

        .header-actions {
            margin-top: 0.5rem;
        }

        .search-filters-section {
            background: var(--white);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
        }

        .search-bar {
            margin-bottom: 2rem;
        }

        .search-input-group {
            position: relative;
            display: flex;
            align-items: center;
            background: var(--gray-50);
            border-radius: 1rem;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        .search-input-group:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-input-group i {
            color: var(--gray-500);
            margin-right: 0.75rem;
            font-size: 1.125rem;
        }

        .search-input-group input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 1rem;
            outline: none;
            color: var(--gray-900);
        }

        .search-input-group input::placeholder {
            color: var(--gray-500);
        }

        .search-input-group button {
            margin-left: 0.75rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
        }

        .filters-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.875rem;
        }

        .filter-group select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.75rem;
            background: var(--white);
            font-size: 0.875rem;
            color: var(--gray-900);
            transition: all 0.3s ease;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .filter-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .results-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 1.5rem;
            background: var(--gray-50);
            border-radius: 1rem;
            border: 1px solid var(--gray-200);
        }

        .summary-stats {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--gray-700);
            font-weight: 500;
        }

        .summary-stats span:first-child {
            font-weight: 700;
            color: var(--primary-color);
        }

        .separator {
            color: var(--gray-400);
        }

        .view-options {
            display: flex;
            gap: 0.5rem;
        }

        .view-toggle {
            width: 40px;
            height: 40px;
            border: 2px solid var(--gray-200);
            background: var(--white);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--gray-600);
        }

        .view-toggle:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .view-toggle.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .tutors-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .tutors-content.list-view {
            grid-template-columns: 1fr;
        }

        .tutor-card-enhanced {
            background: var(--white);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tutor-card-enhanced:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }

        .tutor-card-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .tutor-header-enhanced {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .tutor-avatar-enhanced {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 1.5rem;
            position: relative;
        }

        .tutor-avatar-enhanced::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 20px;
            height: 20px;
            background: var(--success-color);
            border: 3px solid var(--white);
            border-radius: 50%;
        }

        .tutor-info-enhanced {
            flex: 1;
        }

        .tutor-info-enhanced h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 0 0.5rem 0;
            color: var(--gray-900);
        }

        .tutor-rating-enhanced {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .stars {
            display: flex;
            gap: 0.125rem;
        }

        .star {
            color: var(--warning-color);
            font-size: 1rem;
        }

        .rating-text {
            font-weight: 600;
            color: var(--gray-700);
        }

        .tutor-subjects-enhanced {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .subject-tag {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .tutor-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 1rem;
        }

        .stat-item-enhanced {
            text-align: center;
        }

        .stat-number-enhanced {
            display: block;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label-enhanced {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-top: 0.25rem;
        }

            .tutor-bio {
                color: var(--gray-700);
                font-size: 0.875rem;
                line-height: 1.6;
                margin-bottom: 1.5rem;
                display: -webkit-box;
                -webkit-line-clamp: 3;
                line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

        .tutor-actions-enhanced {
            display: flex;
            gap: 1rem;
        }

        .btn-book {
            flex: 1;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-book:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-profile {
            background: var(--white);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-profile:hover {
            background: var(--primary-color);
            color: white;
        }

        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem;
            color: var(--gray-500);
            gap: 1rem;
        }

        .loading-state i {
            font-size: 3rem;
            color: var(--primary-color);
        }

        .loading-state p {
            font-size: 1.125rem;
            margin: 0;
        }

        .load-more-section {
            text-align: center;
            margin-top: 2rem;
        }

        /* List View Styles */
        .tutors-content.list-view .tutor-card-enhanced {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .tutors-content.list-view .tutor-header-enhanced {
            margin-bottom: 0;
            flex: 1;
        }

        .tutors-content.list-view .tutor-stats {
            margin-bottom: 0;
            width: 200px;
        }

        .tutors-content.list-view .tutor-bio {
            display: none;
        }

        .tutors-content.list-view .tutor-actions-enhanced {
            width: 200px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tutors-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .filters-row {
                grid-template-columns: 1fr;
            }

            .filter-actions {
                justify-content: center;
            }

            .results-summary {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .tutors-content {
                grid-template-columns: 1fr;
            }

            .tutor-card-enhanced {
                padding: 1.5rem;
            }

            .tutor-header-enhanced {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .tutor-stats {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .tutor-actions-enhanced {
                flex-direction: column;
            }
        }
        
        /* Profile Pages */
        .profile-header, .profile-setup-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .profile-header h2, .profile-setup-header h2 {
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .profile-header p, .profile-setup-header p {
            color: var(--gray-600);
        }
        
        .profile-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }
        
        /* Enhanced Profile Setup Styles */
        .profile-setup-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
        }
        
        .setup-header-content {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .setup-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3);
        }
        
        .profile-setup-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .setup-card {
            background: var(--white);
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 1px solid var(--gray-200);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .setup-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }
        
        .setup-card.learner-card {
            border-top: 4px solid #10B981;
        }
        
        .setup-card.tutor-card {
            border-top: 4px solid #F59E0B;
        }
        
        .setup-card.parent-card {
            border-top: 4px solid #8B5CF6;
        }
        
        .card-header {
            padding: 2rem;
            background: linear-gradient(135deg, var(--gray-50), var(--white));
            border-bottom: 1px solid var(--gray-200);
            text-align: center;
        }
        
        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
        }
        
        .learner-icon {
            background: linear-gradient(135deg, #10B981, #059669);
        }
        
        .tutor-icon {
            background: linear-gradient(135deg, #F59E0B, #D97706);
        }
        
        .parent-icon {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
        }
        
        .card-header h3 {
            color: var(--gray-900);
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .card-header p {
            color: var(--gray-600);
            font-size: 0.95rem;
        }
        
        .card-body {
            padding: 2rem;
        }
        
        .setup-form .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .form-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            color: var(--gray-700);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .form-label svg {
            color: var(--primary-color);
            flex-shrink: 0;
        }
        
        .setup-form input, .setup-form select, .setup-form textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.75rem;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: var(--white);
        }
        
        .setup-form input:focus, .setup-form select:focus, .setup-form textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            transform: translateY(-1px);
        }
        
        .setup-form textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .btn-large {
            width: 100%;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            border-radius: 0.75rem;
            transition: all 0.3s ease;
        }
        
        .btn-large:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }
        
        .btn-large svg {
            width: 20px;
            height: 20px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .profile-setup-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }
            
            .card-header, .card-body {
                padding: 1.5rem;
            }
            
            .setup-icon {
                width: 60px;
                height: 60px;
            }
        }
        
        /* Enhanced Dashboard Styles */
        .dashboard-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 1rem;
            color: white;
        }
        
        .dashboard-header h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-card.primary {
            border-left: 4px solid var(--primary-color);
        }
        
        .stat-card.success {
            border-left: 4px solid var(--success-color);
        }
        
        .stat-card.warning {
            border-left: 4px solid var(--warning-color);
        }
        
        .stat-card.info {
            border-left: 4px solid var(--info-color);
        }
        
        .stat-icon {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--gray-100);
        }
        
        .stat-content h3 {
            color: var(--gray-700);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }
        
        .stat-change {
            font-size: 0.8rem;
            color: var(--gray-600);
        }
        
        .dashboard-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .progress-section, .ai-insights {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
        }
        
        .progress-container {
            margin: 1rem 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .milestone-info {
            text-align: center;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        .insight-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
        }

        .insight-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--white);
            border-radius: 50%;
        }
        
        .insight-content h4 {
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }
        
        .insight-content p {
            color: var(--gray-600);
            font-size: 0.9rem;
        }
        
        /* Enhanced Session Styles */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray-500);
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .empty-state h3 {
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }
        
        .session-card {
            background: var(--white);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
            transition: all 0.3s ease;
        }
        
        .session-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .session-card.overdue {
            border-left: 4px solid var(--error-color);
            background: #fef2f2;
        }
        
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .session-subject h3 {
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }
        
        .session-duration {
            color: var(--gray-600);
            font-size: 0.9rem;
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-scheduled {
            background: var(--gray-100);
            color: var(--gray-700);
        }
        
        .status-soon {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-overdue {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-in_progress {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-cancelled {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .session-details {
            margin-bottom: 1rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-100);
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            color: var(--gray-600);
            font-size: 0.9rem;
        }
        
        .detail-value {
            color: var(--gray-900);
            font-weight: 500;
        }
        
        .session-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .session-actions .btn {
            flex: 1;
            min-width: 120px;
        }
        
        .tutor-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .status-scheduled {
            color: var(--warning-color);
            font-weight: 500;
        }
        
        .status-completed {
            color: var(--success-color);
            font-weight: 500;
        }
        
        .status-in_progress {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        /* Tutors */
        .tutor-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .tutor-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .tutor-info {
            flex: 1;
        }
        
        .tutor-info h3 {
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .tutor-info p {
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }
        
        .tutor-subjects {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .tutor-rating {
            color: var(--warning-color);
        }
        
        .tutor-region {
            color: var(--gray-500);
        }
        
        .tutor-rate {
            color: var(--success-color);
            font-weight: 500;
        }
        
        .tutor-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .mini-action { display:inline-flex;align-items:center;gap:.5rem;padding:.5rem .75rem;border:1px solid var(--gray-200);border-radius:.5rem;background:#fff;cursor:pointer }
        .mini-action:hover { border-color: var(--secondary-color); color: var(--secondary-color) }
        .spark { width:100%; height:60px }
    </style>
    <style id="brand-overrides">
        :root {
            --primary-color: #ff6a00;
            --primary-dark: #e85f00;
            --secondary-color: #00a0e4;
            --accent-color: #00a0e4;
            --info-color: #00a0e4;
        }
        .logo-icon {
            background: transparent !important;
            border-radius: 12px;
            background-image: url('/static/logo.png');
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
        }
        /* Force key gradients to use only the two brand colors */
        .feature-icon, .step-number, .testimonials, .btn-primary, .btn-success, .btn-warning, .btn-info {
            background-image: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
        }
        .hero {
            background: linear-gradient(135deg, rgba(255,106,0,0.95), rgba(0,160,228,0.95));
            color: var(--white);
        }
        .hero::before { display: none !important; }
        .badge, .nav-link:hover, .nav-link.active {
            background: rgba(0,160,228,0.12) !important;
            color: var(--secondary-color) !important;
        }
        a, .link { color: var(--secondary-color); }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
            <a href="#" class="logo" onclick="showHome()">
                <img src="static/logo.png" alt="LearnOptima Logo" style="width:45px;height:45px;border-radius:12px;object-fit:contain"/>
                <span>Learn Optima</span>
                </a>
                
                <ul class="nav-menu" id="navMenu">
                    <li><a href="#" class="nav-link active" onclick="showHome()">Home</a></li>
                    <li><a href="#" class="nav-link" onclick="showAbout()">About</a></li>
                    <li><a href="#" class="nav-link" onclick="showTutors()">Find Tutors</a></li>
                    <li><a href="#" class="nav-link" onclick="showPricing()">Pricing</a></li>
                    <li><a href="#" class="nav-link" onclick="showContact()">Contact</a></li>
                </ul>

                <div class="user-menu hidden" id="userMenu">
                    <div class="user-avatar" onclick="toggleUserMenu()">
                        <span id="userInitials">?</span>
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <a href="#" class="dropdown-item" onclick="showDashboard()">
                            <i class="fas fa-tachometer-alt"></i>
                            Dashboard
                        </a>
                        <a href="#" class="dropdown-item" onclick="showProfile()">
                            <i class="fas fa-user"></i>
                            Profile
                        </a>
                        <a href="#" class="dropdown-item" onclick="showSessions()">
                            <i class="fas fa-calendar"></i>
                            My Sessions
                        </a>
                        <a href="#" class="dropdown-item" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </a>
                    </div>
            </div>
            
                <div class="auth-buttons" id="authButtons">
                    <button class="btn btn-secondary btn-sm" onclick="showLogin()">
                        <i class="fas fa-sign-in-alt"></i>
                        Login
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="showRegister()">
                        <i class="fas fa-user-plus"></i>
                        Sign Up
                    </button>
            </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Home Page -->
        <div id="homePage" class="page">
    <!-- Hero Section -->
            <section class="hero">
                <div class="container">
        <div class="hero-content">
            <h1>Transform Learning with AI-Powered Tutoring</h1>
                        <p>Connect with expert tutors, personalized to your cultural background and learning style. Experience education that understands and adapts to you.</p>
                        <div class="hero-actions">
                            <button class="btn btn-primary btn-xl" onclick="showRegister()">
                    <i class="fas fa-rocket"></i>
                    Start Learning Today
                </button>
                            <button class="btn btn-outline btn-xl" onclick="showTutors()">
                                <i class="fas fa-search"></i>
                                Explore Tutors
                </button>
                        </div>
                        <div class="hero-stats">
                            <div class="hero-stat">
                                <span class="hero-stat-number">10,000+</span>
                                <span class="hero-stat-label">Happy Students</span>
                            </div>
                            <div class="hero-stat">
                                <span class="hero-stat-number">500+</span>
                                <span class="hero-stat-label">Expert Tutors</span>
                            </div>
                            <div class="hero-stat">
                                <span class="hero-stat-number">98%</span>
                                <span class="hero-stat-label">Success Rate</span>
                            </div>
                        </div>
            </div>
        </div>
    </section>

            <!-- Features Section -->
            <section class="features">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title">Why Choose Learn Optima?</h2>
                        <p class="section-subtitle">Discover the power of personalized learning with our advanced AI-driven tutoring platform</p>
                    </div>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <h3>AI-Powered Matching</h3>
                            <p>Our intelligent algorithm matches you with tutors based on your learning style, cultural preferences, and academic needs for optimal learning outcomes.</p>
        </div>
        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-globe-africa"></i>
                            </div>
                            <h3>Cultural Intelligence</h3>
                            <p>Learn from tutors who understand your cultural context and can provide education that resonates with your background and values.</p>
            </div>
            
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>Progress Tracking</h3>
                            <p>Monitor your learning journey with detailed analytics, personalized feedback, and recommendations for continuous improvement.</p>
            </div>
            
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <h3>Flexible Scheduling</h3>
                            <p>Book sessions that fit your schedule with 24/7 availability and easy rescheduling options for maximum convenience.</p>
                        </div>

                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3>Safe & Secure</h3>
                            <p>All tutors are verified professionals with background checks. Your privacy and safety are our top priorities.</p>
        </div>
        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-award"></i>
                            </div>
                            <h3>Quality Guarantee</h3>
                            <p>Not satisfied with your session? Get a full refund or try another tutor. We guarantee your learning success.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- How It Works Section -->
            <section class="how-it-works">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title">How It Works</h2>
                        <p class="section-subtitle">Get started with Learn Optima in just three simple steps</p>
    </div>
                    <div class="steps-grid">
                        <div class="step-card">
                            <div class="step-number">1</div>
                            <h3>Create Your Profile</h3>
                            <p>Tell us about your learning goals, preferences, and background so we can find the perfect tutor match for you.</p>
                        </div>
                        <div class="step-card">
                            <div class="step-number">2</div>
                            <h3>Find Your Tutor</h3>
                            <p>Browse our AI-recommended tutors or search by subject, language, or cultural background to find your ideal match.</p>
                        </div>
                        <div class="step-card">
                            <div class="step-number">3</div>
                            <h3>Start Learning</h3>
                            <p>Schedule your first session, meet your tutor, and begin your personalized learning journey with ongoing support.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Testimonials Section -->
            <section class="testimonials">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title" style="color: white;">What Our Students Say</h2>
                        <p class="section-subtitle" style="color: rgba(255,255,255,0.8);">Real stories from students who transformed their learning with Learn Optima</p>
        </div>
                    <div class="testimonials-grid">
                        <div class="testimonial-card">
                            <div class="testimonial-avatar">AM</div>
                            <p class="testimonial-text">"Learn Optima found me the perfect tutor who understood my cultural background. My math grades improved from C to A in just 3 months!"</p>
                            <div class="testimonial-author">Amina Mohammed</div>
                            <div class="testimonial-role">Grade 10 Student, Nigeria</div>
                        </div>
                        <div class="testimonial-card">
                            <div class="testimonial-avatar">JD</div>
                            <p class="testimonial-text">"As a tutor, this platform has connected me with amazing students. The AI matching really works - every session feels perfectly aligned."</p>
                            <div class="testimonial-author">John Doe</div>
                            <div class="testimonial-role">Mathematics Tutor, South Africa</div>
                        </div>
                        <div class="testimonial-card">
                            <div class="testimonial-avatar">SK</div>
                            <p class="testimonial-text">"The flexibility and quality of tutoring here is unmatched. I can learn at my own pace with tutors who truly understand my needs."</p>
                            <div class="testimonial-author">Sarah Kofi</div>
                            <div class="testimonial-role">University Student, Ghana</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Call to Action Section -->
            <section class="cta">
                <div class="container">
                    <h2>Ready to Transform Your Learning?</h2>
                    <p>Join thousands of students who have already discovered the power of personalized, culturally-aware education with Learn Optima.</p>
                    <div class="hero-actions">
                        <button class="btn btn-primary btn-xl" onclick="showRegister()">
                            <i class="fas fa-graduation-cap"></i>
                            Start Your Journey
                        </button>
                        <button class="btn btn-outline btn-xl" onclick="showContact()">
                            <i class="fas fa-phone"></i>
                            Talk to Us
                        </button>
                    </div>
                </div>
            </section>
            </div>
            
        <!-- About Page -->
        <div id="aboutPage" class="page hidden" style="padding: 4rem 0; background: var(--gray-50);">
            <div class="container">
                <div class="section-header">
                    <h1 class="section-title">About Learn Optima</h1>
                    <p class="section-subtitle">Revolutionizing education through AI-powered, culturally-aware tutoring</p>
            </div>
            
                <div class="card" style="margin-bottom: 3rem;">
                    <div class="card-body">
                        <h2 style="margin-bottom: 1.5rem;">Our Mission</h2>
                        <p style="font-size: 1.1rem; line-height: 1.8; color: var(--gray-700);">
                            At Learn Optima, we believe that every student deserves access to personalized, high-quality education that respects and incorporates their cultural background. Our mission is to bridge the gap between traditional tutoring and modern AI technology, creating an inclusive learning environment where students from all backgrounds can thrive.
                        </p>
                    </div>
            </div>
            
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Diverse Community</h3>
                        <p>Our platform brings together students and tutors from over 50 countries, creating a rich, multicultural learning environment.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <h3>Certified Tutors</h3>
                        <p>All our tutors undergo rigorous verification and training to ensure they meet our high standards for quality education.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3>Student-Centered</h3>
                        <p>Every decision we make is focused on improving student outcomes and creating positive learning experiences.</p>
                    </div>
                </div>
            </div>
            </div>
            
        <!-- Pricing Page -->
        <div id="pricingPage" class="page hidden" style="padding: 4rem 0; background: var(--gray-50);">
            <div class="container">
                <div class="section-header">
                    <h1 class="section-title">Simple, Transparent Pricing</h1>
                    <p class="section-subtitle">Choose the plan that works best for your learning needs</p>
                </div>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <h3>Pay Per Session</h3>
                        <p style="margin-bottom: 2rem;">Perfect for occasional tutoring needs</p>
                        <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color); margin-bottom: 1rem;">$25-50</div>
                        <p style="color: var(--gray-600); margin-bottom: 2rem;">per hour</p>
                        <button class="btn btn-primary" onclick="showRegister()">Get Started</button>
        </div>
        
                    <div class="feature-card" style="border: 2px solid var(--primary-color); transform: scale(1.05);">
                        <div class="feature-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <h3>Monthly Plan</h3>
                        <p style="margin-bottom: 2rem;">Most popular choice for regular learners</p>
                        <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color); margin-bottom: 1rem;">$199</div>
                        <p style="color: var(--gray-600); margin-bottom: 2rem;">8 sessions included</p>
                        <button class="btn btn-primary" onclick="showRegister()">Start Free Trial</button>
    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <h3>Premium Plan</h3>
                        <p style="margin-bottom: 2rem;">Unlimited access for serious learners</p>
                        <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color); margin-bottom: 1rem;">$399</div>
                        <p style="color: var(--gray-600); margin-bottom: 2rem;">Unlimited sessions</p>
                        <button class="btn btn-primary" onclick="showRegister()">Go Premium</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Page -->
        <div id="contactPage" class="page hidden" style="padding: 4rem 0; background: var(--gray-50);">
            <div class="container">
                <div class="section-header">
                    <h1 class="section-title">Get In Touch</h1>
                    <p class="section-subtitle">Have questions? We'd love to hear from you</p>
        </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 3rem;">
                    <div class="card">
                    <div class="card-header">
                            <h3 class="card-title">Send us a Message</h3>
                        </div>
                        <div class="card-body">
                            <form id="contactForm">
                                <div class="form-group">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-input" name="name" required>
                        </div>
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-input" name="email" required>
                    </div>
                                <div class="form-group">
                                    <label class="form-label">Subject</label>
                                    <input type="text" class="form-input" name="subject" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Message</label>
                                    <textarea class="form-textarea" name="message" required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary" style="width: 100%;">
                                    <i class="fas fa-paper-plane"></i>
                                    Send Message
                                </button>
                            </form>
                        </div>
                </div>

                    <div>
                        <div class="card" style="margin-bottom: 2rem;">
                            <div class="card-body">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="width: 50px; height: 50px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                        <i class="fas fa-envelope"></i>
                        </div>
                        <div>
                                        <h4>Email Us</h4>
                                        <p style="color: var(--gray-600); margin: 0;">support@auraai.com</p>
                        </div>
                    </div>
                            </div>
                </div>

                        <div class="card" style="margin-bottom: 2rem;">
                            <div class="card-body">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="width: 50px; height: 50px; background: var(--success-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                        <i class="fas fa-phone"></i>
                        </div>
                        <div>
                                        <h4>Call Us</h4>
                                        <p style="color: var(--gray-600); margin: 0;">+1 (555) 123-4567</p>
                        </div>
                    </div>
                </div>
            </div>

                        <div class="card">
                            <div class="card-body">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="width: 50px; height: 50px; background: var(--warning-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                        <i class="fas fa-clock"></i>
                </div>
                                    <div>
                                        <h4>Support Hours</h4>
                                        <p style="color: var(--gray-600); margin: 0;">24/7 Available</p>
                </div>
                </div>
                </div>
            </div>
        </div>
                </div>
                </div>
            </div>

        <!-- Login Page -->
        <div id="loginPage" class="page hidden">
            <div class="container">
                <div class="auth-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <h2>Welcome Back</h2>
                            <p>Sign in to your Learn Optima account</p>
                        </div>
                        <form id="loginForm" class="auth-form">
                            <div class="form-group">
                                <label for="loginEmail">Email</label>
                                <input type="email" id="loginEmail" required>
                        </div>
                            <div class="form-group">
                                <label for="loginPassword">Password</label>
                                <input type="password" id="loginPassword" required>
                    </div>
                            <div class="form-group">
                                <a href="#" onclick="showForgotPassword()" class="forgot-password-link">Forgot your password?</a>
                            </div>
                            <button type="submit" class="btn btn-primary btn-full">Sign In</button>
                        </form>
                        <div style="display:flex;align-items:center;gap:12px;justify-content:center;margin:12px 0;">
                            <span style="height:1px;background:#e5e7eb;flex:1;"></span>
                            <span style="color:#6b7280;font-weight:600;">or</span>
                            <span style="height:1px;background:#e5e7eb;flex:1;"></span>
                        </div>
                        <div id="googleLoginBtn" style="display:flex;justify-content:center;"></div>
                        <div class="auth-footer">
                            <p>Don't have an account? <a href="#" onclick="showRegister()">Sign up</a></p>
                        </div>
                    </div>
                </div>
            </div>
                </div>

        <!-- Forgot Password Page -->
        <div id="forgotPasswordPage" class="page hidden">
            <div class="container">
                <div class="auth-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <h2>Reset Your Password</h2>
                            <p>Enter your email address and we'll send you a link to reset your password</p>
                        </div>
                        <form id="forgotPasswordForm" class="auth-form">
                            <div class="form-group">
                                <label for="forgotEmail">Email Address</label>
                                <input type="email" id="forgotEmail" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-full">Send Reset Link</button>
                        </form>
                        <div class="auth-footer">
                            <p>Remember your password? <a href="#" onclick="showLogin()">Sign in</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reset Password Page -->
        <div id="resetPasswordPage" class="page hidden">
            <div class="container">
                <div class="auth-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <h2>Create New Password</h2>
                            <p>Enter your new password below</p>
                        </div>
                        <form id="resetPasswordForm" class="auth-form">
                            <div class="form-group">
                                <label for="resetPassword">New Password</label>
                                <div class="password-input-container">
                                    <input type="password" id="resetPassword" minlength="8" required>
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('resetPassword')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="password-strength-meter" id="resetPasswordStrengthMeter">
                                    <div class="strength-bar">
                                        <div class="strength-fill" id="resetStrengthFill"></div>
                                    </div>
                                    <div class="strength-text" id="resetStrengthText">Enter a password</div>
                                </div>
                                <div class="password-requirements" id="resetPasswordRequirements">
                                    <div class="requirement-item" id="reset-req-length">
                                        <i class="fas fa-times"></i>
                                        <span>At least 8 characters</span>
                                    </div>
                                    <div class="requirement-item" id="reset-req-lowercase">
                                        <i class="fas fa-times"></i>
                                        <span>One lowercase letter</span>
                                    </div>
                                    <div class="requirement-item" id="reset-req-uppercase">
                                        <i class="fas fa-times"></i>
                                        <span>One uppercase letter</span>
                                    </div>
                                    <div class="requirement-item" id="reset-req-digit">
                                        <i class="fas fa-times"></i>
                                        <span>One number</span>
                                    </div>
                                    <div class="requirement-item" id="reset-req-special">
                                        <i class="fas fa-times"></i>
                                        <span>One special character</span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirm Password</label>
                                <div class="password-input-container">
                                    <input type="password" id="confirmPassword" minlength="8" required>
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirmPassword')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="password-match-indicator" id="passwordMatchIndicator">
                                    <i class="fas fa-times"></i>
                                    <span>Passwords don't match</span>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-full">Reset Password</button>
                        </form>
                        <div class="auth-footer">
                            <p>Remember your password? <a href="#" onclick="showLogin()">Sign in</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Register Page (Wizard) -->
        <div id="registerPage" class="page hidden">
            <div class="container">
                <div class="auth-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <h2>Create Your Account</h2>
                            <p>Two quick steps to get started</p>
                            <div id="regProgress" style="display:flex;gap:.5rem;justify-content:center;margin-top:8px">
                                <div data-step="1" class="step-dot" style="width:10px;height:10px;border-radius:50%;background:var(--secondary-color)"></div>
                                <div data-step="2" class="step-dot" style="width:10px;height:10px;border-radius:50%;background:#d1d5db"></div>
                        </div>
                        </div>

                        <form id="wizardForm" class="auth-form">
                            <!-- Step 1: Account -->
                            <div id="step1">
                            <div class="form-group">
                                    <label for="wFullName">Full Name</label>
                                    <input type="text" id="wFullName" required>
                        </div>
                            <div class="form-group">
                                    <label for="wEmail">Email</label>
                                    <input type="email" id="wEmail" required>
                    </div>
                            <div class="form-group">
                                    <label for="wPassword">Password</label>
                                    <div class="password-input-container">
                                        <input type="password" id="wPassword" minlength="8" required>
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('wPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="password-strength-meter" id="passwordStrengthMeter">
                                        <div class="strength-bar">
                                            <div class="strength-fill" id="strengthFill"></div>
                                        </div>
                                        <div class="strength-text" id="strengthText">Enter a password</div>
                                    </div>
                                    <div class="password-requirements" id="passwordRequirements">
                                        <div class="requirement-item" id="req-length">
                                            <i class="fas fa-times"></i>
                                            <span>At least 8 characters</span>
                                        </div>
                                        <div class="requirement-item" id="req-lowercase">
                                            <i class="fas fa-times"></i>
                                            <span>One lowercase letter</span>
                                        </div>
                                        <div class="requirement-item" id="req-uppercase">
                                            <i class="fas fa-times"></i>
                                            <span>One uppercase letter</span>
                                        </div>
                                        <div class="requirement-item" id="req-digit">
                                            <i class="fas fa-times"></i>
                                            <span>One number</span>
                                        </div>
                                        <div class="requirement-item" id="req-special">
                                            <i class="fas fa-times"></i>
                                            <span>One special character</span>
                                        </div>
                                    </div>
                </div>
                            <div class="form-group">
                                    <label>Register as</label>
                                    <div style="display:flex;gap:1rem;flex-wrap:wrap">
                                        <label style="display:flex;align-items:center;gap:.5rem"><input type="radio" name="wRole" value="learner" checked> Learner</label>
                                        <label style="display:flex;align-items:center;gap:.5rem"><input type="radio" name="wRole" value="tutor"> Tutor</label>
                                        <label style="display:flex;align-items:center;gap:.5rem"><input type="radio" name="wRole" value="parent"> Parent</label>
                            </div>
                                </div>
                                <button type="button" id="toStep2" class="btn btn-primary btn-full">Continue</button>
                            </div>

                            <!-- Step 2: Profile (role-aware) -->
                            <div id="step2" class="hidden">
                                <div id="roleSummary" style="margin-bottom:1rem;color:var(--gray-600)"></div>

                                <div id="wizLearner" class="role-fields">
                                    <div class="form-group"><label>Age</label><input type="number" id="lzAge" min="5" max="25" placeholder="15"></div>
                                    <div class="form-group"><label>Grade Level</label><input type="text" id="lzGrade" placeholder="Grade 9"></div>
                                    <div class="form-group"><label>Preferred Subjects</label><input type="text" id="lzSubjects" placeholder="Mathematics, English"></div>
                                    <div class="form-group"><label>Region/City</label><input type="text" id="lzRegion" placeholder="Windhoek"></div>
                                </div>

                                <div id="wizTutor" class="role-fields hidden">
                                    <div class="form-group"><label>Experience (years)</label><input type="number" id="tzExp" min="0" max="40" placeholder="3"></div>
                                    <div class="form-group"><label>Subjects Offered (JSON)</label><input id="tzSubjects" placeholder='{"Mathematics":["Grade 8"]}'></div>
                                    <div class="form-group"><label>Languages</label><input id="tzLang" placeholder="English, Afrikaans"></div>
                                    <div class="form-group"><label>Region/City</label><input id="tzRegion" placeholder="Walvis Bay"></div>
                                    <div class="form-group"><label>Hourly Rate (USD)</label><input type="number" id="tzRate" min="0" step="0.5" placeholder="20"></div>
                                </div>

                                <div id="wizParent" class="role-fields hidden">
                                    <div class="form-group"><label>Relationship</label><input id="pzRel" placeholder="Mother / Father / Guardian"></div>
                                    <div class="form-group"><label>Learner Emails</label><input id="pzLearners" placeholder="child1@example.com, child2@example.com"></div>
                                    <div class="form-group"><label><input type="checkbox" id="pzConsent"> I provide consent</label></div>
                                </div>

                                <div style="display:flex;gap:.75rem;justify-content:space-between">
                                    <button type="button" id="backStep1" class="btn btn-secondary" style="flex:1">Back</button>
                                    <button type="submit" id="finishBtn" class="btn btn-primary" style="flex:1">Finish</button>
                                </div>
                            </div>
                        </form>

                        <div style="display:flex;align-items:center;gap:12px;justify-content:center;margin:12px 0;">
                            <span style="height:1px;background:#e5e7eb;flex:1;"></span>
                            <span style="color:#6b7280;font-weight:600;">or</span>
                            <span style="height:1px;background:#e5e7eb;flex:1;"></span>
                        </div>
                        <div id="googleRegisterBtn" style="display:flex;justify-content:center;"></div>

                        <div class="auth-footer">
                            <p>Already have an account? <a href="#" onclick="showLogin()">Sign in</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .dashboard-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:1rem; }
            .dash-card { background:var(--white); border:1px solid var(--gray-200); border-radius:1rem; padding:1rem 1.25rem; box-shadow:var(--shadow); }
            .dash-title { font-weight:700; margin-bottom:.25rem; color:var(--gray-900); }
            .dash-sub { color:var(--gray-500); font-size:.9rem; }
            .chart-placeholder { height:220px; background:linear-gradient(135deg, rgba(255,106,0,.06), rgba(0,160,228,.06)); border-radius:.75rem; border:1px dashed var(--gray-300); display:flex;align-items:center;justify-content:center; color:var(--gray-500); }

            /* Professional Dashboard Styles */
            .dashboard-container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 2rem;
            }

            .dashboard-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 3rem;
                padding-bottom: 2rem;
                border-bottom: 1px solid var(--gray-200);
            }

            .header-left h1 {
                font-size: 2.5rem;
                font-weight: 700;
                color: var(--gray-900);
                margin: 0 0 0.5rem 0;
            }

            .header-left p {
                font-size: 1.1rem;
                color: var(--gray-600);
                margin: 0;
            }

            .header-right {
                display: flex;
                align-items: center;
                gap: 2rem;
            }

            .header-stats {
                display: flex;
                gap: 1.5rem;
            }

            .quick-stat {
                text-align: center;
                padding: 1rem 1.5rem;
                background: var(--gray-50);
                border-radius: 12px;
                border: 1px solid var(--gray-200);
            }

            .stat-label {
                display: block;
                font-size: 0.875rem;
                color: var(--gray-600);
                margin-bottom: 0.25rem;
            }

            .stat-value {
                display: block;
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--primary-color);
            }

            .dashboard-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .metrics-section {
                grid-column: 1 / -1;
            }

            .metrics-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 1.5rem;
            }

            .metric-card {
                background: white;
                border-radius: 16px;
                padding: 2rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                border: 1px solid var(--gray-100);
                display: flex;
                align-items: center;
                gap: 1.5rem;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .metric-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--primary-color);
            }

            .metric-card.primary::before { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .metric-card.success::before { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
            .metric-card.warning::before { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
            .metric-card.info::before { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }

            .metric-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            }

            .metric-icon {
                width: 60px;
                height: 60px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
                color: white;
                flex-shrink: 0;
            }

            .metric-card.primary .metric-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .metric-card.success .metric-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
            .metric-card.warning .metric-icon { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
            .metric-card.info .metric-icon { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }

            .metric-content {
                flex: 1;
            }

            .metric-value {
                font-size: 2.5rem;
                font-weight: 800;
                color: var(--gray-900);
                line-height: 1;
                margin-bottom: 0.5rem;
            }

            .metric-label {
                font-size: 0.9rem;
                color: var(--gray-600);
                font-weight: 500;
                margin-bottom: 0.5rem;
            }

            .metric-change {
                font-size: 0.8rem;
                color: var(--gray-500);
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }

            .metric-change.positive {
                color: #10b981;
            }

            .analytics-section {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 2rem;
            }

            .chart-card {
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                border: 1px solid var(--gray-100);
                overflow: hidden;
            }

            .chart-header {
                padding: 1.5rem 2rem;
                border-bottom: 1px solid var(--gray-100);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .chart-header h3 {
                font-size: 1.1rem;
                font-weight: 600;
                color: var(--gray-900);
                margin: 0;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .chart-controls select {
                padding: 0.5rem 1rem;
                border: 1px solid var(--gray-300);
                border-radius: 8px;
                background: white;
                font-size: 0.875rem;
            }

            .chart-container {
                padding: 2rem;
                height: 300px;
                position: relative;
            }

            .content-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }

            .card {
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                border: 1px solid var(--gray-100);
                overflow: hidden;
            }

            .card-header {
                padding: 1.5rem 2rem;
                border-bottom: 1px solid var(--gray-100);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .card-header h3 {
                font-size: 1.1rem;
                font-weight: 600;
                color: var(--gray-900);
                margin: 0;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .card-content {
                padding: 2rem;
            }

            .tutor-recommendations {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .loading-state {
                text-align: center;
                padding: 2rem;
                color: var(--gray-500);
            }

            .loading-state i {
                font-size: 2rem;
                margin-bottom: 1rem;
                color: var(--primary-color);
            }

            .goals-list {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .goal-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 1rem;
            }

            .goal-info h4 {
                font-size: 1rem;
                font-weight: 600;
                color: var(--gray-900);
                margin: 0 0 0.25rem 0;
            }

            .goal-info p {
                font-size: 0.875rem;
                color: var(--gray-600);
                margin: 0;
            }

            .goal-progress {
                display: flex;
                align-items: center;
                gap: 1rem;
                min-width: 120px;
            }

            .progress-bar {
                flex: 1;
                height: 8px;
                background: var(--gray-200);
                border-radius: 4px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
                transition: width 0.3s ease;
            }

            .progress-text {
                font-size: 0.875rem;
                font-weight: 600;
                color: var(--gray-700);
                min-width: 35px;
                text-align: right;
            }

            .feedback-summary {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .rating-overview {
                text-align: center;
            }

            .rating-score {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 0.5rem;
            }

            .score {
                font-size: 3rem;
                font-weight: 800;
                color: var(--primary-color);
            }

            .stars {
                display: flex;
                gap: 0.25rem;
            }

            .stars i {
                color: #fbbf24;
                font-size: 1.25rem;
            }

            .rating-count {
                font-size: 0.875rem;
                color: var(--gray-600);
            }

            .feedback-item {
                padding: 1rem;
                background: var(--gray-50);
                border-radius: 12px;
                border-left: 4px solid var(--primary-color);
            }

            .feedback-text {
                font-size: 0.9rem;
                color: var(--gray-700);
                margin-bottom: 0.5rem;
                font-style: italic;
            }

            .feedback-meta {
                display: flex;
                justify-content: space-between;
                font-size: 0.8rem;
                color: var(--gray-600);
            }

            .earnings-summary {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .earning-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem;
                background: var(--gray-50);
                border-radius: 12px;
            }

            .earning-label {
                font-size: 0.9rem;
                color: var(--gray-600);
            }

            .earning-value {
                font-size: 1.25rem;
                font-weight: 700;
                color: var(--success-color);
            }

            .children-list {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .child-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 1rem;
            }

            .child-info h4 {
                font-size: 1rem;
                font-weight: 600;
                color: var(--gray-900);
                margin: 0 0 0.25rem 0;
            }

            .child-info p {
                font-size: 0.875rem;
                color: var(--gray-600);
                margin: 0;
            }

            .progress-circle {
                position: relative;
                width: 60px;
                height: 60px;
            }

            .progress-circle svg {
                width: 100%;
                height: 100%;
                transform: rotate(-90deg);
            }

            .progress-text {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 0.8rem;
                font-weight: 700;
                color: var(--gray-700);
            }

            .upcoming-sessions {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .session-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                background: var(--gray-50);
                border-radius: 12px;
                border-left: 4px solid var(--primary-color);
            }

            .session-time {
                text-align: center;
                min-width: 80px;
            }

            .session-time .time {
                display: block;
                font-size: 1rem;
                font-weight: 600;
                color: var(--gray-900);
            }

            .session-time .date {
                display: block;
                font-size: 0.8rem;
                color: var(--gray-600);
            }

            .session-info {
                flex: 1;
            }

            .session-info h4 {
                font-size: 0.9rem;
                font-weight: 600;
                color: var(--gray-900);
                margin: 0 0 0.25rem 0;
            }

            .session-info p {
                font-size: 0.8rem;
                color: var(--gray-600);
                margin: 0;
            }

            .status-badge {
                padding: 0.25rem 0.75rem;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
                text-transform: uppercase;
            }

            .status-badge.upcoming {
                background: #fef3c7;
                color: #92400e;
            }

            .activity-section {
                grid-column: 1 / -1;
            }

            .activity-timeline {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .activity-item {
                display: flex;
                align-items: flex-start;
                gap: 1rem;
            }

            .activity-icon {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.9rem;
                color: white;
                flex-shrink: 0;
            }

            .activity-icon.success {
                background: var(--success-color);
            }

            .activity-icon.info {
                background: var(--primary-color);
            }

            .activity-content h4 {
                font-size: 0.9rem;
                font-weight: 600;
                color: var(--gray-900);
                margin: 0 0 0.25rem 0;
            }

            .activity-content p {
                font-size: 0.8rem;
                color: var(--gray-600);
                margin: 0 0 0.5rem 0;
            }

            .activity-time {
                font-size: 0.75rem;
                color: var(--gray-500);
            }

            .quick-actions-section {
                grid-column: 1 / -1;
            }

            .quick-actions-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }

            .quick-action-btn {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 0.75rem;
                padding: 2rem 1rem;
                background: var(--gray-50);
                border: 2px solid var(--gray-200);
                border-radius: 16px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-decoration: none;
                color: var(--gray-700);
            }

            .quick-action-btn:hover {
                background: white;
                border-color: var(--primary-color);
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            }

            .quick-action-btn i {
                font-size: 2rem;
                color: var(--primary-color);
            }

            .quick-action-btn span {
                font-size: 0.9rem;
                font-weight: 600;
            }

            /* Additional Dashboard Components */
            .tutor-recommendation {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem;
                background: var(--gray-50);
                border-radius: 12px;
                border: 1px solid var(--gray-200);
                margin-bottom: 1rem;
            }

            .tutor-info h4 {
                font-size: 1rem;
                font-weight: 600;
                color: var(--gray-900);
                margin: 0 0 0.25rem 0;
            }

            .tutor-info p {
                font-size: 0.875rem;
                color: var(--gray-600);
                margin: 0 0 0.5rem 0;
            }

            .tutor-rating {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .tutor-rating .stars {
                color: #fbbf24;
                font-size: 0.875rem;
            }

            .tutor-rating .rating-text {
                font-size: 0.8rem;
                color: var(--gray-600);
            }

            .btn-sm {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }

            /* Role Section Styles */
            .role-section {
                grid-column: 1 / -1;
            }

            .role-section.hidden {
                display: none;
            }

            /* Chart Placeholder for when Chart.js is not available */
            .chart-container canvas {
                max-width: 100%;
                height: auto;
            }

            /* Enhanced Button Styles */
            .btn-outline {
                background: transparent;
                border: 2px solid var(--primary-color);
                color: var(--primary-color);
                padding: 0.75rem 1.5rem;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
            }

            .btn-outline:hover {
                background: var(--primary-color);
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }

            /* Responsive Design */
            @media (max-width: 1200px) {
                .analytics-section {
                    grid-template-columns: 1fr;
                }
                
                .content-grid {
                    grid-template-columns: 1fr;
                }
            }

            @media (max-width: 768px) {
                .dashboard-container {
                    padding: 1rem;
                }
                
                .dashboard-header {
                    flex-direction: column;
                    gap: 1.5rem;
                    align-items: stretch;
                }
                
                .header-right {
                    justify-content: space-between;
                }
                
                .metrics-grid {
                    grid-template-columns: 1fr;
                }
                
                .quick-actions-grid {
                    grid-template-columns: repeat(2, 1fr);
                }

                .tutor-recommendation {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 1rem;
                }

                .header-stats {
                    flex-direction: column;
                    gap: 1rem;
                }
            }

            /* Enhanced Learner Dashboard Styles */
            .learner-dashboard {
                display: flex;
                flex-direction: column;
                gap: 2rem;
            }

            .progress-section {
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                border-radius: 1.5rem;
                padding: 2rem;
                color: white;
                position: relative;
                overflow: hidden;
            }

            .progress-section::before {
                content: '';
                position: absolute;
                top: -50%;
                right: -50%;
                width: 200%;
                height: 200%;
                background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
                animation: float 6s ease-in-out infinite;
            }

            @keyframes float {
                0%, 100% { transform: translateY(0px) rotate(0deg); }
                50% { transform: translateY(-20px) rotate(180deg); }
            }

            /* Enhanced Professional Dashboard Styles */
            .welcome-section {
                position: relative;
            }

            .user-stats-mini {
                display: flex;
                gap: 1.5rem;
                margin-top: 1rem;
            }

            .mini-stat {
                display: flex;
                flex-direction: column;
                gap: 0.25rem;
            }

            .mini-label {
                font-size: 0.875rem;
                color: var(--gray-500);
                font-weight: 500;
            }

            .mini-value {
                font-size: 1rem;
                color: var(--gray-900);
                font-weight: 600;
            }

            .header-actions {
                display: flex;
                gap: 1rem;
                align-items: center;
            }

            /* Enhanced Metric Cards */
            .metric-background {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                opacity: 0.05;
                border-radius: 1rem;
                overflow: hidden;
            }

            .metric-pattern {
                position: absolute;
                top: -50%;
                right: -50%;
                width: 200%;
                height: 200%;
                background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
                animation: float 8s ease-in-out infinite;
            }

            .metric-sparkline {
                position: absolute;
                bottom: 1rem;
                right: 1rem;
                opacity: 0.6;
            }

            /* Performance Insights */
            .insights-section {
                grid-column: 1 / -1;
            }

            .insight-badge {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 0.5rem 1rem;
                border-radius: 2rem;
                font-size: 0.875rem;
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .insights-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 1.5rem;
            }

            .insight-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1.5rem;
                background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
                border-radius: 1rem;
                border: 1px solid rgba(255,255,255,0.1);
                transition: all 0.3s ease;
            }

            .insight-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            }

            .insight-icon {
                width: 3rem;
                height: 3rem;
                border-radius: 1rem;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1.25rem;
            }

            .insight-content h4 {
                margin: 0 0 0.5rem 0;
                color: var(--gray-900);
                font-size: 1.1rem;
                font-weight: 600;
            }

            .insight-value {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--primary-color);
                margin-bottom: 0.25rem;
            }

            .insight-content p {
                margin: 0;
                color: var(--gray-600);
                font-size: 0.875rem;
            }

            /* Achievement Badges */
            .achievements-section {
                grid-column: 1 / -1;
            }

            .achievements-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1rem;
            }

            .achievement-badge {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                border-radius: 1rem;
                border: 2px solid var(--gray-200);
                transition: all 0.3s ease;
            }

            .achievement-badge.earned {
                background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(34,197,94,0.05));
                border-color: rgba(34,197,94,0.3);
            }

            .achievement-badge.locked {
                background: rgba(156,163,175,0.1);
                border-color: rgba(156,163,175,0.3);
                opacity: 0.7;
            }

            .badge-icon {
                width: 2.5rem;
                height: 2.5rem;
                border-radius: 0.75rem;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.25rem;
            }

            .achievement-badge.earned .badge-icon {
                background: linear-gradient(135deg, #22c55e, #16a34a);
                color: white;
            }

            .achievement-badge.locked .badge-icon {
                background: var(--gray-300);
                color: var(--gray-500);
            }

            .badge-info h4 {
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
                font-size: 1rem;
                font-weight: 600;
            }

            .badge-info p {
                margin: 0 0 0.25rem 0;
                color: var(--gray-600);
                font-size: 0.875rem;
            }

            .badge-date, .badge-progress {
                font-size: 0.75rem;
                color: var(--gray-500);
                font-weight: 500;
            }

            /* Notifications */
            .notifications-section {
                grid-column: 1 / -1;
            }

            .notification-count {
                background: var(--primary-color);
                color: white;
                padding: 0.25rem 0.75rem;
                border-radius: 1rem;
                font-size: 0.875rem;
                font-weight: 600;
            }

            .notifications-list {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .notification-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                border-radius: 0.75rem;
                border: 1px solid var(--gray-200);
                transition: all 0.3s ease;
            }

            .notification-item.unread {
                background: rgba(59,130,246,0.05);
                border-color: rgba(59,130,246,0.2);
            }

            .notification-item:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }

            .notification-icon {
                width: 2.5rem;
                height: 2.5rem;
                border-radius: 0.75rem;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1rem;
                color: white;
            }

            .notification-icon.info {
                background: var(--primary-color);
            }

            .notification-icon.success {
                background: #22c55e;
            }

            .notification-icon.warning {
                background: #f59e0b;
            }

            .notification-content {
                flex: 1;
            }

            .notification-content h4 {
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
                font-size: 1rem;
                font-weight: 600;
            }

            .notification-content p {
                margin: 0 0 0.25rem 0;
                color: var(--gray-600);
                font-size: 0.875rem;
            }

            .notification-time {
                font-size: 0.75rem;
                color: var(--gray-500);
            }

            .notification-action {
                display: flex;
                gap: 0.5rem;
            }

            /* Enhanced Quick Actions */
            .quick-action-btn {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 0.75rem;
                padding: 1.5rem;
                background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
                border: 1px solid rgba(255,255,255,0.1);
                border-radius: 1rem;
                color: var(--gray-700);
                text-decoration: none;
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .quick-action-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 25px rgba(0,0,0,0.15);
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                color: white;
            }

            .quick-action-btn i {
                font-size: 1.5rem;
            }

            .quick-action-btn span {
                font-weight: 500;
                font-size: 0.875rem;
            }

            /* Role-Specific Dashboard Styles */
            
            /* Learner Dashboard Styles */
            .learning-journey {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .journey-step {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                border-radius: 0.75rem;
                border: 2px solid var(--gray-200);
                transition: all 0.3s ease;
            }

            .journey-step.completed {
                background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(34,197,94,0.05));
                border-color: rgba(34,197,94,0.3);
            }

            .journey-step.current {
                background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(59,130,246,0.05));
                border-color: rgba(59,130,246,0.3);
            }

            .journey-step.upcoming {
                background: rgba(156,163,175,0.1);
                border-color: rgba(156,163,175,0.3);
                opacity: 0.7;
            }

            .step-icon {
                width: 2.5rem;
                height: 2.5rem;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1rem;
                color: white;
            }

            .journey-step.completed .step-icon {
                background: #22c55e;
            }

            .journey-step.current .step-icon {
                background: #3b82f6;
            }

            .journey-step.upcoming .step-icon {
                background: var(--gray-400);
            }

            .step-content h4 {
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
                font-size: 1rem;
                font-weight: 600;
            }

            .step-content p {
                margin: 0 0 0.25rem 0;
                color: var(--gray-600);
                font-size: 0.875rem;
            }

            .step-date, .step-progress, .step-requirement {
                font-size: 0.75rem;
                color: var(--gray-500);
                font-weight: 500;
            }

            .learning-analytics {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .analytics-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
                border-radius: 0.75rem;
                border: 1px solid rgba(255,255,255,0.1);
            }

            .analytics-label {
                flex: 1;
                color: var(--gray-700);
                font-size: 0.875rem;
                font-weight: 500;
            }

            .analytics-value {
                font-size: 1.25rem;
                font-weight: 700;
                color: var(--primary-color);
                margin-bottom: 0.25rem;
            }

            .analytics-trend {
                font-size: 0.75rem;
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }

            .analytics-trend.positive {
                color: #22c55e;
            }

            .analytics-trend.neutral {
                color: #f59e0b;
            }

            .upcoming-sessions .session-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                border-radius: 0.75rem;
                border: 1px solid var(--gray-200);
                margin-bottom: 0.75rem;
            }

            .session-time {
                text-align: center;
                min-width: 80px;
            }

            .time-main {
                font-weight: 600;
                color: var(--gray-900);
                font-size: 0.875rem;
            }

            .time-detail {
                font-size: 0.75rem;
                color: var(--gray-500);
            }

            .session-info h4 {
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
                font-size: 1rem;
                font-weight: 600;
            }

            .session-info p {
                margin: 0;
                color: var(--gray-600);
                font-size: 0.875rem;
            }

            .session-status {
                margin-left: auto;
            }

            .session-status.scheduled {
                color: #3b82f6;
            }

            /* Tutor Dashboard Styles */
            .students-overview {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .student-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                border-radius: 0.75rem;
                border: 1px solid var(--gray-200);
                transition: all 0.3s ease;
            }

            .student-item:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }

            .student-avatar {
                width: 3rem;
                height: 3rem;
                border-radius: 50%;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 600;
                font-size: 0.875rem;
            }

            .student-info {
                flex: 1;
            }

            .student-info h4 {
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
                font-size: 1rem;
                font-weight: 600;
            }

            .student-info p {
                margin: 0 0 0.5rem 0;
                color: var(--gray-600);
                font-size: 0.875rem;
            }

            .student-progress {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .progress-text {
                font-size: 0.75rem;
                color: var(--gray-600);
                font-weight: 500;
            }

            .status-badge {
                padding: 0.25rem 0.75rem;
                border-radius: 1rem;
                font-size: 0.75rem;
                font-weight: 500;
            }

            .status-badge.active {
                background: rgba(34,197,94,0.1);
                color: #16a34a;
            }

            .status-badge.scheduled {
                background: rgba(59,130,246,0.1);
                color: #2563eb;
            }

            .performance-metrics {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .performance-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
                border-radius: 0.75rem;
                border: 1px solid rgba(255,255,255,0.1);
            }

            .performance-icon {
                width: 2.5rem;
                height: 2.5rem;
                border-radius: 0.75rem;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1rem;
            }

            .performance-info h4 {
                margin: 0 0 0.25rem 0;
                color: var(--gray-700);
                font-size: 0.875rem;
                font-weight: 500;
            }

            .performance-value {
                font-size: 1.25rem;
                font-weight: 700;
                color: var(--primary-color);
                margin-bottom: 0.25rem;
            }

            .performance-trend {
                font-size: 0.75rem;
                color: #22c55e;
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }

            .earnings-overview {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .earning-summary {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .earning-period {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px solid var(--gray-200);
            }

            .period-label {
                color: var(--gray-600);
                font-size: 0.875rem;
                font-weight: 500;
            }

            .period-value {
                font-weight: 600;
                color: var(--gray-900);
                font-size: 1rem;
            }

            .schedule-overview {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .schedule-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                background: rgba(59,130,246,0.05);
                border-radius: 0.75rem;
                border: 1px solid rgba(59,130,246,0.1);
            }

            .schedule-time {
                font-weight: 600;
                color: var(--gray-900);
                min-width: 60px;
            }

            .schedule-info h4 {
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
                font-size: 0.875rem;
                font-weight: 600;
            }

            .schedule-info p {
                margin: 0;
                color: var(--gray-600);
                font-size: 0.75rem;
            }

            .resources-list {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .resource-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                border-radius: 0.75rem;
                border: 1px solid var(--gray-200);
            }

            .resource-icon {
                width: 2.5rem;
                height: 2.5rem;
                border-radius: 0.75rem;
                background: linear-gradient(135deg, #667eea, #764ba2);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1rem;
            }

            .resource-info {
                flex: 1;
            }

            .resource-info h4 {
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
                font-size: 0.875rem;
                font-weight: 600;
            }

            .resource-info p {
                margin: 0;
                color: var(--gray-600);
                font-size: 0.75rem;
            }

            .usage-count {
                font-size: 0.75rem;
                color: var(--gray-500);
                font-weight: 500;
            }

            /* Parent Dashboard Styles */
            .child-avatar {
                width: 3rem;
                height: 3rem;
                border-radius: 50%;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 600;
                font-size: 0.875rem;
            }

            .child-avatar-small {
                width: 2rem;
                height: 2rem;
                border-radius: 50%;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 600;
                font-size: 0.75rem;
            }

            .child-subjects {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                margin-top: 0.5rem;
            }

            .subject-tag {
                background: rgba(59,130,246,0.1);
                color: #2563eb;
                padding: 0.25rem 0.5rem;
                border-radius: 0.5rem;
                font-size: 0.75rem;
                font-weight: 500;
            }

            .progress-label {
                text-align: center;
                font-size: 0.75rem;
                color: var(--gray-600);
                margin-top: 0.25rem;
            }

            .child-actions {
                margin-left: auto;
            }

            .session-child {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                min-width: 80px;
            }

            .session-details {
                flex: 1;
            }

            .session-details h4 {
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
                font-size: 0.875rem;
                font-weight: 600;
            }

            .session-details p {
                margin: 0;
                color: var(--gray-600);
                font-size: 0.75rem;
            }

            .family-analytics {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .analytics-period {
                font-size: 0.75rem;
                color: var(--gray-500);
            }

            .billing-overview {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .billing-summary {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .billing-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px solid var(--gray-200);
            }

            .billing-label {
                color: var(--gray-600);
                font-size: 0.875rem;
                font-weight: 500;
            }

            .billing-value {
                font-weight: 600;
                color: var(--gray-900);
                font-size: 1rem;
            }

            .billing-breakdown {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            .breakdown-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem;
                background: rgba(59,130,246,0.05);
                border-radius: 0.5rem;
            }

            .breakdown-child {
                color: var(--gray-700);
                font-size: 0.875rem;
                font-weight: 500;
            }

            .breakdown-amount {
                font-weight: 600;
                color: var(--gray-900);
                font-size: 0.875rem;
            }

            /* Empty State Styles */
            .empty-state {
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 70vh;
                padding: 2rem;
                background: linear-gradient(135deg, rgba(59,130,246,0.05), rgba(147,51,234,0.05));
                border-radius: 1rem;
                margin: 2rem 0;
            }

            .empty-state-content {
                text-align: center;
                max-width: 600px;
                width: 100%;
            }

            .empty-state-icon {
                width: 6rem;
                height: 6rem;
                border-radius: 50%;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 2rem auto;
                box-shadow: 0 10px 25px rgba(59,130,246,0.3);
            }

            .empty-state-icon i {
                font-size: 2.5rem;
                color: white;
            }

            .empty-state h2 {
                font-size: 2rem;
                font-weight: 700;
                color: var(--gray-900);
                margin-bottom: 1rem;
            }

            .empty-state p {
                font-size: 1.125rem;
                color: var(--gray-600);
                margin-bottom: 2rem;
                line-height: 1.6;
            }

            .empty-state-actions {
                display: flex;
                gap: 1rem;
                justify-content: center;
                margin-bottom: 3rem;
                flex-wrap: wrap;
            }

            .empty-state-actions .btn {
                min-width: 200px;
                padding: 1rem 2rem;
                font-size: 1rem;
                font-weight: 600;
            }

            .empty-state-actions .btn i {
                margin-right: 0.5rem;
            }

            .empty-state-features {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 2rem;
                margin-top: 3rem;
            }

            .feature-item {
                background: white;
                padding: 2rem;
                border-radius: 1rem;
                box-shadow: 0 4px 6px rgba(0,0,0,0.05);
                border: 1px solid var(--gray-200);
                transition: all 0.3s ease;
            }

            .feature-item:hover {
                transform: translateY(-4px);
                box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            }

            .feature-item i {
                font-size: 2rem;
                color: var(--primary-color);
                margin-bottom: 1rem;
            }

            .feature-item h4 {
                font-size: 1.125rem;
                font-weight: 600;
                color: var(--gray-900);
                margin-bottom: 0.5rem;
            }

            .feature-item p {
                font-size: 0.875rem;
                color: var(--gray-600);
                margin: 0;
                line-height: 1.5;
            }

            /* Responsive empty state */
            @media (max-width: 768px) {
                .empty-state {
                    padding: 1rem;
                    min-height: 60vh;
                }

                .empty-state-icon {
                    width: 4rem;
                    height: 4rem;
                }

                .empty-state-icon i {
                    font-size: 2rem;
                }

                .empty-state h2 {
                    font-size: 1.5rem;
                }

                .empty-state p {
                    font-size: 1rem;
                }

                .empty-state-actions {
                    flex-direction: column;
                    align-items: center;
                }

                .empty-state-actions .btn {
                    min-width: 250px;
                }

                .empty-state-features {
                    grid-template-columns: 1fr;
                    gap: 1rem;
                }

                .feature-item {
                    padding: 1.5rem;
                }
            }

            /* Empty state animations */
            .empty-state {
                animation: fadeInUp 0.6s ease-out;
            }

            .feature-item {
                animation: fadeInUp 0.6s ease-out;
                animation-fill-mode: both;
            }

            .feature-item:nth-child(1) {
                animation-delay: 0.1s;
            }

            .feature-item:nth-child(2) {
                animation-delay: 0.2s;
            }

            .feature-item:nth-child(3) {
                animation-delay: 0.3s;
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Empty children state */
            .empty-children-state {
                text-align: center;
                padding: 3rem 2rem;
                background: linear-gradient(135deg, rgba(59,130,246,0.05), rgba(147,51,234,0.05));
                border-radius: 1rem;
                border: 2px dashed var(--gray-300);
            }

            .empty-children-icon {
                width: 4rem;
                height: 4rem;
                border-radius: 50%;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 1.5rem auto;
            }

            .empty-children-icon i {
                font-size: 1.5rem;
                color: white;
            }

            .empty-children-state h4 {
                font-size: 1.25rem;
                font-weight: 600;
                color: var(--gray-900);
                margin-bottom: 0.5rem;
            }

            .empty-children-state p {
                color: var(--gray-600);
                margin-bottom: 1.5rem;
            }

            .progress-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
                position: relative;
                z-index: 1;
            }

            .progress-header h3 {
                font-size: 1.5rem;
                font-weight: 700;
                margin: 0;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .progress-stats {
                display: flex;
                gap: 2rem;
            }

            .stat-item {
                text-align: center;
            }

            .stat-number {
                display: block;
                font-size: 2rem;
                font-weight: 800;
                line-height: 1;
            }

            .stat-label {
                font-size: 0.875rem;
                opacity: 0.9;
                margin-top: 0.25rem;
            }

            .progress-bar-container {
                position: relative;
                z-index: 1;
            }

            .progress-bar {
                height: 12px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 6px;
                overflow: hidden;
                margin-bottom: 1rem;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #10b981, #06b6d4);
                border-radius: 6px;
                transition: width 1s ease-in-out;
                width: 0%;
            }

            .milestone-markers {
                display: flex;
                justify-content: space-between;
                position: relative;
            }

            .milestone-markers::before {
                content: '';
                position: absolute;
                top: -6px;
                left: 0;
                right: 0;
                height: 2px;
                background: rgba(255, 255, 255, 0.3);
            }

            .milestone-markers .marker {
                width: 12px;
                height: 12px;
                background: rgba(255, 255, 255, 0.6);
                border-radius: 50%;
                position: relative;
                z-index: 1;
            }

            .milestone-markers .marker.active {
                background: #10b981;
                box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.3);
            }

            .insights-section {
                background: var(--white);
                border-radius: 1.5rem;
                padding: 2rem;
                box-shadow: var(--shadow-lg);
                border: 1px solid var(--gray-200);
            }

            .insights-section h3 {
                font-size: 1.25rem;
                font-weight: 700;
                margin-bottom: 1.5rem;
                color: var(--gray-900);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .insights-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 1.5rem;
            }

            .insight-card {
                background: var(--gray-50);
                border-radius: 1rem;
                padding: 1.5rem;
                border: 1px solid var(--gray-200);
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .insight-card:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
                border-color: var(--primary-color);
            }

            .insight-icon {
                width: 48px;
                height: 48px;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1.25rem;
                flex-shrink: 0;
            }

            .insight-content h4 {
                font-size: 1rem;
                font-weight: 600;
                margin: 0 0 0.5rem 0;
                color: var(--gray-900);
            }

            .difficulty-indicator {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            .difficulty-badge {
                background: var(--primary-color);
                color: white;
                padding: 0.25rem 0.75rem;
                border-radius: 1rem;
                font-size: 0.875rem;
                font-weight: 600;
                align-self: flex-start;
            }

            .difficulty-bar {
                height: 6px;
                background: var(--gray-200);
                border-radius: 3px;
                overflow: hidden;
            }

            .difficulty-fill {
                height: 100%;
                background: linear-gradient(90deg, var(--success-color), var(--warning-color));
                border-radius: 3px;
                transition: width 0.5s ease;
            }

            .attention-metric, .velocity-metric {
                display: flex;
                flex-direction: column;
                gap: 0.25rem;
            }

            .metric-value, .velocity-value {
                font-size: 1.25rem;
                font-weight: 700;
                color: var(--primary-color);
            }

            .metric-label, .velocity-trend {
                font-size: 0.875rem;
                color: var(--gray-600);
            }

            .engagement-gauge {
                position: relative;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: conic-gradient(var(--success-color) 0deg, var(--success-color) 306deg, var(--gray-200) 306deg);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .engagement-gauge::before {
                content: '';
                position: absolute;
                width: 40px;
                height: 40px;
                background: var(--white);
                border-radius: 50%;
            }

            .gauge-text {
                position: relative;
                z-index: 1;
                font-size: 0.875rem;
                font-weight: 700;
                color: var(--gray-900);
            }

            .tutors-section, .sessions-section, .achievements-section {
                background: var(--white);
                border-radius: 1.5rem;
                padding: 2rem;
                box-shadow: var(--shadow-lg);
                border: 1px solid var(--gray-200);
            }

            .section-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
            }

            .section-header h3 {
                font-size: 1.25rem;
                font-weight: 700;
                margin: 0;
                color: var(--gray-900);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .tutors-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
            }

            .tutor-card {
                background: var(--gray-50);
                border-radius: 1rem;
                padding: 1.5rem;
                border: 1px solid var(--gray-200);
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .tutor-card:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
                border-color: var(--primary-color);
            }

            .tutor-header {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 1rem;
            }

            .tutor-avatar {
                width: 48px;
                height: 48px;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 700;
                font-size: 1.125rem;
            }

            .tutor-info h4 {
                font-size: 1.125rem;
                font-weight: 700;
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
            }

            .tutor-rating {
                display: flex;
                align-items: center;
                gap: 0.25rem;
                color: var(--warning-color);
                font-weight: 600;
            }

            .tutor-subjects {
                color: var(--gray-600);
                font-size: 0.875rem;
                margin: 0.5rem 0;
            }

            .tutor-actions {
                display: flex;
                gap: 0.75rem;
                margin-top: 1rem;
            }

            .sessions-list {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .session-item {
                background: var(--gray-50);
                border-radius: 0.75rem;
                padding: 1rem;
                border: 1px solid var(--gray-200);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .session-info h4 {
                font-size: 1rem;
                font-weight: 600;
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
            }

            .session-time {
                color: var(--gray-600);
                font-size: 0.875rem;
            }

            .session-status {
                padding: 0.25rem 0.75rem;
                border-radius: 1rem;
                font-size: 0.875rem;
                font-weight: 600;
            }

            .session-status.scheduled {
                background: var(--info-color);
                color: white;
            }

            .session-status.completed {
                background: var(--success-color);
                color: white;
            }

            .achievements-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1rem;
            }

            .achievement-card {
                background: var(--gray-50);
                border-radius: 1rem;
                padding: 1.5rem;
                border: 1px solid var(--gray-200);
                display: flex;
                align-items: center;
                gap: 1rem;
                transition: all 0.3s ease;
            }

            .achievement-card.earned {
                background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
                border-color: var(--success-color);
            }

            .achievement-card.locked {
                opacity: 0.6;
                filter: grayscale(0.5);
            }

            .achievement-icon {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.25rem;
                flex-shrink: 0;
            }

            .achievement-card.earned .achievement-icon {
                background: var(--success-color);
                color: white;
            }

            .achievement-card.locked .achievement-icon {
                background: var(--gray-400);
                color: white;
            }

            .achievement-info h4 {
                font-size: 1rem;
                font-weight: 600;
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
            }

            .achievement-info p {
                font-size: 0.875rem;
                color: var(--gray-600);
                margin: 0;
            }

            .progress-text {
                font-size: 0.75rem;
                color: var(--gray-500);
                margin-top: 0.25rem;
                font-weight: 600;
            }

            /* Mini Tutor Cards for Dashboard */
            .tutor-card-mini {
                background: var(--white);
                border-radius: 1rem;
                padding: 1rem;
                border: 1px solid var(--gray-200);
                transition: all 0.3s ease;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }

            .tutor-card-mini:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
                border-color: var(--primary-color);
            }

            .tutor-avatar-mini {
                width: 40px;
                height: 40px;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 700;
                font-size: 0.875rem;
                flex-shrink: 0;
            }

            .tutor-info-mini {
                flex: 1;
                min-width: 0;
            }

            .tutor-info-mini h4 {
                font-size: 0.875rem;
                font-weight: 600;
                margin: 0 0 0.25rem 0;
                color: var(--gray-900);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .tutor-rating-mini {
                display: flex;
                align-items: center;
                gap: 0.25rem;
                margin-bottom: 0.25rem;
            }

            .tutor-rating-mini .stars {
                display: flex;
                gap: 0.0625rem;
            }

            .tutor-rating-mini .star {
                font-size: 0.75rem;
                color: var(--warning-color);
            }

            .tutor-rating-mini span {
                font-size: 0.75rem;
                font-weight: 600;
                color: var(--gray-700);
            }

            .tutor-subjects-mini {
                font-size: 0.75rem;
                color: var(--gray-600);
                margin: 0;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .no-tutors, .no-sessions {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 2rem;
                color: var(--gray-500);
                gap: 0.75rem;
                text-align: center;
            }

            .no-tutors i, .no-sessions i {
                font-size: 2rem;
                color: var(--gray-400);
            }

            .no-tutors p, .no-sessions p {
                margin: 0;
                font-size: 0.875rem;
            }

            .loading-placeholder {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 3rem;
                color: var(--gray-500);
                gap: 1rem;
            }

            .loading-placeholder i {
                font-size: 2rem;
                color: var(--primary-color);
            }

            /* Password Security Styles */
            .password-input-container {
                position: relative;
                display: flex;
                align-items: center;
            }

            .password-input-container input {
                padding-right: 3rem;
                width: 100%;
            }

            .password-toggle {
                position: absolute;
                right: 0.75rem;
                background: none;
                border: none;
                color: var(--gray-500);
                cursor: pointer;
                padding: 0.25rem;
                border-radius: 0.25rem;
                transition: color 0.3s ease;
            }

            .password-toggle:hover {
                color: var(--primary-color);
            }

            .password-strength-meter {
                margin-top: 0.75rem;
            }

            .strength-bar {
                height: 4px;
                background: var(--gray-200);
                border-radius: 2px;
                overflow: hidden;
                margin-bottom: 0.5rem;
            }

            .strength-fill {
                height: 100%;
                border-radius: 2px;
                transition: all 0.3s ease;
                width: 0%;
            }

            .strength-fill.weak {
                background: var(--error-color);
                width: 25%;
            }

            .strength-fill.fair {
                background: var(--warning-color);
                width: 50%;
            }

            .strength-fill.good {
                background: #3b82f6;
                width: 75%;
            }

            .strength-fill.strong {
                background: var(--success-color);
                width: 100%;
            }

            .strength-text {
                font-size: 0.875rem;
                font-weight: 600;
                color: var(--gray-600);
            }

            .strength-text.weak {
                color: var(--error-color);
            }

            .strength-text.fair {
                color: var(--warning-color);
            }

            .strength-text.good {
                color: #3b82f6;
            }

            .strength-text.strong {
                color: var(--success-color);
            }

            .password-requirements {
                margin-top: 0.75rem;
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            .requirement-item {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.875rem;
                transition: all 0.3s ease;
            }

            .requirement-item i {
                width: 16px;
                height: 16px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.75rem;
                transition: all 0.3s ease;
            }

            .requirement-item:not(.met) {
                color: var(--gray-500);
            }

            .requirement-item:not(.met) i {
                background: var(--gray-200);
                color: var(--gray-500);
            }

            .requirement-item.met {
                color: var(--success-color);
            }

            .requirement-item.met i {
                background: var(--success-color);
                color: white;
            }

            .requirement-item.met i:before {
                content: "\f00c";
            }

            .requirement-item:not(.met) i:before {
                content: "\f00d";
            }

            .forgot-password-link {
                color: var(--primary-color);
                text-decoration: none;
                font-size: 0.875rem;
                font-weight: 500;
                transition: color 0.3s ease;
            }

            .forgot-password-link:hover {
                color: var(--primary-dark);
                text-decoration: underline;
            }

            .password-match-indicator {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.875rem;
                margin-top: 0.5rem;
                transition: all 0.3s ease;
            }

            .password-match-indicator:not(.match) {
                color: var(--error-color);
            }

            .password-match-indicator.match {
                color: var(--success-color);
            }

            .password-match-indicator i {
                width: 16px;
                height: 16px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.75rem;
                transition: all 0.3s ease;
            }

            .password-match-indicator:not(.match) i {
                background: var(--error-color);
                color: white;
            }

            .password-match-indicator.match i {
                background: var(--success-color);
                color: white;
            }

            .password-match-indicator.match i:before {
                content: "\f00c";
            }

            .password-match-indicator:not(.match) i:before {
                content: "\f00d";
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .progress-stats {
                    flex-direction: column;
                    gap: 1rem;
                }

                .insights-grid {
                    grid-template-columns: 1fr;
                }

                .tutors-grid {
                    grid-template-columns: 1fr;
                }

                .achievements-grid {
                    grid-template-columns: 1fr;
                }

                .section-header {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 1rem;
                }
            }
        </style>


        <script>
        (function(){
            // Wizard logic
            const wizard = document.getElementById('wizardForm');
            async function submitWizard(e){
                if(e) e.preventDefault();
                const full_name = document.getElementById('wFullName').value.trim();
                const email = document.getElementById('wEmail').value.trim();
                const password = document.getElementById('wPassword').value;
                const role = (wizard.querySelector('input[name="wRole"]:checked')||{}).value || 'learner';
                if(!full_name || !email || !password){ showMessage('Please fill all required account fields','error'); return; }
                try{
                    const res = await fetch(`${API_BASE}/api/auth/register`,{
                        method:'POST', headers:{'Content-Type':'application/json'},
                        body: JSON.stringify({ full_name, email, password, role })
                    });
                    if(!res.ok){ const er=await res.json().catch(()=>({detail:'Registration failed'})); throw new Error(er.detail||'Registration failed'); }
                    const data = await res.json();
                    const token = data.access_token; localStorage.setItem('aura_token', token);
                    const auth = { 'Content-Type':'application/json', 'Authorization':'Bearer '+token };
                    if (role==='learner'){
                        const payload = {
                            age: parseInt(document.getElementById('lzAge').value||'0')||null,
                            grade_level: document.getElementById('lzGrade').value||null,
                            preferred_subjects: (document.getElementById('lzSubjects').value||'').split(',').map(s=>s.trim()).filter(Boolean),
                            region: document.getElementById('lzRegion').value||null
                        };
                        await fetch(`${API_BASE}/api/profiles/learner`,{method:'POST', headers:auth, body: JSON.stringify(payload)});
                    } else if (role==='tutor'){
                        let subs={}; try{ const t=document.getElementById('tzSubjects').value||''; if(t.trim()) subs=JSON.parse(t);}catch{}
                        const payload = {
                            years_experience: parseInt(document.getElementById('tzExp').value||'0')||0,
                            subjects_offered: subs,
                            languages_spoken: (document.getElementById('tzLang').value||'').split(',').map(s=>s.trim()).filter(Boolean),
                            region: document.getElementById('tzRegion').value||null,
                            hourly_rate: parseFloat(document.getElementById('tzRate').value||'0')||0
                        };
                        await fetch(`${API_BASE}/api/profiles/tutor`,{method:'POST', headers:auth, body: JSON.stringify(payload)});
                    } else {
                        const payload = {
                            relationship_to_learner: document.getElementById('pzRel').value||null,
                            linked_learners: (document.getElementById('pzLearners').value||'').split(',').map(s=>s.trim()).filter(Boolean),
                            consent_given: !!document.getElementById('pzConsent').checked,
                            consent_timestamp: new Date().toISOString()
                        };
                        await fetch(`${API_BASE}/api/profiles/parent`,{method:'POST', headers:auth, body: JSON.stringify(payload)});
                    }
                    showMessage('Welcome to Learn Optima!','success');
                    if(typeof showDashboard==='function') showDashboard(); else window.location.href='/dashboard';
                }catch(err){ console.error(err); showMessage(err.message||'Registration failed','error'); }
            }
            if (wizard){
                const step1 = document.getElementById('step1');
                const step2 = document.getElementById('step2');
                const dots = document.querySelectorAll('#regProgress .step-dot');
                const btnNext = document.getElementById('toStep2');
                const btnBack = document.getElementById('backStep1');
                const btnFinish = document.getElementById('finishBtn');
                const roleViews = { learner: 'wizLearner', tutor: 'wizTutor', parent: 'wizParent' };
                function showStep(n){ step1.classList.toggle('hidden', n!==1); step2.classList.toggle('hidden', n!==2); dots.forEach(d=> d.style.background = d.dataset.step==n? 'var(--secondary-color)' : '#d1d5db'); }
                function currentRole(){ const r = wizard.querySelector('input[name="wRole"]:checked'); return r ? r.value : 'learner'; }
                btnNext.addEventListener('click', ()=>{
                    const name = document.getElementById('wFullName').value.trim();
                    const email = document.getElementById('wEmail').value.trim();
                    const pwd = document.getElementById('wPassword').value;
                    if(!name || !email || !pwd){ showMessage('Please complete all account fields','error'); return; }
                    Object.values(roleViews).forEach(id=> document.getElementById(id).classList.add('hidden'));
                    document.getElementById(roleViews[currentRole()]).classList.remove('hidden');
                    showStep(2);
                });
                btnBack.addEventListener('click', ()=> showStep(1));
                showStep(1);
                // Robust finish handling
                if(btnFinish){ btnFinish.addEventListener('click', submitWizard); }
                wizard.addEventListener('submit', submitWizard); // fallback
            }
        })();
        </script>

        <!-- Professional Dashboard Page -->
        <div id="dashboardPage" class="page hidden">
            <div class="dashboard-container">
                <!-- Dashboard Header -->
                <div class="dashboard-header">
                    <div class="header-left">
                        <div class="welcome-section">
                            <h1 id="dashWelcome">Welcome back!</h1>
                            <p id="dashSubtitle">Here's your personalized learning overview</p>
                            <div class="user-stats-mini">
                                <div class="mini-stat">
                                    <span class="mini-label">Member since</span>
                                    <span class="mini-value">Jan 2024</span>
                                </div>
                                <div class="mini-stat">
                                    <span class="mini-label">Current streak</span>
                                    <span class="mini-value">7 days</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="header-right">
                        <div class="header-stats">
                            <div class="quick-stat">
                                <span class="stat-label">Today</span>
                                <span id="todaySessions" class="stat-value">0</span>
                            </div>
                            <div class="quick-stat">
                                <span class="stat-label">This Week</span>
                                <span id="weekSessions" class="stat-value">0</span>
                            </div>
                            <div class="quick-stat">
                                <span class="stat-label">Streak</span>
                                <span id="currentStreak" class="stat-value">7</span>
                            </div>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-secondary" onclick="showProfile()">
                                <i class="fas fa-cog"></i> Settings
                            </button>
                            <button class="btn btn-primary" onclick="showSessions()">
                                <i class="fas fa-calendar-plus"></i> Schedule Session
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Main Dashboard Grid -->
                <div class="dashboard-grid">
                    <!-- Key Metrics Cards -->
                    <div class="metrics-section">
                        <div class="metrics-grid">
                            <div class="metric-card primary">
                                <div class="metric-background">
                                    <div class="metric-pattern"></div>
                                </div>
                                <div class="metric-icon">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                </div>
                                <div class="metric-content">
                                    <div class="metric-value" id="statTotalSessions"></div>
                                    <div class="metric-label">Total Sessions</div>
                                    <div class="metric-change positive">
                                        <i class="fas fa-arrow-up"></i> +12% this month
                                    </div>
                                </div>
                                <div class="metric-sparkline">
                                    <canvas id="sessionsSparkline" width="80" height="30"></canvas>
                                </div>
                            </div>

                            <div class="metric-card success">
                                <div class="metric-background">
                                    <div class="metric-pattern"></div>
                                </div>
                                <div class="metric-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="metric-content">
                                    <div class="metric-value" id="statCompleted"></div>
                                    <div class="metric-label">Completed</div>
                                    <div class="metric-change positive">
                                        <i class="fas fa-arrow-up"></i> +8% completion rate
                                    </div>
                                </div>
                                <div class="metric-sparkline">
                                    <canvas id="completedSparkline" width="80" height="30"></canvas>
                                </div>
                            </div>

                            <div class="metric-card warning">
                                <div class="metric-background">
                                    <div class="metric-pattern"></div>
                                </div>
                                <div class="metric-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="metric-content">
                                    <div class="metric-value" id="statUpcoming"></div>
                                    <div class="metric-label">Upcoming</div>
                                    <div class="metric-change">
                                        Next: <span id="nextSessionTime"></span>
                                    </div>
                                </div>
                                <div class="metric-sparkline">
                                    <canvas id="upcomingSparkline" width="80" height="30"></canvas>
                                </div>
                            </div>

                            <div class="metric-card info">
                                <div class="metric-background">
                                    <div class="metric-pattern"></div>
                                </div>
                                <div class="metric-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="metric-content">
                                    <div class="metric-value" id="statProgress"></div>
                                    <div class="metric-label">Progress Score</div>
                                    <div class="metric-change positive">
                                        <i class="fas fa-arrow-up"></i> +5% this week
                                    </div>
                                </div>
                                <div class="metric-sparkline">
                                    <canvas id="progressSparkline" width="80" height="30"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Analytics -->
                    <div class="analytics-section">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3><i class="fas fa-chart-area"></i> Learning Progress</h3>
                                <div class="chart-controls">
                                    <select id="chartTimeframe">
                                        <option value="7d">Last 7 days</option>
                                        <option value="30d">Last 30 days</option>
                                        <option value="90d">Last 90 days</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="progressChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3><i class="fas fa-pie-chart"></i> Subject Distribution</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="subjectChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Learner-Specific Content -->
                    <div id="learnerDashRole" class="role-section hidden">
                        <div class="content-grid">
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-graduation-cap"></i> My Learning Journey</h3>
                                    <button class="btn btn-sm btn-outline" onclick="showLearningPath()">View Full Path</button>
                                </div>
                                <div class="card-content">
                                    <div class="learning-journey">
                                        <div class="journey-step completed">
                                            <div class="step-icon">
                                                <i class="fas fa-check"></i>
                                            </div>
                                            <div class="step-content">
                                                <h4>Foundation Level</h4>
                                                <p>Basic concepts mastered</p>
                                                <span class="step-date">Completed 2 weeks ago</span>
                                            </div>
                                        </div>
                                        <div class="journey-step current">
                                            <div class="step-icon">
                                                <i class="fas fa-play"></i>
                                            </div>
                                            <div class="step-content">
                                                <h4>Intermediate Level</h4>
                                                <p>Advanced problem solving</p>
                                                <span class="step-progress">Progress: 65%</span>
                                            </div>
                                        </div>
                                        <div class="journey-step upcoming">
                                            <div class="step-icon">
                                                <i class="fas fa-lock"></i>
                                            </div>
                                            <div class="step-content">
                                                <h4>Advanced Level</h4>
                                                <p>Expert-level mastery</p>
                                                <span class="step-requirement">Requires 80% completion</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-users"></i> My Tutors</h3>
                                    <button class="btn btn-sm btn-outline" onclick="showTutors()">Find More</button>
                                </div>
                                <div class="card-content">
                                    <div id="recTutors" class="tutor-recommendations">
                                        <div class="loading-state">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            <p>Finding the best tutors for you...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-brain"></i> Learning Analytics</h3>
                                </div>
                                <div class="card-content">
                                    <div class="learning-analytics">
                                        <div class="analytics-item">
                                            <div class="analytics-label">Study Time This Week</div>
                                            <div class="analytics-value">12.5 hours</div>
                                            <div class="analytics-trend positive">
                                                <i class="fas fa-arrow-up"></i> +2.3h from last week
                                            </div>
                                        </div>
                                        <div class="analytics-item">
                                            <div class="analytics-label">Focus Score</div>
                                            <div class="analytics-value">8.7/10</div>
                                            <div class="analytics-trend positive">
                                                <i class="fas fa-arrow-up"></i> Excellent concentration
                                            </div>
                                        </div>
                                        <div class="analytics-item">
                                            <div class="analytics-label">Weak Areas</div>
                                            <div class="analytics-value">Algebra II</div>
                                            <div class="analytics-trend neutral">
                                                <i class="fas fa-exclamation-circle"></i> Needs more practice
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-calendar-alt"></i> Upcoming Study Sessions</h3>
                                    <button class="btn btn-sm btn-outline" onclick="showSessions()">View All</button>
                                </div>
                                <div class="card-content">
                                    <div class="upcoming-sessions">
                                        <div class="session-item">
                                            <div class="session-time">
                                                <div class="time-main">Tomorrow</div>
                                                <div class="time-detail">2:00 PM - 3:30 PM</div>
                                            </div>
                                            <div class="session-info">
                                                <h4>Mathematics with Dr. Smith</h4>
                                                <p>Algebra II - Quadratic Functions</p>
                                            </div>
                                            <div class="session-status scheduled">
                                                <i class="fas fa-clock"></i>
                                            </div>
                                        </div>
                                        <div class="session-item">
                                            <div class="session-time">
                                                <div class="time-main">Friday</div>
                                                <div class="time-detail">10:00 AM - 11:00 AM</div>
                                            </div>
                                            <div class="session-info">
                                                <h4>English with Ms. Johnson</h4>
                                                <p>Essay Writing - Argumentative Structure</p>
                                            </div>
                                            <div class="session-status scheduled">
                                                <i class="fas fa-clock"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tutor-Specific Content -->
                    <div id="tutorDashRole" class="role-section hidden">
                        <div class="content-grid">
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-chalkboard-teacher"></i> My Students</h3>
                                    <button class="btn btn-sm btn-outline" onclick="showStudents()">Manage Students</button>
                                </div>
                                <div class="card-content">
                                    <div class="students-overview">
                                        <div class="student-item">
                                            <div class="student-avatar">
                                                <span>SM</span>
                                            </div>
                                            <div class="student-info">
                                                <h4>Sarah Mitchell</h4>
                                                <p>Mathematics  Grade 10</p>
                                                <div class="student-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill" style="width: 78%"></div>
                                                    </div>
                                                    <span class="progress-text">78% Progress</span>
                                                </div>
                                            </div>
                                            <div class="student-status">
                                                <span class="status-badge active">Active</span>
                                            </div>
                                        </div>
                                        <div class="student-item">
                                            <div class="student-avatar">
                                                <span>JD</span>
                                            </div>
                                            <div class="student-info">
                                                <h4>John Davis</h4>
                                                <p>Physics  Grade 11</p>
                                                <div class="student-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill" style="width: 65%"></div>
                                                    </div>
                                                    <span class="progress-text">65% Progress</span>
                                                </div>
                                            </div>
                                            <div class="student-status">
                                                <span class="status-badge active">Active</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-star"></i> Teaching Performance</h3>
                                </div>
                                <div class="card-content">
                                    <div class="performance-metrics">
                                        <div class="performance-item">
                                            <div class="performance-icon">
                                                <i class="fas fa-star"></i>
                                            </div>
                                            <div class="performance-info">
                                                <h4>Average Rating</h4>
                                                <div class="performance-value">4.8/5.0</div>
                                                <div class="performance-trend positive">
                                                    <i class="fas fa-arrow-up"></i> +0.2 this month
                                                </div>
                                            </div>
                                        </div>
                                        <div class="performance-item">
                                            <div class="performance-icon">
                                                <i class="fas fa-users"></i>
                                            </div>
                                            <div class="performance-info">
                                                <h4>Active Students</h4>
                                                <div class="performance-value">12</div>
                                                <div class="performance-trend positive">
                                                    <i class="fas fa-arrow-up"></i> +3 new this month
                                                </div>
                                            </div>
                                        </div>
                                        <div class="performance-item">
                                            <div class="performance-icon">
                                                <i class="fas fa-chart-line"></i>
                                            </div>
                                            <div class="performance-info">
                                                <h4>Student Success Rate</h4>
                                                <div class="performance-value">94%</div>
                                                <div class="performance-trend positive">
                                                    <i class="fas fa-arrow-up"></i> Above average
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-dollar-sign"></i> Earnings & Schedule</h3>
                                </div>
                                <div class="card-content">
                                    <div class="earnings-overview">
                                        <div class="earning-summary">
                                            <div class="earning-period">
                                                <span class="period-label">This Month</span>
                                                <span class="period-value" id="monthlyEarnings">$2,450</span>
                                            </div>
                                            <div class="earning-period">
                                                <span class="period-label">This Week</span>
                                                <span class="period-value" id="weeklyEarnings">$580</span>
                                            </div>
                                            <div class="earning-period">
                                                <span class="period-label">Next Payout</span>
                                                <span class="period-value">Dec 15</span>
                                            </div>
                                        </div>
                                        <div class="schedule-overview">
                                            <div class="schedule-item">
                                                <div class="schedule-time">Today</div>
                                                <div class="schedule-info">
                                                    <h4>3 Sessions</h4>
                                                    <p>2:00 PM, 4:00 PM, 6:00 PM</p>
                                                </div>
                                            </div>
                                            <div class="schedule-item">
                                                <div class="schedule-time">Tomorrow</div>
                                                <div class="schedule-info">
                                                    <h4>2 Sessions</h4>
                                                    <p>10:00 AM, 3:00 PM</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-book"></i> Teaching Resources</h3>
                                    <button class="btn btn-sm btn-outline" onclick="showResources()">Manage</button>
                                </div>
                                <div class="card-content">
                                    <div class="resources-list">
                                        <div class="resource-item">
                                            <div class="resource-icon">
                                                <i class="fas fa-file-pdf"></i>
                                            </div>
                                            <div class="resource-info">
                                                <h4>Algebra II Curriculum</h4>
                                                <p>Updated 2 days ago</p>
                                            </div>
                                            <div class="resource-usage">
                                                <span class="usage-count">Used 15 times</span>
                                            </div>
                                        </div>
                                        <div class="resource-item">
                                            <div class="resource-icon">
                                                <i class="fas fa-video"></i>
                                            </div>
                                            <div class="resource-info">
                                                <h4>Physics Lab Videos</h4>
                                                <p>Updated 1 week ago</p>
                                            </div>
                                            <div class="resource-usage">
                                                <span class="usage-count">Used 8 times</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Parent-Specific Content -->
                    <div id="parentDashRole" class="role-section hidden">
                        <div class="content-grid">
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-child"></i> My Children</h3>
                                    <button class="btn btn-sm btn-outline" onclick="addChild()">Add Child</button>
                                </div>
                                <div class="card-content">
                                    <div id="childrenProgress" class="children-list">
                                        <div class="child-item">
                                            <div class="child-avatar">
                                                <span>EJ</span>
                                            </div>
                                            <div class="child-info">
                                                <h4>Emma Johnson</h4>
                                                <p>Grade 9  Age 14</p>
                                                <div class="child-subjects">
                                                    <span class="subject-tag">Mathematics</span>
                                                    <span class="subject-tag">English</span>
                                                    <span class="subject-tag">Science</span>
                                                </div>
                                            </div>
                                            <div class="child-progress">
                                                <div class="progress-circle">
                                                    <svg viewBox="0 0 36 36">
                                                        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e5e7eb" stroke-width="2"/>
                                                        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#10b981" stroke-width="2" stroke-dasharray="75, 100"/>
                                                    </svg>
                                                    <div class="progress-text">75%</div>
                                                </div>
                                                <div class="progress-label">Overall Progress</div>
                                            </div>
                                            <div class="child-actions">
                                                <button class="btn btn-sm btn-outline">View Details</button>
                                            </div>
                                        </div>
                                        <div class="child-item">
                                            <div class="child-avatar">
                                                <span>MJ</span>
                                            </div>
                                            <div class="child-info">
                                                <h4>Michael Johnson</h4>
                                                <p>Grade 7  Age 12</p>
                                                <div class="child-subjects">
                                                    <span class="subject-tag">Mathematics</span>
                                                    <span class="subject-tag">History</span>
                                                </div>
                                            </div>
                                            <div class="child-progress">
                                                <div class="progress-circle">
                                                    <svg viewBox="0 0 36 36">
                                                        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e5e7eb" stroke-width="2"/>
                                                        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#3b82f6" stroke-width="2" stroke-dasharray="60, 100"/>
                                                    </svg>
                                                    <div class="progress-text">60%</div>
                                                </div>
                                                <div class="progress-label">Overall Progress</div>
                                            </div>
                                            <div class="child-actions">
                                                <button class="btn btn-sm btn-outline">View Details</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-calendar-check"></i> Upcoming Sessions</h3>
                                    <button class="btn btn-sm btn-outline" onclick="showSessions()">View All</button>
                                </div>
                                <div class="card-content">
                                    <div class="upcoming-sessions">
                                        <div class="session-item">
                                            <div class="session-child">
                                                <div class="child-avatar-small">EJ</div>
                                                <span>Emma</span>
                                            </div>
                                            <div class="session-details">
                                                <h4>Mathematics with Dr. Smith</h4>
                                                <p>Tomorrow  2:00 PM - 3:30 PM</p>
                                            </div>
                                            <div class="session-status">
                                                <span class="status-badge scheduled">Scheduled</span>
                                            </div>
                                        </div>
                                        <div class="session-item">
                                            <div class="session-child">
                                                <div class="child-avatar-small">MJ</div>
                                                <span>Michael</span>
                                            </div>
                                            <div class="session-details">
                                                <h4>History with Ms. Wilson</h4>
                                                <p>Friday  4:00 PM - 5:00 PM</p>
                                            </div>
                                            <div class="session-status">
                                                <span class="status-badge scheduled">Scheduled</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-chart-bar"></i> Family Learning Analytics</h3>
                                </div>
                                <div class="card-content">
                                    <div class="family-analytics">
                                        <div class="analytics-item">
                                            <div class="analytics-icon">
                                                <i class="fas fa-clock"></i>
                                            </div>
                                            <div class="analytics-info">
                                                <h4>Total Study Time</h4>
                                                <div class="analytics-value">24.5 hours</div>
                                                <div class="analytics-period">This week</div>
                                            </div>
                                        </div>
                                        <div class="analytics-item">
                                            <div class="analytics-icon">
                                                <i class="fas fa-graduation-cap"></i>
                                            </div>
                                            <div class="analytics-info">
                                                <h4>Average Progress</h4>
                                                <div class="analytics-value">67.5%</div>
                                                <div class="analytics-period">Across all subjects</div>
                                            </div>
                                        </div>
                                        <div class="analytics-item">
                                            <div class="analytics-icon">
                                                <i class="fas fa-star"></i>
                                            </div>
                                            <div class="analytics-info">
                                                <h4>Session Completion</h4>
                                                <div class="analytics-value">94%</div>
                                                <div class="analytics-period">Excellent attendance</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-credit-card"></i> Billing & Payments</h3>
                                    <button class="btn btn-sm btn-outline" onclick="showBilling()">Manage</button>
                                </div>
                                <div class="card-content">
                                    <div class="billing-overview">
                                        <div class="billing-summary">
                                            <div class="billing-item">
                                                <span class="billing-label">This Month</span>
                                                <span class="billing-value">$320</span>
                                            </div>
                                            <div class="billing-item">
                                                <span class="billing-label">Next Payment</span>
                                                <span class="billing-value">Dec 15, 2024</span>
                                            </div>
                                            <div class="billing-item">
                                                <span class="billing-label">Payment Method</span>
                                                <span class="billing-value"> 1234</span>
                                            </div>
                                        </div>
                                        <div class="billing-breakdown">
                                            <div class="breakdown-item">
                                                <span class="breakdown-child">Emma's Sessions</span>
                                                <span class="breakdown-amount">$180</span>
                                            </div>
                                            <div class="breakdown-item">
                                                <span class="breakdown-child">Michael's Sessions</span>
                                                <span class="breakdown-amount">$140</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="activity-section">
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-history"></i> Recent Activity</h3>
                                <button class="btn btn-sm btn-outline">View All</button>
                            </div>
                            <div class="card-content">
                                <div class="activity-timeline" id="recentActivity">
                                    <div class="activity-item">
                                        <div class="activity-icon success">
                                            <i class="fas fa-check"></i>
                                        </div>
                                        <div class="activity-content">
                                            <h4>Session Completed</h4>
                                            <p>Mathematics session with Dr. Smith</p>
                                            <span class="activity-time">2 hours ago</span>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon info">
                                            <i class="fas fa-calendar"></i>
                                        </div>
                                        <div class="activity-content">
                                            <h4>Session Scheduled</h4>
                                            <p>English Literature for tomorrow</p>
                                            <span class="activity-time">1 day ago</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Insights -->
                    <div class="insights-section">
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-brain"></i> AI Performance Insights</h3>
                                <div class="insight-badge">
                                    <i class="fas fa-robot"></i> Powered by AI
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="insights-grid">
                                    <div class="insight-item">
                                        <div class="insight-icon">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                        <div class="insight-content">
                                            <h4>Learning Velocity</h4>
                                            <div class="insight-value" id="learningVelocity">+15%</div>
                                            <p>Your learning pace has improved significantly this month</p>
                                        </div>
                                    </div>
                                    <div class="insight-item">
                                        <div class="insight-icon">
                                            <i class="fas fa-bullseye"></i>
                                        </div>
                                        <div class="insight-content">
                                            <h4>Focus Score</h4>
                                            <div class="insight-value" id="focusScore">8.5/10</div>
                                            <p>Excellent concentration during sessions</p>
                                        </div>
                                    </div>
                                    <div class="insight-item">
                                        <div class="insight-icon">
                                            <i class="fas fa-lightbulb"></i>
                                        </div>
                                        <div class="insight-content">
                                            <h4>Concept Mastery</h4>
                                            <div class="insight-value" id="conceptMastery">87%</div>
                                            <p>Strong understanding of core concepts</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Achievement Badges -->
                    <div class="achievements-section">
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-trophy"></i> Recent Achievements</h3>
                                <button class="btn btn-sm btn-outline">View All</button>
                            </div>
                            <div class="card-content">
                                <div class="achievements-grid">
                                    <div class="achievement-badge earned">
                                        <div class="badge-icon">
                                            <i class="fas fa-medal"></i>
                                        </div>
                                        <div class="badge-info">
                                            <h4>First Steps</h4>
                                            <p>Completed your first session</p>
                                            <span class="badge-date">Earned 2 days ago</span>
                                        </div>
                                    </div>
                                    <div class="achievement-badge earned">
                                        <div class="badge-icon">
                                            <i class="fas fa-fire"></i>
                                        </div>
                                        <div class="badge-info">
                                            <h4>Streak Master</h4>
                                            <p>7-day learning streak</p>
                                            <span class="badge-date">Earned today</span>
                                        </div>
                                    </div>
                                    <div class="achievement-badge locked">
                                        <div class="badge-icon">
                                            <i class="fas fa-graduation-cap"></i>
                                        </div>
                                        <div class="badge-info">
                                            <h4>Scholar</h4>
                                            <p>Complete 25 sessions</p>
                                            <span class="badge-progress">Progress: 12/25</span>
                                        </div>
                                    </div>
                                    <div class="achievement-badge locked">
                                        <div class="badge-icon">
                                            <i class="fas fa-crown"></i>
                                        </div>
                                        <div class="badge-info">
                                            <h4>Learning Champion</h4>
                                            <p>Complete 100 sessions</p>
                                            <span class="badge-progress">Progress: 12/100</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications & Alerts -->
                    <div class="notifications-section">
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-bell"></i> Notifications</h3>
                                <div class="notification-count">3</div>
                            </div>
                            <div class="card-content">
                                <div class="notifications-list">
                                    <div class="notification-item unread">
                                        <div class="notification-icon info">
                                            <i class="fas fa-calendar-check"></i>
                                        </div>
                                        <div class="notification-content">
                                            <h4>Session Reminder</h4>
                                            <p>Your Mathematics session starts in 30 minutes</p>
                                            <span class="notification-time">30 min ago</span>
                                        </div>
                                        <div class="notification-action">
                                            <button class="btn btn-sm btn-primary">Join</button>
                                        </div>
                                    </div>
                                    <div class="notification-item">
                                        <div class="notification-icon success">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <div class="notification-content">
                                            <h4>New Achievement</h4>
                                            <p>You've earned the "Streak Master" badge!</p>
                                            <span class="notification-time">2 hours ago</span>
                                        </div>
                                    </div>
                                    <div class="notification-item">
                                        <div class="notification-icon warning">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <div class="notification-content">
                                            <h4>Payment Due</h4>
                                            <p>Your subscription renewal is due in 3 days</p>
                                            <span class="notification-time">1 day ago</span>
                                        </div>
                                        <div class="notification-action">
                                            <button class="btn btn-sm btn-outline">Pay Now</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions-section">
                        <div class="card">
                            <div class="card-header">
                                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                            </div>
                            <div class="card-content">
                                <div class="quick-actions-grid">
                                    <button class="quick-action-btn" onclick="showTutors()">
                                        <i class="fas fa-search"></i>
                                        <span>Find Tutors</span>
                                    </button>
                                    <button class="quick-action-btn" onclick="showSessions()">
                                        <i class="fas fa-calendar-plus"></i>
                                        <span>Book Session</span>
                                    </button>
                                    <button class="quick-action-btn" onclick="showProfile()">
                                        <i class="fas fa-user-edit"></i>
                                        <span>Edit Profile</span>
                                    </button>
                                    <button class="quick-action-btn" onclick="showSettings()">
                                        <i class="fas fa-cog"></i>
                                        <span>Settings</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Tutors Page -->
        <div id="tutorsPage" class="page hidden">
            <div class="container">
                <!-- Professional Header -->
                <div class="tutors-header">
                    <div class="header-content">
                        <h2><i class="fas fa-search"></i> Find Your Perfect Tutor</h2>
                        <p>AI-powered matching to connect you with the best tutors for your learning goals</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-outline" onclick="showTutorMatchingWizard()">
                            <i class="fas fa-magic"></i> AI Matching
                        </button>
                    </div>
                </div>

                <!-- Advanced Search & Filters -->
                <div class="search-filters-section">
                    <div class="search-bar">
                        <div class="search-input-group">
                            <i class="fas fa-search"></i>
                            <input type="text" id="tutorSearch" placeholder="Search tutors by name, subject, or expertise..." />
                            <button class="btn btn-primary" onclick="searchTutors()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="filters-row">
                        <div class="filter-group">
                            <label>Subject</label>
                            <select id="subjectFilter" onchange="filterTutors()">
                                <option value="">All Subjects</option>
                                <option value="mathematics">Mathematics</option>
                                <option value="science">Science</option>
                                <option value="english">English</option>
                                <option value="history">History</option>
                                <option value="computer_science">Computer Science</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Experience Level</label>
                            <select id="experienceFilter" onchange="filterTutors()">
                                <option value="">Any Experience</option>
                                <option value="1-2">1-2 years</option>
                                <option value="3-5">3-5 years</option>
                                <option value="5+">5+ years</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Rating</label>
                            <select id="ratingFilter" onchange="filterTutors()">
                                <option value="">Any Rating</option>
                                <option value="4.5+">4.5+ Stars</option>
                                <option value="4.0+">4.0+ Stars</option>
                                <option value="3.5+">3.5+ Stars</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Price Range</label>
                            <select id="priceFilter" onchange="filterTutors()">
                                <option value="">Any Price</option>
                                <option value="0-25">$0 - $25/hr</option>
                                <option value="25-50">$25 - $50/hr</option>
                                <option value="50+">$50+/hr</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Availability</label>
                            <select id="availabilityFilter" onchange="filterTutors()">
                                <option value="">Any Time</option>
                                <option value="morning">Morning (6AM-12PM)</option>
                                <option value="afternoon">Afternoon (12PM-6PM)</option>
                                <option value="evening">Evening (6PM-12AM)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-actions">
                        <button class="btn btn-outline" onclick="clearFilters()">
                            <i class="fas fa-times"></i> Clear Filters
                        </button>
                        <button class="btn btn-primary" onclick="applyFilters()">
                            <i class="fas fa-filter"></i> Apply Filters
                        </button>
                    </div>
                </div>

                <!-- Results Summary -->
                <div class="results-summary">
                    <div class="summary-stats">
                        <span id="tutorCount">0</span> tutors found
                        <span class="separator"></span>
                        <span id="avgRating">0.0</span> average rating
                        <span class="separator"></span>
                        <span id="avgPrice">$0</span> average price
                    </div>
                    <div class="view-options">
                        <button class="view-toggle active" onclick="setViewMode('grid')" data-view="grid">
                            <i class="fas fa-th"></i>
                        </button>
                        <button class="view-toggle" onclick="setViewMode('list')" data-view="list">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>

                <!-- Tutors Grid/List -->
                <div id="tutorsContainer" class="tutors-content">
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Finding the best tutors for you...</p>
                    </div>
                </div>

                <!-- Load More Button -->
                <div class="load-more-section">
                    <button class="btn btn-outline btn-lg" id="loadMoreBtn" onclick="loadMoreTutors()" style="display: none;">
                        <i class="fas fa-plus"></i> Load More Tutors
                    </button>
                        </div>
                    </div>
                </div>

        <!-- Sessions Page -->
        <div id="sessionsPage" class="page hidden">
            <div class="container">
                <div class="sessions-header">
                    <h2>My Sessions</h2>
                    <p>Manage your tutoring sessions</p>
                </div>
                <div id="sessionsContainer" class="sessions-content">
                    <!-- Sessions content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profilePage" class="page hidden">
            <div class="container">
                <div class="profile-header">
                    <h2>My Profile</h2>
                    <p>View and manage your profile information</p>
                </div>
                <div id="profileContainer" class="profile-content">
                    <!-- Profile content will be loaded here -->
                </div>
            </div>
                </div>

        <!-- Profile Setup Page -->
        <div id="profileSetupPage" class="page hidden">
            <div class="container">
                <div class="profile-setup-header">
                    <div class="setup-header-content">
                        <div class="setup-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z" fill="currentColor"/>
                                <path d="M12 14C7.58172 14 4 17.5817 4 22H20C20 17.5817 16.4183 14 12 14Z" fill="currentColor"/>
                            </svg>
                        </div>
                        <h2>Complete Your Profile</h2>
                        <p>Tell us about yourself to personalize your learning experience</p>
                    </div>
                </div>

                <div class="profile-setup-content">
                    <!-- Learner Profile Card -->
                    <div class="setup-card learner-card">
                        <div class="card-header">
                            <div class="card-icon learner-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                    <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                    <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3>Student Profile</h3>
                            <p>Set up your learning preferences and academic goals</p>
                        </div>
                        <div class="card-body">
                            <form id="learnerProfileForm" class="setup-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="learnerAge" class="form-label">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z" fill="currentColor"/>
                                                <path d="M12 14C7.58172 14 4 17.5817 4 22H20C20 17.5817 16.4183 14 12 14Z" fill="currentColor"/>
                                            </svg>
                                            Age
                                        </label>
                                        <input type="number" id="learnerAge" class="form-input" min="5" max="25" placeholder="Enter your age">
                                    </div>
                                    <div class="form-group">
                                        <label for="learnerGrade" class="form-label">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M6.5 2H20V22H6.5A2.5 2.5 0 0 1 4 19.5V4.5A2.5 2.5 0 0 1 6.5 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                            Grade Level
                                        </label>
                                        <select id="learnerGrade" class="form-select">
                                            <option value="">Select Grade</option>
                                            <option value="Grade 8">Grade 8</option>
                                            <option value="Grade 9">Grade 9</option>
                                            <option value="Grade 10">Grade 10</option>
                                            <option value="Grade 11">Grade 11</option>
                                            <option value="Grade 12">Grade 12</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="learnerSubjects" class="form-label">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 3H6C6.55228 3 7 3.44772 7 4V20C7 20.5523 6.55228 21 6 21H2C1.44772 21 1 20.5523 1 20V4C1 3.44772 1.44772 3 2 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M7 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M7 12H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M7 16H11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Preferred Subjects
                                    </label>
                                    <input type="text" id="learnerSubjects" class="form-input" placeholder="Math, Science, English, History...">
                                </div>

                                <div class="form-group">
                                    <label for="learnerGoals" class="form-label">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Learning Goals
                                    </label>
                                    <textarea id="learnerGoals" class="form-textarea" placeholder="What do you want to achieve? (e.g., improve math skills, prepare for exams, learn new subjects)"></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary btn-large">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Create Student Profile
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Tutor Profile Card -->
                    <div class="setup-card tutor-card">
                        <div class="card-header">
                            <div class="card-icon tutor-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                    <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                    <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3>Tutor Profile</h3>
                            <p>Share your expertise and teaching experience</p>
                        </div>
                        <div class="card-body">
                            <form id="tutorProfileForm" class="setup-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="tutorExperience" class="form-label">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z" fill="currentColor"/>
                                            </svg>
                                            Years of Experience
                                        </label>
                                        <input type="number" id="tutorExperience" class="form-input" min="0" max="50" placeholder="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="tutorRate" class="form-label">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M12 1V23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M17 5H9.5C8.11929 5 7 6.11929 7 7.5S8.11929 10 9.5 10H14.5C15.8807 10 17 11.1193 17 12.5S15.8807 15 14.5 15H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                            Hourly Rate ($)
                                        </label>
                                        <input type="number" id="tutorRate" class="form-input" min="0" step="0.01" placeholder="25.00">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="tutorSubjects" class="form-label">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 3H6C6.55228 3 7 3.44772 7 4V20C7 20.5523 6.55228 21 6 21H2C1.44772 21 1 20.5523 1 20V4C1 3.44772 1.44772 3 2 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M7 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M7 12H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M7 16H11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Subjects You Teach
                                    </label>
                                    <input type="text" id="tutorSubjects" class="form-input" placeholder="Mathematics, Physics, Chemistry, Biology...">
                                </div>

                                <div class="form-group">
                                    <label for="tutorSpecialties" class="form-label">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Teaching Specialties
                                    </label>
                                    <textarea id="tutorSpecialties" class="form-textarea" placeholder="Describe your teaching approach, specializations, or unique methods..."></textarea>
                                </div>

                                <div class="form-group">
                                    <label for="tutorAvailability" class="form-label">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M21 10C21 17 12 23 12 23S3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Availability
                                    </label>
                                    <select id="tutorAvailability" class="form-select">
                                        <option value="">Select Availability</option>
                                        <option value="weekdays">Weekdays Only</option>
                                        <option value="weekends">Weekends Only</option>
                                        <option value="flexible">Flexible Schedule</option>
                                        <option value="evenings">Evenings Only</option>
                                    </select>
                                </div>

                                <button type="submit" class="btn btn-primary btn-large">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Create Tutor Profile
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Parent Profile Card -->
                    <div class="setup-card parent-card">
                        <div class="card-header">
                            <div class="card-icon parent-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3>Parent Profile</h3>
                            <p>Manage your children's learning journey</p>
                        </div>
                        <div class="card-body">
                            <form id="parentProfileForm" class="setup-form">
                                <div class="form-group">
                                    <label for="parentPhone" class="form-label">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M22 16.92V19.92C22.0011 20.1985 21.9441 20.4742 21.8325 20.7293C21.7209 20.9845 21.5573 21.2136 21.3521 21.4019C21.1468 21.5901 20.9046 21.7335 20.6407 21.8227C20.3769 21.9119 20.0974 21.9451 19.82 21.92C16.7428 21.5856 13.787 20.5341 11.19 18.85C8.77382 17.3147 6.72533 15.2662 5.19 12.85C3.49997 10.2412 2.44824 7.27099 2.12 4.18C2.095 3.90347 2.12787 3.62476 2.21649 3.36162C2.30512 3.09849 2.44756 2.85669 2.63476 2.65162C2.82196 2.44655 3.0498 2.28271 3.30379 2.17052C3.55777 2.05833 3.83233 2.00026 4.11 2H7.11C7.59531 1.99522 8.06622 2.16708 8.43376 2.48353C8.8013 2.79999 9.04207 3.23945 9.11 3.72C9.23662 4.68007 9.47144 5.62273 9.81 6.53C9.94454 6.88792 9.97366 7.27691 9.89391 7.65088C9.81415 8.02485 9.62886 8.36811 9.36 8.64L8.09 9.91C9.51355 12.4135 11.5865 14.4864 14.09 15.91L15.36 14.64C15.6319 14.3711 15.9751 14.1858 16.3491 14.1061C16.7231 14.0263 17.1121 14.0555 17.47 14.19C18.3773 14.5286 19.3199 14.7634 20.28 14.89C20.7658 14.9585 21.2094 15.2032 21.5265 15.5775C21.8437 15.9518 22.0122 16.4296 22 16.92Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Phone Number
                                    </label>
                                    <input type="tel" id="parentPhone" class="form-input" placeholder="+1 (555) 123-4567">
                                </div>

                                <div class="form-group">
                                    <label for="parentAddress" class="form-label">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M21 10C21 17 12 23 12 23S3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Address
                                    </label>
                                    <input type="text" id="parentAddress" class="form-input" placeholder="123 Main Street, City, State 12345">
                                </div>

                                <div class="form-group">
                                    <label for="parentEmergencyContact" class="form-label">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Emergency Contact
                                    </label>
                                    <input type="text" id="parentEmergencyContact" class="form-input" placeholder="Emergency contact name and phone">
                                </div>

                                <div class="form-group">
                                    <label for="parentNotes" class="form-label">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M14 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M10 9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Additional Notes
                                    </label>
                                    <textarea id="parentNotes" class="form-textarea" placeholder="Any special requirements, preferences, or notes about your children's learning needs..."></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary btn-large">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Create Parent Profile
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Linked Learners Modal -->
        <div id="manageLearnersModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Manage Linked Learners</h3>
                    <button class="modal-close" onclick="toggleManageLearners(false)">&times;</button>
                </div>
                <div class="modal-body" style="padding:1.5rem">
                    <div class="form-group">
                        <label>Current Learners</label>
                        <div id="mlList" style="display:flex;gap:.5rem;flex-wrap:wrap"></div>
                    </div>
                    <div class="form-group">
                        <label>Add Learner Emails (comma separated)</label>
                        <input id="mlAdd" placeholder="child1@example.com, child2@example.com">
                    </div>
                </div>
                <div class="modal-footer" style="padding:0 1.5rem 1.5rem;display:flex;gap:.5rem;justify-content:flex-end">
                    <button class="btn btn-secondary" onclick="toggleManageLearners(false)">Close</button>
                    <button class="btn btn-primary" onclick="mlAddLearners()">Add</button>
                </div>
            </div>
        </div>

        <script>
        function toggleManageLearners(show){
            const m=document.getElementById('manageLearnersModal');
            m.classList.toggle('active', !!show);
            if(show){ mlRefresh(); }
        }
        async function mlRefresh(){
            const token = localStorage.getItem('aura_token'); if(!token) return;
            const auth = { 'Authorization':'Bearer '+token, 'Content-Type':'application/json' };
            const res = await fetch('/api/parent/linked-learners',{headers:auth}).then(r=>r.ok?r.json():{linked_learners:[]});
            const box = document.getElementById('mlList');
            box.innerHTML = (res.linked_learners||[]).map(e=>`<span class='mini-action'>${e}<a href='#' onclick=\"mlRemove('${e}')\" style='margin-left:.5rem;color:#ef4444'>Remove</a></span>`).join('')||'<span class="dash-sub">No learners linked</span>';
        }
        async function mlAddLearners(){
            const token = localStorage.getItem('aura_token'); if(!token) return;
            const emails = (document.getElementById('mlAdd').value||'').split(',').map(s=>s.trim()).filter(Boolean);
            if(!emails.length) return;
            await fetch('/api/parent/linked-learners',{method:'POST', headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'}, body: JSON.stringify(emails)});
            document.getElementById('mlAdd').value='';
            await mlRefresh();
            showMessage('Learners added','success');
            // Refresh dashboard summary
            if(typeof showDashboard==='function') showDashboard();
        }
        async function mlRemove(email){
            const token = localStorage.getItem('aura_token'); if(!token) return;
            await fetch('/api/parent/linked-learners',{method:'DELETE', headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'}, body: JSON.stringify([email])});
            await mlRefresh();
            showMessage('Learner removed','success');
            if(typeof showDashboard==='function') showDashboard();
        }
        </script>

        <script>
        (function(){
            // Replace learner quick actions to include manage learners for parent
            const header = document.querySelector('.dashboard-header');
            if(header){
                const manageBtn = document.createElement('button');
                manageBtn.className='mini-action';
                manageBtn.innerHTML = "<i class='fas fa-users'></i> Manage Learners";
                manageBtn.onclick = ()=> toggleManageLearners(true);
                // attach only for parent dashboard when present
                const attach = ()=>{
                    const dash = document.getElementById('parentDashRole');
                    if(dash && !dash.classList.contains('hidden')){
                        if(!document.getElementById('quickManage')){
                            manageBtn.id='quickManage';
                            document.getElementById('quickActions')?.appendChild(manageBtn);
                        }
                    }
                };
                const obs = new MutationObserver(attach); obs.observe(document.body,{attributes:true,subtree:true});
                attach();
            }
        })();
        </script>
    </main>

    <!-- Billing Modal -->
    <div id="billingModal" class="modal">
        <div class="modal-content" style="max-width:640px">
            <div class="modal-header">
                <h3 class="modal-title">Billing Summary</h3>
                <button class="modal-close" onclick="document.getElementById('billingModal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body" style="padding:1.5rem">
                <div id="billingSummary">
                    <p class="dash-sub">Loading billing info...</p>
                </div>
            </div>
            <div class="modal-footer" style="padding:0 1.5rem 1.5rem;display:flex;gap:.5rem;justify-content:flex-end">
                <button class="btn btn-secondary" onclick="document.getElementById('billingModal').classList.remove('active')">Close</button>
            </div>
        </div>
    </div>

    <script>
    async function loadBillingSummary(){
        const box = document.getElementById('billingSummary');
        try{
            const res = await apiCall('/api/billing/summary');
            if(!res.ok){ box.innerHTML = '<p class="dash-sub">No billing data found.</p>'; return; }
            const data = await res.json();
            box.innerHTML = `
                <div class="dashboard-grid">
                    <div class="stat-card"><div><div class="stat-value">$${(data.total_due||0).toFixed(2)}</div><div class="stat-label">Total Due</div></div></div>
                    <div class="stat-card"><div><div class="stat-value">$${(data.paid_this_month||0).toFixed(2)}</div><div class="stat-label">Paid This Month</div></div></div>
                    <div class="stat-card"><div><div class="stat-value">${data.invoices_count||0}</div><div class="stat-label">Invoices</div></div></div>
                </div>
            `;
        }catch(e){
            box.innerHTML = '<p class="dash-sub">Failed to load billing.</p>';
        }
    }
    </script>

    <!-- Book Session Modal -->
    <div id="bookSessionModal" class="modal">
        <div class="modal-content" style="max-width:760px">
            <div class="modal-header" style="background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:#fff">
                <h3 class="modal-title"><i class="fas fa-calendar-plus"></i> Book a Session</h3>
                <button class="modal-close" onclick="document.getElementById('bookSessionModal').classList.remove('active')" style="color:#fff">&times;</button>
            </div>
            <div class="modal-body" style="padding:1.5rem">
                <div class="card" style="margin-bottom:1rem;background:rgba(255,255,255,0.6);backdrop-filter:blur(8px)">
                    <div class="card-body" style="display:flex;gap:1rem;align-items:center">
                        <div class="tutor-avatar" style="width:52px;height:52px;display:flex;align-items:center;justify-content:center;background:var(--primary-color);color:#fff;border-radius:14px"><span id="bsInitials">TN</span></div>
                        <div>
                            <div id="bsTutorName" style="font-weight:700;font-size:1.05rem">Tutor Name</div>
                            <div id="bsTutorStats" class="dash-sub"></div>
                        </div>
                        <div style="margin-left:auto;font-weight:700" id="bsTutorRate">$0/hr</div>
                    </div>
                </div>
                <div class="form-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">
                    <div class="form-group" id="bsLearnerGroup" style="display:none">
                        <label>For Learner (parent)</label>
                        <select id="bsLearner"><option value="">Select child</option></select>
                    </div>
                    <div class="form-group">
                        <label>Subject</label>
                        <select id="bsSubject"></select>
                    </div>
                    <div class="form-group">
                        <label>Grade / Level</label>
                        <select id="bsGrade"><option value="">Select grade</option></select>
                    </div>
                    <div class="form-group">
                        <label>Duration</label>
                        <div style="display:flex;gap:.5rem;flex-wrap:wrap">
                            <button class="mini-action duration-chip" data-val="30">30m</button>
                            <button class="mini-action duration-chip" data-val="45">45m</button>
                            <button class="mini-action duration-chip" data-val="60">60m</button>
                            <button class="mini-action duration-chip" data-val="90">90m</button>
                        </div>
                        <select id="bsDuration" style="margin-top:.5rem">
                            <option value="30">30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60" selected>60 minutes</option>
                            <option value="90">90 minutes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="bsDate">
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="bsTime">
                    </div>
                    <div class="form-group" style="grid-column:1/-1">
                        <label>Notes (optional)</label>
                        <textarea id="bsNotes" class="form-textarea" placeholder="Share goals or preferences for this session"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding:0 1.5rem 1.5rem;display:flex;gap:.5rem;justify-content:flex-end">
                <button class="btn btn-secondary" onclick="document.getElementById('bookSessionModal').classList.remove('active')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmBooking()"><i class="fas fa-check"></i> Confirm Booking</button>
            </div>
        </div>
    </div>

    <script>
    async function confirmBooking(){
        if(!bookingContext.tutor){ showMessage('Missing tutor info','error'); return; }
        const subject = document.getElementById('bsSubject').value;
        const date = document.getElementById('bsDate').value;
        const time = document.getElementById('bsTime').value;
        const duration = parseInt(document.getElementById('bsDuration').value||'60',10);
        if(!subject || !date || !time){ showMessage('Please fill subject, date and time','error'); return; }
        const scheduledStart = new Date(`${date}T${time}`);
        if(isNaN(scheduledStart.getTime())){ showMessage('Invalid date/time','error'); return; }
        if(scheduledStart.getTime() < Date.now()){ showMessage('Please choose a future date/time','error'); return; }
        try{
            const payload = {
                tutor_id: bookingContext.tutor.id,
                subject,
                grade: document.getElementById('bsGrade').value || null,
                scheduled_start: scheduledStart.toISOString(),
                duration_minutes: duration,
                notes: document.getElementById('bsNotes').value||''
            };
            // Attach learner reference depending on role (support id, email, name)
            if(currentUser){
                if(currentUser.role==='learner'){
                    payload.learner_id = currentUser.id;
                    if(currentUser.email) payload.learner_email = currentUser.email;
                    if(currentUser.full_name) payload.learner_name = currentUser.full_name;
                }
                if(currentUser.role==='parent'){
                    const learnerSel = document.getElementById('bsLearner');
                    const childVal = learnerSel.value;
                    if(!childVal){ showMessage('Please select a child','error'); return; }
                    const opt = learnerSel.options[learnerSel.selectedIndex];
                    const nameGuess = opt && opt.textContent ? (opt.textContent.includes('(') ? opt.textContent.split('(')[0].trim() : undefined) : undefined;
                    if(childVal.startsWith('id:')) payload.learner_id = childVal.slice(3);
                    else if(childVal.startsWith('email:')) payload.learner_email = childVal.slice(6);
                    else {
                        // fallback treat as email
                        payload.learner_email = childVal;
                    }
                    if(nameGuess) payload.learner_name = nameGuess;
                }
            }
            // Provide alternative aliases so backend can map any
            if(payload.learner_id) payload.student_id = payload.learner_id;
            if(payload.learner_email) payload.student_email = payload.learner_email;
            if(payload.learner_name) payload.student_name = payload.learner_name;
            // Also include nested learner object for convenience
            payload.learner = {
                id: payload.learner_id || undefined,
                email: payload.learner_email || undefined,
                name: payload.learner_name || undefined
            };
            async function tryBook(ep, body){
                return apiCall(ep,{ method:'POST', body: JSON.stringify(body) });
            }
            // Single authoritative endpoint to avoid 404 churn
            const response = await tryBook('/api/sessions/book', payload);
            if(response.ok){
                const data = await response.json();
                document.getElementById('bookSessionModal').classList.remove('active');
                showMessage(`Session booked! ID: ${data.session_id}`,'success');
                if(typeof loadSessions==='function') loadSessions();
            } else {
                let detail = '';
                try {
                    const j = await response.json();
                    if (typeof j === 'string') detail = j;
                    else if (Array.isArray(j)) detail = JSON.stringify(j);
                    else if (j && typeof j === 'object') detail = j.detail ? (typeof j.detail==='string'? j.detail : JSON.stringify(j.detail)) : JSON.stringify(j);
                } catch {
                    try { detail = await response.text(); } catch { detail = ''; }
                }
                const msg = detail ? `Failed to book: ${detail}` : `Failed to book session (${response.status} ${response.statusText})`;
                console.error('Booking failed', {status: response.status, statusText: response.statusText, payload, detail});
                showMessage(msg,'error');
            }
        }catch(e){
            showMessage('Network error while booking','error');
        }
    }
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo" style="margin-bottom: 1.5rem;">
                        <div class="logo-icon">
                            <i class="fas fa-graduation-cap"></i>
                            </div>
                        Learn Optima
                        </div>
                    <p style="color: var(--gray-400); line-height: 1.6;">
                        Transforming education through AI-powered, culturally-aware tutoring. Connecting students with expert tutors worldwide.
                    </p>
                    </div>

                <div class="footer-section">
                    <h3>Platform</h3>
                    <ul class="footer-links">
                        <li><a href="#" onclick="showTutors()">Find Tutors</a></li>
                        <li><a href="#" onclick="showPricing()">Pricing</a></li>
                        <li><a href="#" onclick="showRegister()">Become a Tutor</a></li>
                        <li><a href="#">Mobile App</a></li>
                    </ul>
                            </div>
                
                <div class="footer-section">
                    <h3>Company</h3>
                    <ul class="footer-links">
                        <li><a href="#" onclick="showAbout()">About Us</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Blog</a></li>
                        <li><a href="#" onclick="showContact()">Contact</a></li>
                    </ul>
                        </div>
                
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Safety</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                    </div>
                </div>
            
            <div class="footer-bottom">
                <div class="social-links">
                    <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
            </div>
                <p>&copy; 2024 Learn Optima. All rights reserved.</p>
        </div>
    </div>
    </footer>

    <!-- Message Container -->
    <div id="messageContainer" class="message-container"></div>

    <script>
        // Global State
        let currentUser = null;
        let currentPage = 'home';
        let authToken = localStorage.getItem('authToken');
        
        // Tutor Management Variables
        let allTutors = [];
        let filteredTutors = [];
        let currentViewMode = 'grid';
        let tutorsCurrentPage = 1;
        const tutorsPerPage = 12;
        
        // API Configuration
        const API_BASE = 'http://localhost:8000';
        
        // Utility Functions
        function showMessage(message, type = 'error') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
        
        async function apiCall(endpoint, options = {}) {
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                },
                ...options
            };
            
            if (authToken) {
                config.headers.Authorization = `Bearer ${authToken}`;
            }
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, config);
                
                // Handle 401 Unauthorized
                if (response.status === 401) {
                    // Clear invalid token
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('currentUser');
                    authToken = null;
                    currentUser = null;
                    
                    // Update UI
                    document.getElementById('authButtons').classList.remove('hidden');
                    document.getElementById('userMenu').classList.add('hidden');
                    
                    // Redirect to login
                    showLogin();
                    showMessage('Session expired. Please login again.', 'error');
                    return response;
                }
                
                return response;
            } catch (error) {
                console.error('API call error:', error);
                showMessage('Network error. Please try again.', 'error');
                throw error;
            }
        }
        
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase();
        }
        
        function updateActiveNavLink(pageId) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const activeLink = document.querySelector(`[onclick="show${pageId.charAt(0).toUpperCase() + pageId.slice(1)}()"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }
        
        // Page Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
            currentPage = pageId.replace('Page', '');
            updateActiveNavLink(currentPage);
        }
        
        function showHome() {
            showPage('homePage');
        }
        
        function showAbout() {
            showPage('aboutPage');
        }
        
        function showPricing() {
            showPage('pricingPage');
        }
        
        function showContact() {
            showPage('contactPage');
        }
        
        function showTutors() {
            showPage('tutorsPage');
            loadTutors();
        }

        function showLogin() {
            showPage('loginPage');
            // Initialize password visual feedback
            addPasswordVisualFeedback('loginPassword');
        }

        function showRegister() {
            showPage('registerPage');
            // Initialize password visual feedback
            addPasswordVisualFeedback('wPassword');
        }

        function showDashboard() {
            if (!requireAuth()) {
                return;
            }
            showPage('dashboardPage');
            loadDashboard();
        }

        function showSessions() {
            if (!requireAuth()) {
                return;
            }
            showPage('sessionsPage');
            loadSessions();
        }
        
        function showProfile() {
            if (!requireAuth()) {
                return;
            }
            showPage('profilePage');
            loadProfile();
        }
        
        function showProfileSetup() {
            showPage('profileSetupPage');
        }
        
        async function loadProfile() {
            if (!currentUser) return;
            
            try {
                const response = await apiCall('/api/users/me');
                if (response.ok) {
                    const userData = await response.json();
                    displayProfile(userData);
                } else {
                    showMessage('Failed to load profile', 'error');
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                showMessage('Failed to load profile', 'error');
            }
        }
        
        function displayProfile(userData) {
            const profileContainer = document.getElementById('profileContainer');
            if (!profileContainer) return;
            
            profileContainer.innerHTML = `
                <div class="profile-card">
                    <h3>Profile Information</h3>
                    <p><strong>Name:</strong> ${userData.full_name}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Role:</strong> ${userData.role}</p>
                    <p><strong>Member since:</strong> ${new Date(userData.created_at).toLocaleDateString()}</p>
                </div>
            `;
        }
        
        // User Menu
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const userMenu = document.getElementById('userMenu');
            const dropdown = document.getElementById('userDropdown');
            
            if (userMenu && !userMenu.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Authentication Functions
        function updateUIForAuthenticatedUser() {
            // Hide login/register buttons
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userMenu').classList.remove('hidden');
            document.getElementById('userInitials').textContent = getInitials(currentUser.full_name);
            
            // Update user type specific UI
            if (currentUser.user_type === 'parent') {
                document.getElementById('parentDashboard').classList.remove('hidden');
                document.getElementById('tutorDashboard').classList.add('hidden');
                document.getElementById('learnerDashboard').classList.add('hidden');
            } else if (currentUser.user_type === 'tutor') {
                document.getElementById('tutorDashboard').classList.remove('hidden');
                document.getElementById('parentDashboard').classList.add('hidden');
                document.getElementById('learnerDashboard').classList.add('hidden');
            } else if (currentUser.user_type === 'learner') {
                document.getElementById('learnerDashboard').classList.remove('hidden');
                document.getElementById('parentDashboard').classList.add('hidden');
                document.getElementById('tutorDashboard').classList.add('hidden');
            }
            
            // Show appropriate dashboard content
            showDashboard();
        }
        
        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            
            // Reset UI to logged out state
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userMenu').classList.add('hidden');
            
            // Hide all dashboard types
            document.getElementById('parentDashboard').classList.add('hidden');
            document.getElementById('tutorDashboard').classList.add('hidden');
            document.getElementById('learnerDashboard').classList.add('hidden');
            
            showHome();
            showMessage('Logged out successfully', 'success');
        }
        
        // Helper function to check if user is authenticated
        function isAuthenticated() {
            return currentUser && authToken;
        }
        
        // Helper function to require authentication
        function requireAuth(action) {
            if (!isAuthenticated()) {
                showLogin();
                showMessage('Please log in to continue', 'error');
                return false;
            }
            return true;
        }
        
        // Form Event Listeners
        function setupFormEventListeners() {
            const contactForm = document.getElementById('contactForm');
            if (contactForm) {
                contactForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    showMessage('Thank you for your message! We\'ll get back to you soon.', 'success');
                    e.target.reset();
                });
            }
            
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const email = document.getElementById('loginEmail').value;
                    const password = document.getElementById('loginPassword').value;
                    loginUser(email, password);
                });
            }
            
        }
        
        // Profile Setup Form Event Listeners
        function setupProfileFormEventListeners() {
            const learnerProfileForm = document.getElementById('learnerProfileForm');
            if (learnerProfileForm) {
                learnerProfileForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const profileData = {
                        age: parseInt(document.getElementById('learnerAge').value),
                        grade_level: document.getElementById('learnerGrade').value,
                        preferred_subjects: document.getElementById('learnerSubjects').value.split(',').map(s => s.trim())
                    };
                    createLearnerProfile(profileData);
                });
            }
            
            const tutorProfileForm = document.getElementById('tutorProfileForm');
            if (tutorProfileForm) {
                tutorProfileForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const profileData = {
                        years_experience: parseInt(document.getElementById('tutorExperience').value),
                        subjects_offered: document.getElementById('tutorSubjects').value.split(',').map(s => s.trim()),
                        hourly_rate: parseFloat(document.getElementById('tutorRate').value)
                    };
                    createTutorProfile(profileData);
                });
            }
        }
        
        // Initialize App
        async function initializeApp() {
            // Check for stored auth
            const storedToken = localStorage.getItem('authToken');
            const storedUser = localStorage.getItem('currentUser');
            
            if (storedToken && storedUser) {
                try {
                    authToken = storedToken;
                    currentUser = JSON.parse(storedUser);
                    
                    // Verify token is still valid
                    const response = await apiCall('/api/users/me');
                    if (response.ok) {
                        const userData = await response.json();
                        // Update user data in case it changed
                        currentUser = userData;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        updateUIForAuthenticatedUser();
                        return; // Don't show home if user is authenticated
                    } else {
                        // Token is invalid, clear it
                        console.log('Token invalid, clearing auth');
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('currentUser');
                        authToken = null;
                        currentUser = null;
                    }
                } catch (error) {
                    console.error('Token verification failed:', error);
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('currentUser');
                    authToken = null;
                    currentUser = null;
                }
            }
            
            // Initialize password validation
            setupPasswordValidation('wPassword');
            setupPasswordValidation('resetPassword', 'reset');
            setupPasswordConfirmation('resetPassword', 'confirmPassword', 'reset');
            
            // Setup form event listeners
            setupFormEventListeners();
            setupProfileFormEventListeners();
            
            // Show initial page only if not authenticated
            if (!authToken || !currentUser) {
                showHome();
            }
        }
        
        // API Functions
        // Enhanced Tutor Loading and Display Functions

        async function loadTutors() {
            try {
                const tutorsContainer = document.getElementById('tutorsContainer');
                if (tutorsContainer) {
                    tutorsContainer.innerHTML = `
                        <div class="loading-state">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Finding the best tutors for you...</p>
                        </div>
                    `;
                }

                console.log('Loading tutors...');
                console.log('API_BASE:', API_BASE);
                
                // Try direct fetch first to debug
                const response = await fetch(`${API_BASE}/api/tutors`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Data received:', data);
                    // API returns {tutors: [...]} format
                    allTutors = data.tutors || [];
                    filteredTutors = [...allTutors];
                    console.log('Tutors loaded:', allTutors.length);
                    displayTutors(filteredTutors.slice(0, tutorsPerPage));
                    updateResultsSummary();
                } else {
                    console.error('Response not ok:', response.status, response.statusText);
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    showMessage(`Failed to load tutors: ${response.status} ${response.statusText}`, 'error');
                    if (tutorsContainer) {
                        tutorsContainer.innerHTML = '<p class="text-center text-gray-500">No tutors available at the moment.</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading tutors:', error);
                showMessage(`Failed to load tutors: ${error.message}`, 'error');
                const tutorsContainer = document.getElementById('tutorsContainer');
                if (tutorsContainer) {
                    tutorsContainer.innerHTML = '<p class="text-center text-gray-500">Error loading tutors. Please try again.</p>';
                }
            }
        }
        
        function displayTutors(tutors) {
            const tutorsContainer = document.getElementById('tutorsContainer');
            if (!tutorsContainer) return;
            
            if (tutors.length === 0) {
                tutorsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>No tutors found</h3>
                        <p>Try adjusting your search criteria or filters</p>
                        <button class="btn btn-primary" onclick="clearFilters()">Clear Filters</button>
                    </div>
                `;
                return;
            }
            
            const tutorsHTML = tutors.map(tutor => createTutorCard(tutor)).join('');
            tutorsContainer.innerHTML = tutorsHTML;
            
            // Show/hide load more button
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            if (loadMoreBtn) {
                const hasMore = filteredTutors.length > tutorsCurrentPage * tutorsPerPage;
                loadMoreBtn.style.display = hasMore ? 'block' : 'none';
            }
        }

        function createTutorCard(tutor) {
            const subjects = Object.keys(tutor.subjects_offered || {});
            const stars = generateStars(tutor.rating || 0);
            const initials = getInitials(tutor.name);
            
            return `
                <div class="tutor-card-enhanced" data-tutor-id="${tutor.id}">
                    <div class="tutor-header-enhanced">
                        <div class="tutor-avatar-enhanced">
                            <span>${initials}</span>
                        </div>
                        <div class="tutor-info-enhanced">
                            <h3>${tutor.name || 'Unknown Tutor'}</h3>
                            <div class="tutor-rating-enhanced">
                                <div class="stars">${stars}</div>
                                <span class="rating-text">${(tutor.rating || 0).toFixed(1)} (${tutor.total_sessions || 0} sessions)</span>
                            </div>
                            <div class="tutor-subjects-enhanced">
                                ${subjects.slice(0, 3).map(subject => `<span class="subject-tag">${subject}</span>`).join('')}
                                ${subjects.length > 3 ? `<span class="subject-tag">+${subjects.length - 3} more</span>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="tutor-stats">
                        <div class="stat-item-enhanced">
                            <span class="stat-number-enhanced">${tutor.years_experience || 0}</span>
                            <span class="stat-label-enhanced">Years Exp.</span>
                        </div>
                        <div class="stat-item-enhanced">
                            <span class="stat-number-enhanced">${tutor.total_sessions || 0}</span>
                            <span class="stat-label-enhanced">Sessions</span>
                        </div>
                        <div class="stat-item-enhanced">
                            <span class="stat-number-enhanced">$${tutor.hourly_rate || 0}</span>
                            <span class="stat-label-enhanced">Per Hour</span>
                        </div>
                    </div>
                    
                    <div class="tutor-bio">
                        ${tutor.bio || 'Passionate educator dedicated to helping students achieve their learning goals through personalized instruction and innovative teaching methods.'}
                    </div>
                    
                    <div class="tutor-actions-enhanced">
                        <button class="btn-book" onclick="bookSession(${tutor.id})">
                            <i class="fas fa-calendar-plus"></i> Book Session
                        </button>
                        <button class="btn-profile" onclick="viewTutorProfile(${tutor.id})">
                            <i class="fas fa-user"></i> View Profile
                        </button>
                    </div>
                </div>
            `;
        }

        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let stars = '';
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star star"></i>';
            }
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt star"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star star"></i>';
            }
            return stars;
        }

        function updateResultsSummary() {
            const tutorCount = document.getElementById('tutorCount');
            const avgRating = document.getElementById('avgRating');
            const avgPrice = document.getElementById('avgPrice');
            
            if (tutorCount) {
                tutorCount.textContent = filteredTutors.length;
            }
            
            if (avgRating && filteredTutors.length > 0) {
                const totalRating = filteredTutors.reduce((sum, tutor) => sum + (tutor.rating || 0), 0);
                avgRating.textContent = (totalRating / filteredTutors.length).toFixed(1);
            }
            
            if (avgPrice && filteredTutors.length > 0) {
                const totalPrice = filteredTutors.reduce((sum, tutor) => sum + (tutor.hourly_rate || 0), 0);
                avgPrice.textContent = `$${Math.round(totalPrice / filteredTutors.length)}`;
            }
        }

        // Filter and Search Functions
        function searchTutors() {
            const searchTerm = document.getElementById('tutorSearch').value.toLowerCase();
            applyFilters(searchTerm);
        }

        function filterTutors() {
            applyFilters();
        }

        function applyFilters(searchTerm = '') {
            const subjectFilter = document.getElementById('subjectFilter')?.value || '';
            const experienceFilter = document.getElementById('experienceFilter')?.value || '';
            const ratingFilter = document.getElementById('ratingFilter')?.value || '';
            const priceFilter = document.getElementById('priceFilter')?.value || '';
            const availabilityFilter = document.getElementById('availabilityFilter')?.value || '';

            filteredTutors = allTutors.filter(tutor => {
                // Search term filter
                if (searchTerm) {
                    const searchableText = `${tutor.name || ''} ${Object.keys(tutor.subjects_offered || {}).join(' ')} ${tutor.bio || ''}`.toLowerCase();
                    if (!searchableText.includes(searchTerm)) return false;
                }

                // Subject filter
                if (subjectFilter && !Object.keys(tutor.subjects_offered || {}).includes(subjectFilter)) {
                    return false;
                }

                // Experience filter
                if (experienceFilter) {
                    const years = tutor.years_experience || 0;
                    if (experienceFilter === '1-2' && (years < 1 || years > 2)) return false;
                    if (experienceFilter === '3-5' && (years < 3 || years > 5)) return false;
                    if (experienceFilter === '5+' && years < 5) return false;
                }

                // Rating filter
                if (ratingFilter) {
                    const rating = tutor.rating || 0;
                    const minRating = parseFloat(ratingFilter.replace('+', ''));
                    if (rating < minRating) return false;
                }

                // Price filter
                if (priceFilter) {
                    const price = tutor.hourly_rate || 0;
                    if (priceFilter === '0-25' && (price < 0 || price > 25)) return false;
                    if (priceFilter === '25-50' && (price < 25 || price > 50)) return false;
                    if (priceFilter === '50+' && price < 50) return false;
                }

                return true;
            });

            tutorsCurrentPage = 1;
            displayTutors(filteredTutors.slice(0, tutorsPerPage));
            updateResultsSummary();
        }

        function clearFilters() {
            document.getElementById('tutorSearch').value = '';
            document.getElementById('subjectFilter').value = '';
            document.getElementById('experienceFilter').value = '';
            document.getElementById('ratingFilter').value = '';
            document.getElementById('priceFilter').value = '';
            document.getElementById('availabilityFilter').value = '';
            
            filteredTutors = [...allTutors];
            tutorsCurrentPage = 1;
            displayTutors(filteredTutors.slice(0, tutorsPerPage));
            updateResultsSummary();
        }

        function setViewMode(mode) {
            currentViewMode = mode;
            const tutorsContainer = document.getElementById('tutorsContainer');
            const viewToggles = document.querySelectorAll('.view-toggle');
            
            // Update active toggle
            viewToggles.forEach(toggle => {
                toggle.classList.toggle('active', toggle.dataset.view === mode);
            });
            
            // Update container class
            if (tutorsContainer) {
                tutorsContainer.classList.toggle('list-view', mode === 'list');
            }
        }

        function loadMoreTutors() {
            tutorsCurrentPage++;
            const startIndex = (tutorsCurrentPage - 1) * tutorsPerPage;
            const endIndex = startIndex + tutorsPerPage;
            const moreTutors = filteredTutors.slice(startIndex, endIndex);
            
            if (moreTutors.length > 0) {
                const tutorsContainer = document.getElementById('tutorsContainer');
                const newTutorsHTML = moreTutors.map(tutor => createTutorCard(tutor)).join('');
                tutorsContainer.insertAdjacentHTML('beforeend', newTutorsHTML);
                
                // Update load more button visibility
                const loadMoreBtn = document.getElementById('loadMoreBtn');
                if (loadMoreBtn) {
                    const hasMore = filteredTutors.length > endIndex;
                    loadMoreBtn.style.display = hasMore ? 'block' : 'none';
                }
            }
        }

        function showTutorMatchingWizard() {
            // Get current user's learner profile for AI matching
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('Please log in to use AI matching', 'error');
                return;
            }
            
            // Show AI matching modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content ai-matching-modal">
                    <div class="modal-header">
                        <h2><i class="fas fa-robot"></i> AI Tutor Matching</h2>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="ai-matching-content">
                            <div class="matching-intro">
                                <p>Our AI will analyze your learning profile and find the perfect tutor match for you!</p>
                            </div>
                            
                            <div class="matching-options">
                                <div class="option-card" onclick="startAIMatching('subject')">
                                    <i class="fas fa-book"></i>
                                    <h3>Subject-Based Matching</h3>
                                    <p>Find tutors specialized in your subject</p>
                                </div>
                                <div class="option-card" onclick="startAIMatching('learning_style')">
                                    <i class="fas fa-brain"></i>
                                    <h3>Learning Style Matching</h3>
                                    <p>Match based on your learning preferences</p>
                                </div>
                                <div class="option-card" onclick="startAIMatching('comprehensive')">
                                    <i class="fas fa-star"></i>
                                    <h3>Comprehensive Matching</h3>
                                    <p>Full AI analysis for best overall match</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add styles
            const style = document.createElement('style');
            style.textContent = `
                .ai-matching-modal {
                    max-width: 600px;
                }
                .matching-intro {
                    text-align: center;
                    margin-bottom: 2rem;
                    padding: 1rem;
                    background: #f8f9fa;
                    border-radius: 8px;
                }
                .matching-options {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 1rem;
                }
                .option-card {
                    padding: 1.5rem;
                    border: 2px solid #e0e0e0;
                    border-radius: 12px;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    background: white;
                }
                .option-card:hover {
                    border-color: #667eea;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
                }
                .option-card i {
                    font-size: 2rem;
                    color: #667eea;
                    margin-bottom: 1rem;
                }
                .option-card h3 {
                    margin: 0.5rem 0;
                    color: #333;
                }
                .option-card p {
                    margin: 0;
                    color: #666;
                    font-size: 0.9rem;
                }
            `;
            document.head.appendChild(style);
        }
        
        async function startAIMatching(type) {
            closeModal();
            showMessage('Finding your perfect tutor match...', 'info');
            
            try {
                const currentUser = getCurrentUser();
                if (!currentUser) {
                    showMessage('Please log in to use AI matching', 'error');
                    return;
                }
                
                // Get learner profile
                const learnerProfile = await getLearnerProfile(currentUser.id);
                if (!learnerProfile) {
                    showMessage('Please complete your learner profile first', 'error');
                    return;
                }
                
                // Call AI matching API
                const response = await apiCall('/api/matching/recommendations', {
                    method: 'POST',
                    body: JSON.stringify({
                        learner_id: learnerProfile.id,
                        max_recommendations: 6,
                        matching_type: type
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.recommendations && data.recommendations.length > 0) {
                        // Show AI matched tutors
                        showAIMatchedTutors(data.recommendations, type);
                    } else {
                        showMessage('No tutors found with AI matching. Showing all available tutors.', 'info');
                        loadTutors();
                    }
                } else {
                    showMessage('AI matching failed. Showing all available tutors.', 'error');
                    loadTutors();
                }
            } catch (error) {
                console.error('AI matching error:', error);
                showMessage('AI matching failed. Showing all available tutors.', 'error');
                loadTutors();
            }
        }
        
        function showAIMatchedTutors(tutors, matchingType) {
            // Update the tutors display with AI matched results
            allTutors = tutors;
            filteredTutors = tutors;
            displayTutors(tutors);
            
            // Show success message
            const typeNames = {
                'subject': 'Subject-Based',
                'learning_style': 'Learning Style',
                'comprehensive': 'Comprehensive'
            };
            showMessage(`AI ${typeNames[matchingType]} matching found ${tutors.length} perfect tutors for you!`, 'success');
        }
        
        async function getLearnerProfile(userId) {
            try {
                const response = await apiCall(`/api/profiles/learner/${userId}`);
                if (response.ok) {
                    return await response.json();
                }
                return null;
            } catch (error) {
                console.error('Error getting learner profile:', error);
                return null;
            }
        }
        
        function getCurrentUser() {
            const userData = localStorage.getItem('currentUser');
            return userData ? JSON.parse(userData) : null;
        }

        function showTutorSelection() {
            showPage('tutorsPage');
            loadTutors();
        }

        function showSessionsPage() {
            showPage('sessionsPage');
        }

        // Password Security Functions
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }

        async function validatePasswordStrength(password, prefix = '') {
            try {
                const response = await apiCall('/api/auth/validate-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    updatePasswordStrengthUI(result, prefix);
                    return result;
                }
            } catch (error) {
                console.error('Password validation error:', error);
            }
            return null;
        }

        function updatePasswordStrengthUI(validation, prefix = '') {
            const strengthFill = document.getElementById(`${prefix}strengthFill`);
            const strengthText = document.getElementById(`${prefix}strengthText`);
            const requirements = document.getElementById(`${prefix}passwordRequirements`);
            
            if (strengthFill) {
                strengthFill.className = `strength-fill ${validation.strength}`;
            }
            
            if (strengthText) {
                strengthText.textContent = `Password strength: ${validation.strength.charAt(0).toUpperCase() + validation.strength.slice(1)}`;
                strengthText.className = `strength-text ${validation.strength}`;
            }
            
            if (requirements) {
                const reqs = validation.requirements_met;
                const reqIds = ['length', 'lowercase', 'uppercase', 'digit', 'special'];
                
                reqIds.forEach(reqId => {
                    const reqElement = document.getElementById(`${prefix}req-${reqId}`);
                    if (reqElement) {
                        if (reqs[reqId]) {
                            reqElement.classList.add('met');
                        } else {
                            reqElement.classList.remove('met');
                        }
                    }
                });
            }
        }

        function checkPasswordMatch(password, confirmPassword, prefix = '') {
            const indicator = document.getElementById(`${prefix}passwordMatchIndicator`);
            if (indicator) {
                if (password === confirmPassword && password.length > 0) {
                    indicator.classList.add('match');
                    indicator.querySelector('span').textContent = 'Passwords match';
                } else {
                    indicator.classList.remove('match');
                    indicator.querySelector('span').textContent = 'Passwords don\'t match';
                }
            }
        }

        // Enhanced password visual feedback
        function addPasswordVisualFeedback(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                input.addEventListener('input', (e) => {
                    const password = e.target.value;
                    const hasNumbers = /\d/.test(password);
                    
                    // Change input border color when numbers are entered
                    if (hasNumbers) {
                        input.style.borderColor = '#00a0e4'; // Blue color
                        input.style.boxShadow = '0 0 0 2px rgba(0, 160, 228, 0.2)';
                    } else {
                        input.style.borderColor = '#d1d5db'; // Default gray
                        input.style.boxShadow = 'none';
                    }
                    
                    // Add step-by-step visual feedback
                    const requirements = document.getElementById('passwordRequirements');
                    if (requirements) {
                        const reqItems = requirements.querySelectorAll('.requirement-item');
                        reqItems.forEach((item, index) => {
                            const icon = item.querySelector('i');
                            const text = item.querySelector('span');
                            
                            // Check each requirement step by step
                            if (index === 0 && password.length >= 8) { // Length
                                icon.className = 'fas fa-check';
                                icon.style.color = '#10b981';
                                item.style.color = '#10b981';
                            } else if (index === 1 && /[a-z]/.test(password)) { // Lowercase
                                icon.className = 'fas fa-check';
                                icon.style.color = '#10b981';
                                item.style.color = '#10b981';
                            } else if (index === 2 && /[A-Z]/.test(password)) { // Uppercase
                                icon.className = 'fas fa-check';
                                icon.style.color = '#10b981';
                                item.style.color = '#10b981';
                            } else if (index === 3 && hasNumbers) { // Numbers
                                icon.className = 'fas fa-check';
                                icon.style.color = '#00a0e4'; // Special blue color for numbers
                                item.style.color = '#00a0e4';
                            } else if (index === 4 && /[!@#$%^&*(),.?":{}|<>]/.test(password)) { // Special chars
                                icon.className = 'fas fa-check';
                                icon.style.color = '#10b981';
                                item.style.color = '#10b981';
                            } else {
                                icon.className = 'fas fa-times';
                                icon.style.color = '#ef4444';
                                item.style.color = '#6b7280';
                            }
                        });
                    }
                });
            }
        }

        // Password event listeners
        function setupPasswordValidation(inputId, prefix = '') {
            const input = document.getElementById(inputId);
            if (input) {
                input.addEventListener('input', async (e) => {
                    const password = e.target.value;
                    if (password.length > 0) {
                        await validatePasswordStrength(password, prefix);
                    } else {
                        // Reset UI when password is empty
                        const strengthFill = document.getElementById(`${prefix}strengthFill`);
                        const strengthText = document.getElementById(`${prefix}strengthText`);
                        const requirements = document.getElementById(`${prefix}passwordRequirements`);
                        
                        if (strengthFill) strengthFill.className = 'strength-fill';
                        if (strengthText) {
                            strengthText.textContent = 'Enter a password';
                            strengthText.className = 'strength-text';
                        }
                        if (requirements) {
                            const reqItems = requirements.querySelectorAll('.requirement-item');
                            reqItems.forEach(item => item.classList.remove('met'));
                        }
                    }
                });
            }
        }

        function setupPasswordConfirmation(passwordId, confirmId, prefix = '') {
            const passwordInput = document.getElementById(passwordId);
            const confirmInput = document.getElementById(confirmId);
            
            if (passwordInput && confirmInput) {
                const checkMatch = () => {
                    checkPasswordMatch(passwordInput.value, confirmInput.value, prefix);
                };
                
                passwordInput.addEventListener('input', checkMatch);
                confirmInput.addEventListener('input', checkMatch);
            }
        }

        // Forgot Password Functions
        function showForgotPassword() {
            showPage('forgotPasswordPage');
            // Initialize password visual feedback
            addPasswordVisualFeedback('resetPassword');
        }

        function showResetPassword(token = null) {
            showPage('resetPasswordPage');
            if (token) {
                // Store token for password reset
                window.passwordResetToken = token;
            }
        }

        async function handleForgotPassword(event) {
            event.preventDefault();
            
            const email = document.getElementById('forgotEmail').value.trim();
            if (!email) {
                showMessage('Please enter your email address', 'error');
                return;
            }
            
            try {
                const response = await apiCall('/api/auth/forgot-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showMessage(result.message, 'success');
                    
                    // In development, show the reset URL
                    if (result.reset_url) {
                        console.log('Reset URL:', result.reset_url);
                        showMessage(`Reset link: ${result.reset_url}`, 'info');
                    }
                } else {
                    const error = await response.json();
                    showMessage(error.detail || 'Failed to send reset email', 'error');
                }
            } catch (error) {
                console.error('Forgot password error:', error);
                showMessage('Failed to send reset email', 'error');
            }
        }

        async function handleResetPassword(event) {
            event.preventDefault();
            
            const password = document.getElementById('resetPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const token = window.passwordResetToken || new URLSearchParams(window.location.search).get('token');
            
            if (!token) {
                showMessage('Invalid reset token', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }
            
            // Validate password strength
            const validation = await validatePasswordStrength(password, 'reset');
            if (!validation || !validation.is_valid) {
                showMessage('Password does not meet security requirements', 'error');
                return;
            }
            
            try {
                const response = await apiCall('/api/auth/reset-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        token: token,
                        new_password: password 
                    })
                });
                
                if (response.ok) {
                    showMessage('Password has been successfully reset', 'success');
                    setTimeout(() => {
                        showLogin();
                    }, 2000);
                } else {
                    const error = await response.json();
                    showMessage(error.detail || 'Failed to reset password', 'error');
                }
            } catch (error) {
                console.error('Reset password error:', error);
                showMessage('Failed to reset password', 'error');
            }
        }

        // Role dashboards helpers
        function showRoleDash(id) {
            ['learnerDashRole','parentDashRole','tutorDashRole'].forEach(r => {
                const el = document.getElementById(r);
                if (el) el.classList.add('hidden');
            });
            const target = document.getElementById(id);
            if (target) target.classList.remove('hidden');
        }

        function populateLearnerRoleDash(d) {
            const stats = d.stats || { total_sessions:0, completed_sessions:0, upcoming_sessions:0 };
            const sessions = d.__sessions || [];
            const mlInsights = d.ml_insights || {};
            const progress = d.progress || {};
            
            // Update progress section
            updateProgressSection(stats, progress);
            
            // Update AI insights
            updateAIInsights(mlInsights);
            
            // Update recommended tutors
            updateRecommendedTutors();
            
            // Update recent sessions
            updateRecentSessions(sessions);
            
            // Update achievements
            updateAchievements(stats);
        }

        function updateProgressSection(stats, progress) {
            const progressPercentage = progress.progress_percentage || 0;
            const streakDays = Math.floor(Math.random() * 15) + 1; // Simulated streak
            const nextMilestone = progress.next_milestone || 5;
            
            // Update progress stats
            const setText = (id, val) => { 
                const el = document.getElementById(id); 
                if (el) el.textContent = val; 
            };
            
            setText('lr_progress_percentage', `${Math.round(progressPercentage)}%`);
            setText('lr_streak_days', streakDays);
            setText('lr_next_milestone', nextMilestone);
            
            // Update progress bar
            const progressFill = document.getElementById('lr_progress_fill');
            if (progressFill) {
                progressFill.style.width = `${progressPercentage}%`;
            }
            
            // Update milestone markers
            updateMilestoneMarkers(stats.completed_sessions || 0, nextMilestone);
        }

        function updateMilestoneMarkers(completed, nextMilestone) {
            const milestonesContainer = document.getElementById('lr_milestones');
            if (!milestonesContainer) return;
            
            const milestones = [5, 10, 25, 50, 100];
            const markersHTML = milestones.map(milestone => {
                const isActive = completed >= milestone;
                const isNext = milestone === nextMilestone;
                return `<div class="marker ${isActive ? 'active' : ''} ${isNext ? 'next' : ''}" title="${milestone} sessions"></div>`;
            }).join('');
            
            milestonesContainer.innerHTML = markersHTML;
        }

        function updateAIInsights(mlInsights) {
            // Update difficulty level
            const difficultyLevel = mlInsights.difficulty_progression || 'beginner';
            const difficultyBadge = document.querySelector('#lr_difficulty_level .difficulty-badge');
            const difficultyFill = document.querySelector('#lr_difficulty_level .difficulty-fill');
            
            if (difficultyBadge) {
                difficultyBadge.textContent = difficultyLevel.charAt(0).toUpperCase() + difficultyLevel.slice(1);
            }
            
            if (difficultyFill) {
                const difficultyMap = { beginner: 20, intermediate: 50, advanced: 80, expert: 100 };
                difficultyFill.style.width = `${difficultyMap[difficultyLevel] || 20}%`;
            }
            
            // Update attention span
            const attentionSpan = mlInsights.attention_span_minutes || 30;
            const setText = (id, val) => { 
                const el = document.getElementById(id); 
                if (el) el.textContent = val; 
            };
            setText('lr_attention_span', `${attentionSpan} min`);
            
            // Update engagement gauge
            const engagementScore = Math.random() * 0.4 + 0.6; // Simulated engagement between 60-100%
            const engagementGauge = document.getElementById('lr_engagement_gauge');
            if (engagementGauge) {
                const gaugeFill = engagementGauge.querySelector('.gauge-fill');
                const gaugeText = engagementGauge.querySelector('.gauge-text');
                
                if (gaugeFill) {
                    gaugeFill.style.background = `conic-gradient(var(--success-color) 0deg, var(--success-color) ${engagementScore * 360}deg, var(--gray-200) ${engagementScore * 360}deg)`;
                }
                if (gaugeText) {
                    gaugeText.textContent = `${Math.round(engagementScore * 100)}%`;
                }
            }
            
            // Update learning velocity
            const learningVelocity = mlInsights.learning_velocity || 0.12;
            setText('lr_learning_velocity', `+${Math.round(learningVelocity * 100)}%`);
        }

        async function updateRecommendedTutors() {
            const tutorsContainer = document.getElementById('lr_recommended_tutors');
            if (!tutorsContainer) return;
            
            try {
                const response = await apiCall('/api/tutors');
                if (response.ok) {
                    const data = await response.json();
                    const tutors = data.tutors || [];
                    const recommendedTutors = tutors.slice(0, 3); // Show top 3 recommended
                    
                    if (recommendedTutors.length === 0) {
                        tutorsContainer.innerHTML = `
                            <div class="no-tutors">
                                <i class="fas fa-users"></i>
                                <p>No tutors available</p>
                            </div>
                        `;
                        return;
                    }
                    
                    const tutorsHTML = recommendedTutors.map(tutor => `
                        <div class="tutor-card-mini" onclick="showTutorSelection()">
                            <div class="tutor-avatar-mini">
                        <span>${getInitials(tutor.name)}</span>
                    </div>
                            <div class="tutor-info-mini">
                                <h4>${tutor.name}</h4>
                                <div class="tutor-rating-mini">
                                    <div class="stars">${generateStars(tutor.rating || 0)}</div>
                                    <span>${(tutor.rating || 0).toFixed(1)}</span>
                    </div>
                                <p class="tutor-subjects-mini">${Object.keys(tutor.subjects_offered || {}).slice(0, 2).join(', ')}</p>
                    </div>
                </div>
            `).join('');
            
            tutorsContainer.innerHTML = tutorsHTML;
                } else {
                    tutorsContainer.innerHTML = `
                        <div class="no-tutors">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Unable to load tutors</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading recommended tutors:', error);
                tutorsContainer.innerHTML = `
                    <div class="no-tutors">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading tutors</p>
                    </div>
                `;
            }
        }

        function updateRecentSessions(sessions) {
            const sessionsContainer = document.getElementById('lr_recent_sessions');
            if (!sessionsContainer) return;
            
            const recentSessions = sessions.slice(0, 5);
            
            if (recentSessions.length === 0) {
                sessionsContainer.innerHTML = `
                    <div class="no-sessions">
                        <i class="fas fa-calendar-alt"></i>
                        <p>No recent sessions</p>
                        <button class="btn btn-primary btn-sm" onclick="showTutorSelection()">Book Your First Session</button>
                    </div>
                `;
                return;
            }
            
            const sessionsHTML = recentSessions.map(session => `
                <div class="session-item">
                    <div class="session-info">
                        <h4>${session.subject || 'General Tutoring'}</h4>
                        <div class="session-time">${new Date(session.scheduled_start).toLocaleString()}</div>
                    </div>
                    <div class="session-status ${session.status}">${session.status}</div>
                </div>
            `).join('');
            
            sessionsContainer.innerHTML = sessionsHTML;
        }

        function updateAchievements(stats) {
            const achievementsContainer = document.getElementById('lr_achievements');
            if (!achievementsContainer) return;
            
            const completedSessions = stats.completed_sessions || 0;
            const achievements = [
                {
                    id: 'first_steps',
                    title: 'First Steps',
                    description: 'Completed your first session',
                    icon: 'fas fa-medal',
                    earned: completedSessions >= 1,
                    threshold: 1
                },
                {
                    id: 'streak_master',
                    title: 'Streak Master',
                    description: '7-day learning streak',
                    icon: 'fas fa-fire',
                    earned: Math.random() > 0.5, // Simulated
                    threshold: 7
                },
                {
                    id: 'scholar',
                    title: 'Scholar',
                    description: 'Complete 25 sessions',
                    icon: 'fas fa-graduation-cap',
                    earned: completedSessions >= 25,
                    threshold: 25
                },
                {
                    id: 'dedicated_learner',
                    title: 'Dedicated Learner',
                    description: 'Complete 50 sessions',
                    icon: 'fas fa-trophy',
                    earned: completedSessions >= 50,
                    threshold: 50
                },
                {
                    id: 'learning_champion',
                    title: 'Learning Champion',
                    description: 'Complete 100 sessions',
                    icon: 'fas fa-crown',
                    earned: completedSessions >= 100,
                    threshold: 100
                }
            ];
            
            const achievementsHTML = achievements.map(achievement => `
                <div class="achievement-card ${achievement.earned ? 'earned' : 'locked'}">
                    <div class="achievement-icon">
                        <i class="${achievement.icon}"></i>
                    </div>
                    <div class="achievement-info">
                        <h4>${achievement.title}</h4>
                        <p>${achievement.description}</p>
                        ${!achievement.earned ? `<div class="progress-text">${completedSessions}/${achievement.threshold}</div>` : ''}
                    </div>
                </div>
            `).join('');
            
            achievementsContainer.innerHTML = achievementsHTML;
        }

        async function populateParentRoleDash() {
            try {
                const res = await apiCall('/api/tutors');
                const tutors = res.ok ? (await res.json()).tutors : [];
                const cont = document.getElementById('pr_tutors');
                if (cont) cont.innerHTML = tutors.slice(0,6).map(t => `<div class=\"tutor-card\"><div class=\"tutor-avatar\">${(t.name||'').split(' ').map(x=>x[0]).join('').slice(0,2).toUpperCase()}</div><div class=\"tutor-info\"><h3>${t.name}</h3><p class=\"tutor-subjects\">${Object.keys(t.subjects_offered || {}).join(', ')}</p><p class=\"tutor-rating\"> ${t.rating}</p></div></div>`).join('') || '<div class="insight-card">No tutors found</div>';
            } catch {}
        }

        function populateTutorRoleDash() {
            const cont = document.getElementById('tr_sessions');
            if (!cont) return;
            const sessions = (window.__lastSessionsCache || []);
            const total = sessions.length;
            const completed = sessions.filter(s=>s.status==='completed').length;
            const avgEng = sessions.length ? (sessions.reduce((a,b)=>a+(b.engagement_score||0),0)/sessions.length) : 0;
            const setText = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
            setText('tr_total', total);
            setText('tr_completed', completed);
            setText('tr_avgeng', (avgEng*100).toFixed(0)+'%');
            cont.innerHTML = sessions.slice(0,8).map(s => `<div class=\"session-card\"><div class=\"session-info\"><h3>${s.subject}</h3><p>${new Date(s.scheduled_start).toLocaleString()}</p></div><span class=\"badge\">${s.status}</span></div>`).join('') || '<div class="insight-card">No sessions</div>';
        }
        
        async function loadDashboard() {
            if (!currentUser) {
                showMessage('Please login to view dashboard', 'error');
                return;
            }
            
            try {
                // Call appropriate dashboard endpoint based on user role
                const dashboardEndpoint = currentUser.role === 'learner' ? '/api/dashboard/learner' : 
                                        currentUser.role === 'tutor' ? '/api/dashboard/tutor' : 
                                        '/api/dashboard/parent';
                const response = await apiCall(dashboardEndpoint);
                if (response.ok) {
                    const data = await response.json();
                    // Also pull sessions for role dashboards
                    try {
                        const sessRes = await apiCall('/api/sessions/my-sessions');
                        data.__sessions = sessRes.ok ? (await sessRes.json()).sessions : [];
                    } catch(_) { data.__sessions = []; }

                    // Augment with live ML predictions if possible
                    try {
                        const learnerFeatures = {
                            age: data.profile.age || 15,
                            grade_level: (data.profile.grade_level && parseInt(String(data.profile.grade_level).match(/\d+/))) || 8,
                            learning_progress: data.stats.learning_progress_score || 0.5,
                            success_rate: 0.7,
                            engagement_score: data.stats.completed_sessions ? Math.min(1, data.stats.completed_sessions / Math.max(1, data.stats.total_sessions)) : 0.5,
                            attention_span: data.ml_insights.attention_span_minutes || 30
                        };

                        const [diffResp, tutorResp] = await Promise.all([
                            predictDifficulty(learnerFeatures),
                            predictTutorMatch({ ...learnerFeatures, comfort_level: 3, session_count: data.stats.completed_sessions || 0, subject_preference: 2, learning_style: 1, time_preference: 1 })
                        ]);

                        if (diffResp && diffResp.difficulty) {
                            data.ml_insights.difficulty_progression = diffResp.difficulty;
                        }
                        if (tutorResp && tutorResp.strategy) {
                            data.ml_insights.tutor_strategy = tutorResp.strategy;
                        }
                    } catch (_) {}

                    displayDashboard(data);
                } else {
                    const errorData = await response.json();
                    showMessage(errorData.detail || 'Failed to load dashboard', 'error');
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showMessage('Failed to load dashboard', 'error');
            }
        }
        
        function displayDashboard(data) {
            // Update header information
            const dashWelcome = document.getElementById('dashWelcome');
            const dashSubtitle = document.getElementById('dashSubtitle');
            
            if (dashWelcome) {
                dashWelcome.textContent = `Welcome back, ${data.profile?.name || currentUser?.full_name || 'there'}!`;
            }
            
            if (dashSubtitle) {
                const role = currentUser?.role || 'user';
                dashSubtitle.textContent = `Here's your ${role} dashboard overview`;
            }

            // Check if user has any data
            const hasData = checkUserHasData(data);
            
            if (!hasData) {
                showEmptyState(data);
                return;
            }
            
            // Update metric cards
            updateMetricCard('statTotalSessions', data.stats.total_sessions);
            updateMetricCard('statCompleted', data.stats.completed_sessions);
            updateMetricCard('statUpcoming', data.stats.upcoming_sessions);
            updateMetricCard('statProgress', Math.round((data.stats.learning_progress_score || 0.75) * 100) + '%');
            
            // Update quick stats
            updateQuickStat('todaySessions', data.stats.today_sessions || 0);
            updateQuickStat('weekSessions', data.stats.week_sessions || data.stats.completed_sessions);
            updateQuickStat('currentStreak', data.stats.current_streak || 7);
            
            // Update next session time
            const nextSessionTime = document.getElementById('nextSessionTime');
            if (nextSessionTime && data.stats.upcoming_sessions > 0) {
                nextSessionTime.textContent = 'Tomorrow at 2:00 PM';
            }
            
            // Update performance insights
            updatePerformanceInsights(data);
            
            // Update achievement badges
            updateAchievementBadges(data);
            
            // Update notifications
            updateNotifications(data);
            
            // Initialize sparkline charts for metrics
            initializeSparklineCharts(data);
            
            // Show role-specific dashboard sections
            showRoleSpecificDashboard(data);
            
            // Initialize charts
            initializeDashboardCharts(data);
            
            // Update recent activity
            updateRecentActivity(data);
            
            // Load role-specific data
            loadRoleSpecificData(data);
        }
        
        function updateMetricCard(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
            }
        }
        
        function updateQuickStat(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
            }
        }
        
        function showRoleSpecificDashboard(data) {
            // Hide all role sections first
            document.getElementById('learnerDashRole')?.classList.add('hidden');
            document.getElementById('tutorDashRole')?.classList.add('hidden');
            document.getElementById('parentDashRole')?.classList.add('hidden');
            
            // Show appropriate role section
            if (currentUser && currentUser.role) {
                const roleSection = document.getElementById(currentUser.role + 'DashRole');
                if (roleSection) {
                    roleSection.classList.remove('hidden');
                }
            }
        }
        
        function initializeDashboardCharts(data) {
            // Initialize progress chart
            const progressCtx = document.getElementById('progressChart');
            if (progressCtx) {
                // Create a simple progress chart using canvas
                const ctx = progressCtx.getContext('2d');
                const width = progressCtx.width = progressCtx.offsetWidth;
                const height = progressCtx.height = progressCtx.offsetHeight;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw progress line chart
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                // Sample data points
                const points = [
                    {x: 0, y: height * 0.8},
                    {x: width * 0.25, y: height * 0.7},
                    {x: width * 0.5, y: height * 0.5},
                    {x: width * 0.75, y: height * 0.3},
                    {x: width, y: height * 0.2}
                ];
                
                ctx.moveTo(points[0].x, points[0].y);
                for (let i = 1; i < points.length; i++) {
                    ctx.lineTo(points[i].x, points[i].y);
                }
                ctx.stroke();
                
                // Add gradient fill
                const gradient = ctx.createLinearGradient(0, 0, 0, height);
                gradient.addColorStop(0, 'rgba(102, 126, 234, 0.3)');
                gradient.addColorStop(1, 'rgba(102, 126, 234, 0.05)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.moveTo(points[0].x, height);
                for (let i = 0; i < points.length; i++) {
                    ctx.lineTo(points[i].x, points[i].y);
                }
                ctx.lineTo(points[points.length - 1].x, height);
                ctx.closePath();
                ctx.fill();
            }
            
            // Initialize subject distribution chart
            const subjectCtx = document.getElementById('subjectChart');
            if (subjectCtx) {
                const ctx = subjectCtx.getContext('2d');
                const width = subjectCtx.width = subjectCtx.offsetWidth;
                const height = subjectCtx.height = subjectCtx.offsetHeight;
                
                ctx.clearRect(0, 0, width, height);
                
                // Draw pie chart
                const centerX = width / 2;
                const centerY = height / 2;
                const radius = Math.min(width, height) / 2 - 20;
                
                const data = [
                    {label: 'Mathematics', value: 40, color: '#667eea'},
                    {label: 'English', value: 30, color: '#4facfe'},
                    {label: 'Science', value: 20, color: '#fa709a'},
                    {label: 'Other', value: 10, color: '#a8edea'}
                ];
                
                let currentAngle = 0;
                data.forEach(item => {
                    const sliceAngle = (item.value / 100) * 2 * Math.PI;
                    
                    ctx.fillStyle = item.color;
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                    ctx.closePath();
                    ctx.fill();
                    
                    currentAngle += sliceAngle;
                });
            }
        }
        
        function updateRecentActivity(data) {
            const activityContainer = document.getElementById('recentActivity');
            if (activityContainer && data.recent_sessions) {
                const activities = data.recent_sessions.slice(0, 3).map(session => `
                    <div class="activity-item">
                        <div class="activity-icon ${session.status === 'completed' ? 'success' : 'info'}">
                            <i class="fas fa-${session.status === 'completed' ? 'check' : 'calendar'}"></i>
                        </div>
                        <div class="activity-content">
                            <h4>Session ${session.status === 'completed' ? 'Completed' : 'Scheduled'}</h4>
                            <p>${session.subject} ${session.tutor_name ? 'with ' + session.tutor_name : ''}</p>
                            <span class="activity-time">${formatTimeAgo(session.scheduled_start)}</span>
                        </div>
                    </div>
                `).join('');
                
                activityContainer.innerHTML = activities;
            }
        }
        
        function loadRoleSpecificData(data) {
            if (currentUser && currentUser.role === 'tutor') {
                loadTutorDashboardData(data);
            } else if (currentUser && currentUser.role === 'learner') {
                loadLearnerDashboardData(data);
            } else if (currentUser && currentUser.role === 'parent') {
                loadParentDashboardData(data);
            }
        }

        function loadLearnerDashboardData(data) {
            // Update learning journey progress
            const journeySteps = document.querySelectorAll('.journey-step');
            if (journeySteps.length > 0) {
                const completedSessions = data.stats?.completed_sessions || 0;
                const progress = Math.min(100, (completedSessions / 10) * 100);
                
                // Update current step progress
                const currentStep = document.querySelector('.journey-step.current .step-progress');
                if (currentStep) {
                    currentStep.textContent = `Progress: ${Math.round(progress)}%`;
                }
            }

            // Update learning analytics
            const analyticsItems = document.querySelectorAll('.analytics-item');
            if (analyticsItems.length > 0) {
                const studyTime = (data.stats?.completed_sessions || 0) * 1.5;
                const focusScore = data.stats?.focus_score || 8.7;
                const weakArea = data.stats?.weak_area || 'Algebra II';
                
                if (analyticsItems[0]) {
                    const valueElement = analyticsItems[0].querySelector('.analytics-value');
                    if (valueElement) valueElement.textContent = `${studyTime} hours`;
                }
                
                if (analyticsItems[1]) {
                    const valueElement = analyticsItems[1].querySelector('.analytics-value');
                    if (valueElement) valueElement.textContent = `${focusScore}/10`;
                }
                
                if (analyticsItems[2]) {
                    const valueElement = analyticsItems[2].querySelector('.analytics-value');
                    if (valueElement) valueElement.textContent = weakArea;
                }
            }

            // Update recommended tutors
            loadRecommendedTutors(data);
        }

        function loadTutorDashboardData(data) {
            // Update earnings with fallback for zero data
            const monthlyEarnings = document.getElementById('monthlyEarnings');
            const weeklyEarnings = document.getElementById('weeklyEarnings');
            
            const earnings = data.stats?.earnings || 0;
            if (monthlyEarnings) {
                monthlyEarnings.textContent = `$${earnings}`;
            }
            
            if (weeklyEarnings) {
                const weekly = Math.round(earnings * 0.25);
                weeklyEarnings.textContent = `$${weekly}`;
            }

            // Update performance metrics with fallbacks
            const performanceItems = document.querySelectorAll('.performance-item');
            if (performanceItems.length > 0) {
                const avgRating = data.stats?.average_rating || 0;
                const activeStudents = data.stats?.total_sessions || 0;
                const successRate = data.stats?.success_rate || 0;
                
                if (performanceItems[0]) {
                    const valueElement = performanceItems[0].querySelector('.performance-value');
                    if (valueElement) valueElement.textContent = avgRating > 0 ? `${avgRating}/5.0` : 'New';
                }
                
                if (performanceItems[1]) {
                    const valueElement = performanceItems[1].querySelector('.performance-value');
                    if (valueElement) valueElement.textContent = activeStudents.toString();
                }
                
                if (performanceItems[2]) {
                    const valueElement = performanceItems[2].querySelector('.performance-value');
                    if (valueElement) valueElement.textContent = successRate > 0 ? `${successRate}%` : 'New';
                }
            }

            // Load students data
            loadStudentsData(data);
        }

        function loadParentDashboardData(data) {
            // Update children's progress with fallback for no children
            const childrenProgress = document.getElementById('childrenProgress');
            if (childrenProgress) {
                if (data.children && data.children.length > 0) {
                    console.log('Loading parent dashboard data:', data.children);
                } else {
                    // Show empty children state
                    childrenProgress.innerHTML = `
                        <div class="empty-children-state">
                            <div class="empty-children-icon">
                                <i class="fas fa-child"></i>
                            </div>
                            <h4>No Children Added Yet</h4>
                            <p>Add your first child to start tracking their learning journey.</p>
                            <button class="btn btn-primary" onclick="addChild()">
                                <i class="fas fa-plus"></i>
                                Add Child
                            </button>
                        </div>
                    `;
                }
            }

            // Update family analytics with fallbacks
            const analyticsItems = document.querySelectorAll('.family-analytics .analytics-item');
            if (analyticsItems.length > 0) {
                const totalSessions = data.stats?.total_sessions || 0;
                const completedSessions = data.stats?.completed_sessions || 0;
                
                if (analyticsItems[0]) {
                    const valueElement = analyticsItems[0].querySelector('.analytics-value');
                    if (valueElement) {
                        const totalTime = totalSessions * 1.5;
                        valueElement.textContent = `${totalTime} hours`;
                    }
                }
                
                if (analyticsItems[1]) {
                    const valueElement = analyticsItems[1].querySelector('.analytics-value');
                    if (valueElement) {
                        const progress = Math.min(100, completedSessions * 10);
                        valueElement.textContent = `${progress}%`;
                    }
                }
                
                if (analyticsItems[2]) {
                    const valueElement = analyticsItems[2].querySelector('.analytics-value');
                    if (valueElement) {
                        const completionRate = totalSessions > 0 ? Math.round((completedSessions / totalSessions) * 100) : 0;
                        valueElement.textContent = `${completionRate}%`;
                    }
                }
            }
        }

        function loadRecommendedTutors(data) {
            const tutorsContainer = document.getElementById('recTutors');
            if (!tutorsContainer) return;

            // Sample recommended tutors data
            const recommendedTutors = [
                {
                    name: "Dr. Sarah Mitchell",
                    subject: "Mathematics",
                    rating: 4.9,
                    experience: "8 years",
                    price: "$45/hour",
                    availability: "Available today"
                },
                {
                    name: "Mr. James Wilson",
                    subject: "Physics",
                    rating: 4.8,
                    experience: "6 years",
                    price: "$40/hour",
                    availability: "Available tomorrow"
                }
            ];

            const tutorsHTML = recommendedTutors.map(tutor => `
                <div class="tutor-recommendation">
                    <div class="tutor-info">
                        <div class="tutor-avatar">
                            <span>${tutor.name.split(' ').map(n => n[0]).join('')}</span>
                        </div>
                        <div class="tutor-details">
                            <h4>${tutor.name}</h4>
                            <p>${tutor.subject}  ${tutor.experience}</p>
                            <div class="tutor-rating">
                                <span class="stars"></span>
                                <span class="rating">${tutor.rating}</span>
                            </div>
                        </div>
                    </div>
                    <div class="tutor-meta">
                        <div class="tutor-price">${tutor.price}</div>
                        <div class="tutor-availability">${tutor.availability}</div>
                        <button class="btn btn-sm btn-primary">Book Session</button>
                    </div>
                </div>
            `).join('');

            tutorsContainer.innerHTML = tutorsHTML;
        }

        function loadStudentsData(data) {
            // This would load real student data for tutors
            console.log('Loading students data for tutor:', data);
        }

        // Role-specific navigation functions
        function showLearningPath() {
            showMessage('Learning path feature coming soon!', 'info');
        }

        function showStudents() {
            showMessage('Student management feature coming soon!', 'info');
        }

        function showResources() {
            showMessage('Resource management feature coming soon!', 'info');
        }

        function addChild() {
            // Open Manage Learners modal directly for parents
            if (typeof toggleManageLearners === 'function') {
                toggleManageLearners(true);
                return;
            }
            showMessage('Opening manage learners...', 'info');
        }

        function showBilling() {
            // Open Billing modal
            const m = document.getElementById('billingModal');
            if (m) {
                m.classList.add('active');
                loadBillingSummary();
                return;
            }
            showMessage('Billing view unavailable', 'error');
        }

        // Empty state and onboarding functions
        function checkUserHasData(data) {
            if (!data || !data.stats) return false;
            
            const stats = data.stats;
            const hasSessions = (stats.total_sessions || 0) > 0;
            const hasProfile = data.profile && Object.keys(data.profile).length > 0;
            
            return hasSessions || hasProfile;
        }

        function showEmptyState(data) {
            const role = currentUser?.role || 'user';
            
            // Hide normal dashboard content
            document.querySelector('.dashboard-grid')?.classList.add('hidden');
            
            // Show empty state
            showRoleSpecificEmptyState(role, data);
        }

        function showRoleSpecificEmptyState(role, data) {
            const dashboardContainer = document.querySelector('.dashboard-container');
            if (!dashboardContainer) return;

            // Create empty state container
            const emptyStateHTML = createEmptyStateHTML(role, data);
            
            // Find or create empty state container
            let emptyStateContainer = document.getElementById('emptyStateContainer');
            if (!emptyStateContainer) {
                emptyStateContainer = document.createElement('div');
                emptyStateContainer.id = 'emptyStateContainer';
                dashboardContainer.appendChild(emptyStateContainer);
            }
            
            emptyStateContainer.innerHTML = emptyStateHTML;
            emptyStateContainer.classList.remove('hidden');
        }

        function createEmptyStateHTML(role, data) {
            switch(role) {
                case 'learner':
                    return createLearnerEmptyState();
                case 'tutor':
                    return createTutorEmptyState();
                case 'parent':
                    return createParentEmptyState();
                default:
                    return createGenericEmptyState();
            }
        }

        function createLearnerEmptyState() {
            return `
                <div class="empty-state">
                    <div class="empty-state-content">
                        <div class="empty-state-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h2>Welcome to Your Learning Journey!</h2>
                        <p>You're all set up! Let's get you started with your first learning session.</p>
                        
                        <div class="empty-state-actions">
                            <button class="btn btn-primary btn-lg" onclick="showTutors()">
                                <i class="fas fa-search"></i>
                                Find Your First Tutor
                            </button>
                            <button class="btn btn-outline btn-lg" onclick="showOnboarding('learner')">
                                <i class="fas fa-play"></i>
                                Take a Tour
                            </button>
                        </div>
                        
                        <div class="empty-state-features">
                            <div class="feature-item">
                                <i class="fas fa-users"></i>
                                <h4>Connect with Expert Tutors</h4>
                                <p>Find qualified tutors in your subjects</p>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-chart-line"></i>
                                <h4>Track Your Progress</h4>
                                <p>Monitor your learning journey with detailed analytics</p>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-calendar"></i>
                                <h4>Flexible Scheduling</h4>
                                <p>Book sessions that fit your schedule</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createTutorEmptyState() {
            return `
                <div class="empty-state">
                    <div class="empty-state-content">
                        <div class="empty-state-icon">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <h2>Welcome to Your Teaching Dashboard!</h2>
                        <p>Ready to start teaching? Let's set up your profile and get your first students.</p>
                        
                        <div class="empty-state-actions">
                            <button class="btn btn-primary btn-lg" onclick="showProfile()">
                                <i class="fas fa-user-edit"></i>
                                Complete Your Profile
                            </button>
                            <button class="btn btn-outline btn-lg" onclick="showOnboarding('tutor')">
                                <i class="fas fa-play"></i>
                                Take a Tour
                            </button>
                        </div>
                        
                        <div class="empty-state-features">
                            <div class="feature-item">
                                <i class="fas fa-user-plus"></i>
                                <h4>Attract Students</h4>
                                <p>Complete your profile to get discovered by learners</p>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-dollar-sign"></i>
                                <h4>Earn Money</h4>
                                <p>Set your rates and start earning from your expertise</p>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-chart-bar"></i>
                                <h4>Track Performance</h4>
                                <p>Monitor your teaching success with detailed analytics</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createParentEmptyState() {
            return `
                <div class="empty-state">
                    <div class="empty-state-content">
                        <div class="empty-state-icon">
                            <i class="fas fa-family"></i>
                        </div>
                        <h2>Welcome to Your Family Learning Hub!</h2>
                        <p>Ready to support your children's learning journey? Let's get started!</p>
                        
                        <div class="empty-state-actions">
                            <button class="btn btn-primary btn-lg" onclick="addChild()">
                                <i class="fas fa-child"></i>
                                Add Your First Child
                            </button>
                            <button class="btn btn-outline btn-lg" onclick="showOnboarding('parent')">
                                <i class="fas fa-play"></i>
                                Take a Tour
                            </button>
                        </div>
                        
                        <div class="empty-state-features">
                            <div class="feature-item" onclick="showDashboard()" style="cursor:pointer">
                                <i class="fas fa-child"></i>
                                <h4>Track Children's Progress</h4>
                                <p>Monitor each child's learning journey individually</p>
                            </div>
                            <div class="feature-item" onclick="showSessions()" style="cursor:pointer">
                                <i class="fas fa-calendar-check"></i>
                                <h4>Manage Sessions</h4>
                                <p>Schedule and track all your children's tutoring sessions</p>
                            </div>
                            <div class="feature-item" onclick="showBilling()" style="cursor:pointer">
                                <i class="fas fa-credit-card"></i>
                                <h4>Easy Billing</h4>
                                <p>Simple payment tracking for all your children</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createGenericEmptyState() {
            return `
                <div class="empty-state">
                    <div class="empty-state-content">
                        <div class="empty-state-icon">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <h2>Welcome to LearnOptima!</h2>
                        <p>Let's get you started with your personalized learning experience.</p>
                        
                        <div class="empty-state-actions">
                            <button class="btn btn-primary btn-lg" onclick="showOnboarding('generic')">
                                <i class="fas fa-play"></i>
                                Get Started
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function showOnboarding(role) {
            showMessage(`${role} onboarding tour coming soon!`, 'info');
        }

        function hideEmptyState() {
            const emptyStateContainer = document.getElementById('emptyStateContainer');
            if (emptyStateContainer) {
                emptyStateContainer.classList.add('hidden');
            }
            
            const dashboardGrid = document.querySelector('.dashboard-grid');
            if (dashboardGrid) {
                dashboardGrid.classList.remove('hidden');
            }
        }
        
        function loadParentDashboardData(data) {
            // Load children progress
            const childrenProgress = document.getElementById('childrenProgress');
            if (childrenProgress && data.children) {
                const childrenHtml = data.children.map(child => `
                    <div class="child-item">
                        <div class="child-info">
                            <h4>${child.name}</h4>
                            <p>Grade ${child.grade}  ${child.subject}</p>
                        </div>
                        <div class="child-progress">
                            <div class="progress-circle">
                                <svg viewBox="0 0 36 36">
                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e6e6e6" stroke-width="2"/>
                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#4CAF50" stroke-width="2" stroke-dasharray="${child.progress}, 100"/>
                                </svg>
                                <span class="progress-text">${child.progress}%</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                childrenProgress.innerHTML = childrenHtml;
            }
        }
        
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInHours = Math.floor((now - date) / (1000 * 60 * 60));
            
            if (diffInHours < 1) return 'Just now';
            if (diffInHours < 24) return `${diffInHours} hour${diffInHours > 1 ? 's' : ''} ago`;
            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays < 7) return `${diffInDays} day${diffInDays > 1 ? 's' : ''} ago`;
            return date.toLocaleDateString();
        }

        function updatePerformanceInsights(data) {
            // Update learning velocity
            const learningVelocity = document.getElementById('learningVelocity');
            if (learningVelocity) {
                const velocity = data.ml_insights?.learning_velocity || 15;
                learningVelocity.textContent = `+${velocity}%`;
            }

            // Update focus score
            const focusScore = document.getElementById('focusScore');
            if (focusScore) {
                const score = data.ml_insights?.focus_score || 8.5;
                focusScore.textContent = `${score}/10`;
            }

            // Update concept mastery
            const conceptMastery = document.getElementById('conceptMastery');
            if (conceptMastery) {
                const mastery = data.ml_insights?.concept_mastery || 87;
                conceptMastery.textContent = `${mastery}%`;
            }
        }

        function updateAchievementBadges(data) {
            const completedSessions = data.stats.completed_sessions || 0;
            
            // Update progress for locked achievements
            const scholarProgress = document.querySelector('.achievement-badge.locked .badge-progress');
            if (scholarProgress) {
                scholarProgress.textContent = `Progress: ${completedSessions}/25`;
            }

            const championProgress = document.querySelector('.achievement-badge.locked:last-child .badge-progress');
            if (championProgress) {
                championProgress.textContent = `Progress: ${completedSessions}/100`;
            }

            // Update streak achievement if applicable
            const currentStreak = data.stats.current_streak || 7;
            const streakBadge = document.querySelector('.achievement-badge.earned .badge-info h4');
            if (streakBadge && streakBadge.textContent === 'Streak Master') {
                const streakInfo = document.querySelector('.achievement-badge.earned .badge-info p');
                if (streakInfo) {
                    streakInfo.textContent = `${currentStreak}-day learning streak`;
                }
            }
        }

        function updateNotifications(data) {
            const notificationCount = document.querySelector('.notification-count');
            if (notificationCount) {
                const count = data.notifications?.length || 3;
                notificationCount.textContent = count;
            }

            // Update notification content based on data
            const sessionReminder = document.querySelector('.notification-item.unread .notification-content p');
            if (sessionReminder && data.stats.upcoming_sessions > 0) {
                sessionReminder.textContent = `Your next session starts in 30 minutes`;
            }
        }

        function initializeSparklineCharts(data) {
            // Generate sample data for sparklines
            const generateSparklineData = (baseValue, variance = 0.3) => {
                const data = [];
                for (let i = 0; i < 30; i++) {
                    data.push(baseValue + (Math.random() - 0.5) * variance * baseValue);
                }
                return data;
            };

            // Sessions sparkline
            const sessionsCanvas = document.getElementById('sessionsSparkline');
            if (sessionsCanvas) {
                drawSparkline(sessionsCanvas, generateSparklineData(data.stats.total_sessions || 12, 0.2), '#667eea');
            }

            // Completed sparkline
            const completedCanvas = document.getElementById('completedSparkline');
            if (completedCanvas) {
                drawSparkline(completedCanvas, generateSparklineData(data.stats.completed_sessions || 8, 0.3), '#22c55e');
            }

            // Upcoming sparkline
            const upcomingCanvas = document.getElementById('upcomingSparkline');
            if (upcomingCanvas) {
                drawSparkline(upcomingCanvas, generateSparklineData(data.stats.upcoming_sessions || 3, 0.4), '#f59e0b');
            }

            // Progress sparkline
            const progressCanvas = document.getElementById('progressSparkline');
            if (progressCanvas) {
                drawSparkline(progressCanvas, generateSparklineData((data.stats.learning_progress_score || 0.75) * 100, 0.2), '#3b82f6');
            }
        }

        function drawSparkline(canvas, data, color = '#667eea') {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            if (data.length === 0) return;
            
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min || 1;
            
            const stepX = width / (data.length - 1);
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = index * stepX;
                const y = height - ((value - min) / range) * height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // Add gradient fill
            ctx.globalCompositeOperation = 'destination-over';
            ctx.fillStyle = color + '20';
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();
            ctx.fill();
            ctx.globalCompositeOperation = 'source-over';
        }
        
        async function loadSessions() {
            if (!currentUser) {
                showMessage('Please login to view sessions', 'error');
                return;
            }
            
            try {
                const response = await apiCall('/api/sessions/my-sessions');
                if (response.ok) {
                    const data = await response.json();
                    displaySessions(data.sessions);
                } else {
                    const errorData = await response.json();
                    showMessage(errorData.detail || 'Failed to load sessions', 'error');
                }
            } catch (error) {
                console.error('Error loading sessions:', error);
                showMessage('Failed to load sessions', 'error');
            }
        }
        
        function displaySessions(sessions) {
            const sessionsContainer = document.getElementById('sessionsContainer');
            if (!sessionsContainer) return;
            
            if (sessions.length === 0) {
                sessionsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"></div>
                        <h3>No sessions scheduled</h3>
                        <p>Start your learning journey by booking a session with a tutor!</p>
                        <button class="btn btn-primary" onclick="showTutors()">Find Tutors</button>
                    </div>
                `;
                return;
            }
            
            const sessionsHTML = sessions.map(session => {
                const startDate = new Date(session.scheduled_start);
                const endDate = new Date(session.scheduled_end);
                const now = new Date();
                const timeUntilStart = session.time_until_start;
                
                // Format time until start
                let timeDisplay = '';
                if (timeUntilStart > 0) {
                    const hours = Math.floor(timeUntilStart / 3600);
                    const minutes = Math.floor((timeUntilStart % 3600) / 60);
                    if (hours > 0) {
                        timeDisplay = `${hours}h ${minutes}m until start`;
                    } else {
                        timeDisplay = `${minutes}m until start`;
                    }
                }
                
                // Determine status styling
                let statusClass = `status-${session.status}`;
                let statusIcon = '';
                if (session.status === 'scheduled') {
                    if (session.is_overdue) {
                        statusClass = 'status-overdue';
                        statusIcon = '';
                    } else if (session.status_detail === 'starting_soon') {
                        statusClass = 'status-soon';
                        statusIcon = '';
                    } else {
                        statusIcon = '';
                    }
                } else if (session.status === 'in_progress') {
                    statusIcon = '';
                } else if (session.status === 'completed') {
                    statusIcon = '';
                } else if (session.status === 'cancelled') {
                    statusIcon = '';
                }
                
                return `
                    <div class="session-card ${session.is_overdue ? 'overdue' : ''}">
                        <div class="session-header">
                            <div class="session-subject">
                                <h3>${session.subject}</h3>
                                <span class="session-duration">${session.duration_hours}h session</span>
                            </div>
                            <div class="session-status">
                                <span class="status-badge ${statusClass}">
                                    ${statusIcon} ${session.status.replace('_', ' ')}
                                </span>
                            </div>
                        </div>
                        
                        <div class="session-details">
                            <div class="detail-row">
                                <span class="detail-label"> Date:</span>
                                <span class="detail-value">${startDate.toLocaleDateString()}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"> Time:</span>
                                <span class="detail-value">${startDate.toLocaleTimeString()} - ${endDate.toLocaleTimeString()}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"> ${currentUser.role === 'learner' ? 'Tutor' : 'Learner'}:</span>
                                <span class="detail-value">${currentUser.role === 'learner' ? session.tutor_name : session.learner_name}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"> Difficulty:</span>
                                <span class="detail-value">${session.difficulty_level}</span>
                            </div>
                            ${timeDisplay ? `<div class="detail-row">
                                <span class="detail-label"> Status:</span>
                                <span class="detail-value">${timeDisplay}</span>
                            </div>` : ''}
                        </div>
                        
                        <div class="session-actions">
                            ${session.status === 'scheduled' ? `
                                <button class="btn btn-primary" onclick="startSession(${session.session_id})">
                                     Start Session
                                </button>
                            ` : session.status === 'in_progress' ? `
                                <button class="btn btn-success" onclick="completeSession(${session.session_id})">
                                     Complete Session
                                </button>
                            ` : ''}
                            <button class="btn btn-secondary" onclick="viewSessionDetails(${session.session_id})">
                                 Details
                            </button>
                            ${session.status === 'completed' ? `
                                <button class="btn btn-info" onclick="submitFeedback(${session.session_id})">
                                     Feedback
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            sessionsContainer.innerHTML = sessionsHTML;
        }
        
        // Authentication functions
        async function loginUser(email, password) {
            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.access_token;
                    currentUser = data.user;
                    
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    updateUIForAuthenticatedUser();
                showDashboard();
                    showMessage('Login successful!', 'success');
                } else {
                    const errorData = await response.json();
                    showMessage(errorData.detail || 'Login failed', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage('Login failed. Please try again.', 'error');
            }
        }
        
        async function registerUser(userData) {
            try {
                const response = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.access_token;
                    currentUser = data.user;
                    
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    updateUIForAuthenticatedUser();
                showDashboard();
                    showMessage('Registration successful!', 'success');
                } else {
                    const errorData = await response.json();
                    showMessage(errorData.detail || 'Registration failed', 'error');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showMessage('Registration failed. Please try again.', 'error');
            }
        }
        
        // Helper function to check if user is authenticated
        function isAuthenticated() {
            return currentUser && authToken;
        }
        
        // Helper function to handle API errors
        function handleApiError(response, defaultMessage) {
            if (response.status === 401) {
                // Handle unauthorized
                logout();
                return false;
            } else if (response.status >= 400) {
                // Handle other errors
                response.json().then(data => {
                    showMessage(data.detail || defaultMessage, 'error');
                }).catch(() => {
                    showMessage(defaultMessage, 'error');
                });
                return false;
            }
            return true;
        }
        
        // Profile Management Functions
        async function createLearnerProfile(profileData) {
            try {
                const response = await apiCall('/api/profiles/learner', {
                    method: 'POST',
                    body: JSON.stringify(profileData)
                });
                
                if (response.ok) {
                    showMessage('Learner profile created successfully!', 'success');
                    loadDashboard();
                } else {
                    const errorData = await response.json();
                    showMessage(errorData.detail || 'Failed to create profile', 'error');
                }
            } catch (error) {
                console.error('Profile creation error:', error);
                showMessage('Failed to create profile', 'error');
            }
        }
        
        async function createTutorProfile(profileData) {
            try {
                const response = await apiCall('/api/profiles/tutor', {
                    method: 'POST',
                    body: JSON.stringify(profileData)
                });
                
                if (response.ok) {
                    showMessage('Tutor profile created successfully!', 'success');
                    loadDashboard();
                } else {
                    const errorData = await response.json();
                    showMessage(errorData.detail || 'Failed to create profile', 'error');
                }
            } catch (error) {
                console.error('Profile creation error:', error);
                showMessage('Failed to create profile', 'error');
            }
        }
        
        // ML Prediction Functions
        async function predictTutorMatch(learnerFeatures) {
            try {
                const response = await apiCall('/api/ml/predict/tutor-match', {
                    method: 'POST',
                    body: JSON.stringify(learnerFeatures)
                });
                if (!response.ok) return null;
                return await response.json();
            } catch (_) { return null; }
        }

        async function predictDifficulty(learnerFeatures) {
            try {
                const response = await apiCall('/api/ml/predict/difficulty', {
                    method: 'POST',
                    body: JSON.stringify(learnerFeatures)
                });
                if (!response.ok) return null;
                return await response.json();
            } catch (_) { return null; }
        }

        async function predictCompatibility(learnerFeatures, tutorFeatures) {
            try {
                const response = await apiCall('/api/ml/predict/compatibility', {
                    method: 'POST',
                    body: JSON.stringify({ learner_features: learnerFeatures, tutor_features: tutorFeatures })
                });
                if (!response.ok) return null;
                return await response.json();
            } catch (_) { return null; }
        }

        async function predictEngagement(sessionFeatures) {
            try {
                const response = await apiCall('/api/ml/predict/engagement', {
                    method: 'POST',
                    body: JSON.stringify(sessionFeatures)
                });
                if (!response.ok) return null;
                return await response.json();
            } catch (_) { return null; }
        }

        // Session Management Functions
        let bookingContext = { tutor: null };
        async function bookSession(tutorId) {
            if (!currentUser) { showMessage('Please login to book sessions', 'error'); return; }
            const tutor = allTutors.find(t => t.id === tutorId);
            if (!tutor) { showMessage('Tutor not found', 'error'); return; }
            bookingContext.tutor = tutor;
            const m = document.getElementById('bookSessionModal');
            if (!m) { showMessage('Booking modal not found', 'error'); return; }
            // Populate tutor details
            document.getElementById('bsTutorName').textContent = tutor.name || 'Tutor';
            document.getElementById('bsTutorRate').textContent = `$${tutor.hourly_rate || 0}/hr`;
            document.getElementById('bsTutorStats').textContent = `${tutor.years_experience||0} yrs  ${tutor.rating||0}/5  ${tutor.total_sessions||0} sessions`;
            const init = (tutor.name||'').split(' ').map(x=>x[0]).join('').slice(0,2).toUpperCase() || 'TN';
            const initEl = document.getElementById('bsInitials'); if (initEl) initEl.textContent = init;
            // Subjects
            const subjSel = document.getElementById('bsSubject');
            const gradeSel = document.getElementById('bsGrade');
            const learnerGroup = document.getElementById('bsLearnerGroup');
            const learnerSel = document.getElementById('bsLearner');
            subjSel.innerHTML = '';
            gradeSel.innerHTML = '<option value="">Select grade</option>';
            const subjectsMap = tutor.subjects_offered || {};
            const subjects = Object.keys(subjectsMap);
            if (subjects.length) {
                subjects.forEach(s=>{ const o=document.createElement('option'); o.value=s; o.textContent=s; subjSel.appendChild(o); });
            } else {
                const o=document.createElement('option'); o.value='General'; o.textContent='General'; subjSel.appendChild(o);
            }
            const refreshGrades = () => {
                const sel = subjSel.value;
                const levels = Array.isArray(subjectsMap[sel]) ? subjectsMap[sel] : [];
                gradeSel.innerHTML = '<option value="">'+(levels.length? 'Select grade' : 'Not specified')+'</option>';
                levels.forEach(g=>{ const og=document.createElement('option'); og.value=g; og.textContent=g; gradeSel.appendChild(og); });
                gradeSel.disabled = levels.length === 0;
            };
            subjSel.onchange = refreshGrades;
            refreshGrades();
            // Populate learner selector for parents
            if (currentUser && currentUser.role === 'parent') {
                learnerGroup.style.display = '';
                try {
                    const res = await apiCall('/api/parent/linked-learners');
                    learnerSel.innerHTML = '<option value="">Select child</option>';
                    if (res.ok) {
                        const data = await res.json();
                        const list = data.linked_learners || [];
                        list.forEach(item=>{
                            const isObj = item && typeof item === 'object';
                            const id = isObj ? (item.id || item.learner_id || item.user_id) : undefined;
                            const email = isObj ? (item.email || item.learner_email) : item;
                            const label = isObj ? (item.name ? `${item.name} (${email||id||''})` : (email||id)) : item;
                            const val = id ? `id:${id}` : (email ? `email:${email}` : String(item));
                            const o=document.createElement('option'); o.value=val; o.textContent=label; learnerSel.appendChild(o);
                        });
                    }
                } catch {}
            } else {
                learnerGroup.style.display = 'none';
            }
            // Defaults and constraints
            const dateEl = document.getElementById('bsDate');
            const timeEl = document.getElementById('bsTime');
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth()+1).padStart(2,'0');
            const dd = String(today.getDate()).padStart(2,'0');
            const minDate = `${yyyy}-${mm}-${dd}`;
            dateEl.min = minDate;
            dateEl.value = '';
            timeEl.step = 900; // 15 min increments
            timeEl.value = '';
            document.getElementById('bsDuration').value = '60';
            document.getElementById('bsNotes').value = '';
            // Wire duration chips for highlighting
            document.querySelectorAll('.duration-chip').forEach(ch => {
                ch.onclick = ()=>{
                    const v = ch.getAttribute('data-val');
                    const sel = document.getElementById('bsDuration');
                    sel.value = v;
                    document.querySelectorAll('.duration-chip').forEach(x=>x.classList.remove('active'));
                    ch.classList.add('active');
                };
            });
            m.classList.add('active');
        }
        
        // Feedback Functions
        async function submitFeedback(sessionId, feedbackData) {
            try {
                const response = await apiCall('/api/feedback', {
                    method: 'POST',
                    body: JSON.stringify({
                        session_id: sessionId,
                        ...feedbackData
                    })
                });
                
                if (response.ok) {
                    showMessage('Feedback submitted successfully!', 'success');
                } else {
                    const errorData = await response.json();
                    showMessage(errorData.detail || 'Failed to submit feedback', 'error');
                }
            } catch (error) {
                console.error('Feedback error:', error);
                showMessage('Failed to submit feedback', 'error');
            }
        }
        
        function viewTutorProfile(tutorId) {
            // Find the tutor in the current tutors list
            const tutor = allTutors.find(t => t.id === tutorId);
            if (!tutor) {
                showMessage('Tutor not found', 'error');
                return;
            }
            
            // Create a detailed tutor profile modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content tutor-profile-modal">
                    <div class="modal-header">
                        <h2>Tutor Profile</h2>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="tutor-profile-header">
                            <div class="tutor-avatar-large">
                                <span>${getInitials(tutor.name)}</span>
                            </div>
                            <div class="tutor-info-large">
                                <h3>${tutor.name}</h3>
                                <div class="tutor-rating">
                                    <div class="stars">
                                        ${''.repeat(Math.floor(tutor.rating))}${''.repeat(5 - Math.floor(tutor.rating))}
                                    </div>
                                    <span class="rating-text">${tutor.rating}/5 (${tutor.total_sessions} sessions)</span>
                                </div>
                                <p class="tutor-region"><i class="fas fa-map-marker-alt"></i> ${tutor.region}</p>
                            </div>
                        </div>
                        
                        <div class="tutor-details">
                            <div class="detail-section">
                                <h4><i class="fas fa-graduation-cap"></i> Experience & Education</h4>
                                <p><strong>Years of Experience:</strong> ${tutor.years_experience} years</p>
                                <p><strong>Teaching Style:</strong> ${tutor.teaching_style || 'Not specified'}</p>
                                <p><strong>Effectiveness Score:</strong> ${tutor.teaching_effectiveness_score || 'N/A'}/10</p>
                            </div>
                            
                            <div class="detail-section">
                                <h4><i class="fas fa-book"></i> Subjects Offered</h4>
                                <div class="subjects-list">
                                    ${Object.entries(tutor.subjects_offered || {}).map(([subject, grades]) => 
                                        `<div class="subject-item">
                                            <strong>${subject}</strong>
                                            <span class="grades">${Array.isArray(grades) ? grades.join(', ') : grades}</span>
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4><i class="fas fa-language"></i> Languages</h4>
                                <div class="languages-list">
                                    ${(tutor.languages_spoken || []).map(lang => 
                                        `<span class="language-tag">${lang}</span>`
                                    ).join('')}
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4><i class="fas fa-info-circle"></i> About</h4>
                                <p class="tutor-bio">${tutor.bio || 'No bio available'}</p>
                            </div>
                            
                            <div class="detail-section">
                                <h4><i class="fas fa-dollar-sign"></i> Pricing</h4>
                                <p class="hourly-rate">$${tutor.hourly_rate || 'N/A'}/hour</p>
                            </div>
                            
                            ${tutor.compatibility_score ? `
                            <div class="detail-section">
                                <h4><i class="fas fa-heart"></i> Compatibility</h4>
                                <div class="compatibility-score">
                                    <div class="score-bar">
                                        <div class="score-fill" style="width: ${tutor.compatibility_score * 100}%"></div>
                                    </div>
                                    <span class="score-text">${Math.round(tutor.compatibility_score * 100)}% match</span>
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="tutor-actions">
                            <button class="btn btn-primary" onclick="requestSession(${tutor.id})">
                                <i class="fas fa-calendar-plus"></i> Request Session
                            </button>
                            <button class="btn btn-outline" onclick="sendMessage(${tutor.id})">
                                <i class="fas fa-message"></i> Send Message
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add styles for the modal
            const style = document.createElement('style');
            style.textContent = `
                .tutor-profile-modal {
                    max-width: 800px;
                    max-height: 90vh;
                    overflow-y: auto;
                }
                .tutor-profile-header {
                    display: flex;
                    align-items: center;
                    margin-bottom: 2rem;
                    padding-bottom: 1rem;
                    border-bottom: 2px solid #e0e0e0;
                }
                .tutor-avatar-large {
                    width: 80px;
                    height: 80px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: 2rem;
                    font-weight: bold;
                    margin-right: 1.5rem;
                }
                .tutor-info-large h3 {
                    margin: 0 0 0.5rem 0;
                    color: #333;
                }
                .tutor-rating {
                    display: flex;
                    align-items: center;
                    margin-bottom: 0.5rem;
                }
                .stars {
                    color: #ffd700;
                    margin-right: 0.5rem;
                }
                .rating-text {
                    color: #666;
                    font-size: 0.9rem;
                }
                .tutor-region {
                    color: #666;
                    margin: 0;
                }
                .detail-section {
                    margin-bottom: 1.5rem;
                }
                .detail-section h4 {
                    color: #333;
                    margin-bottom: 0.5rem;
                    display: flex;
                    align-items: center;
                }
                .detail-section h4 i {
                    margin-right: 0.5rem;
                    color: #667eea;
                }
                .subjects-list {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 0.5rem;
                }
                .subject-item {
                    background: #f8f9fa;
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    border: 1px solid #e0e0e0;
                }
                .subject-item strong {
                    display: block;
                    color: #333;
                }
                .grades {
                    font-size: 0.8rem;
                    color: #666;
                }
                .languages-list {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 0.5rem;
                }
                .language-tag {
                    background: #667eea;
                    color: white;
                    padding: 0.3rem 0.8rem;
                    border-radius: 15px;
                    font-size: 0.8rem;
                }
                .tutor-bio {
                    background: #f8f9fa;
                    padding: 1rem;
                    border-radius: 8px;
                    border-left: 4px solid #667eea;
                    margin: 0;
                }
                .hourly-rate {
                    font-size: 1.5rem;
                    font-weight: bold;
                    color: #28a745;
                    margin: 0;
                }
                .compatibility-score {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }
                .score-bar {
                    flex: 1;
                    height: 20px;
                    background: #e0e0e0;
                    border-radius: 10px;
                    overflow: hidden;
                }
                .score-fill {
                    height: 100%;
                    background: linear-gradient(90deg, #28a745, #20c997);
                    transition: width 0.3s ease;
                }
                .score-text {
                    font-weight: bold;
                    color: #333;
                }
                .tutor-actions {
                    display: flex;
                    gap: 1rem;
                    margin-top: 2rem;
                    padding-top: 1rem;
                    border-top: 2px solid #e0e0e0;
                }
                .tutor-actions .btn {
                    flex: 1;
                }
            `;
            document.head.appendChild(style);
        }
        
        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }
        
        function requestSession(tutorId) {
            showMessage('Session request feature coming soon!', 'info');
            closeModal();
        }
        
        function sendMessage(tutorId) {
            showMessage('Messaging feature coming soon!', 'info');
            closeModal();
        }
        
        function joinSession(sessionId) {
            showMessage('Join session feature coming soon!', 'info');
        }
        
        async function demoML() {
            if (!currentUser) {
                showMessage('Please login first', 'error');
                return;
            }
            try {
            const learnerFeatures = {
                age: 15,
                grade_level: 9,
                comfort_level: 4,
                session_count: 12,
                learning_progress: 0.7,
                subject_preference: 3,
                learning_style: 2,
                time_preference: 1
            };
            
                const [tm, diff, eng] = await Promise.all([
                    predictTutorMatch(learnerFeatures),
                    predictDifficulty(learnerFeatures),
                    predictEngagement({
                        learner_age: 15,
                        comfort_level: 4,
                        attention_span: 30,
                        duration_hours: 1,
                        difficulty: 1,
                        learning_progress: 0.7
                    })
                ]);

                const parts = [];
                if (tm && tm.strategy) parts.push(`Tutor Strategy: ${tm.strategy}`);
                if (diff && diff.difficulty) parts.push(`Difficulty: ${diff.difficulty}`);
                if (eng && typeof eng.predicted_engagement !== 'undefined') parts.push(`Engagement: ${eng.predicted_engagement.toFixed(2)}`);
                showMessage(parts.join(' | ') || 'ML demo executed', 'success');
            } catch (e) {
                showMessage('ML demo failed', 'error');
            }
        }

        async function startSession(sessionId) {
            try {
                const response = await apiCall(`/api/sessions/${sessionId}/status`, {
                    method: 'PUT',
                    body: JSON.stringify({ status: 'in_progress' })
                });
                
                if (response.ok) {
                    showMessage('Session started successfully!', 'success');
                    loadSessions();
                } else {
                    const errorData = await response.json();
                    showMessage(errorData.detail || 'Failed to start session', 'error');
                }
            } catch (error) {
                console.error('Error starting session:', error);
                showMessage('Failed to start session', 'error');
            }
        }
        
        async function completeSession(sessionId) {
            try {
                const response = await apiCall(`/api/sessions/${sessionId}/status`, {
                    method: 'PUT',
                    body: JSON.stringify({ status: 'completed' })
                });
                
                if (response.ok) {
                    showMessage('Session completed successfully!', 'success');
                    loadSessions();
                } else {
                    const errorData = await response.json();
                    showMessage(errorData.detail || 'Failed to complete session', 'error');
                }
            } catch (error) {
                console.error('Error completing session:', error);
                showMessage('Failed to complete session', 'error');
            }
        }
        
        function viewSessionDetails(sessionId) {
            showMessage('Session details feature coming soon!', 'info');
        }
        
        // Start the app
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>

    <div id="googleAuthBar" style="display:none;position:fixed;right:16px;bottom:16px;z-index:2000;">
        <div id="googleSignInBtn"></div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
    (function(){
        async function initGoogle(){
            try{
                const token = localStorage.getItem('aura_token');
                if (!window.google) return;
                const cfgRes = await fetch('/api/config');
                const cfg = cfgRes.ok ? await cfgRes.json() : {};
                const clientId = cfg.googleClientId || '';
                if (!clientId) return;
                google.accounts.id.initialize({
                    client_id: clientId,
                    callback: async ({credential}) => {
                        try{
                            const r = await fetch('/api/auth/google',{
                                method:'POST', headers:{'Content-Type':'application/json'},
                                body: JSON.stringify({credential})
                            });
                            if(r.ok){
                                const data = await r.json();
                                localStorage.setItem('aura_token', data.access_token);
                                document.getElementById('googleAuthBar').style.display='none';
                                location.reload();
                            }
                        }catch(e){ console.error(e); }
                    }
                });
                google.accounts.id.renderButton(document.getElementById('googleSignInBtn'),{theme:'filled_blue',size:'large',shape:'pill',text:'continue_with'});
                var gl=document.getElementById('googleLoginBtn'); if(gl){ google.accounts.id.renderButton(gl,{theme:'outline',size:'large',shape:'pill',text:'continue_with',logo_alignment:'left'}); }
                var gr=document.getElementById('googleRegisterBtn'); if(gr){ google.accounts.id.renderButton(gr,{theme:'outline',size:'large',shape:'pill',text:'signup_with',logo_alignment:'left'}); }
                if(!(token && token.length>0)) { document.getElementById('googleAuthBar').style.display='block'; }
            }catch(e){ console.error('Google init error', e); }
        }
        window.addEventListener('DOMContentLoaded', initGoogle);
    })();
    </script>
    <script>
    (function(){
        // augment wizard submit to create parent profile
        const wf = document.getElementById('wizardForm');
        if(wf){
            const orig = wf.onsubmit; // not used since we used addEventListener earlier
        }
    })();
    </script>
    <script>
    (function(){
        // extend showDashboard for parent data
        const _origShowDash = window.showDashboard;
        window.showDashboard = async function(){
            await _origShowDash();
            const token = localStorage.getItem('aura_token');
            if(!token) return;
            const auth = { 'Authorization':'Bearer '+token, 'Content-Type':'application/json' };
            const me = await fetch('/api/users/me',{headers:auth}).then(r=>r.ok?r.json():null).catch(()=>null);
            if(!me || me.role!=='parent') return;
            // Ensure parent profile exists (lightweight create if missing and consent checked in wizard)
            try {
                // Try to get dashboard; if 403, skip
                const dash = await fetch('/api/dashboard/parent',{headers:auth}).then(r=>r.ok?r.json():null).catch(()=>null);
                if(dash){
                    document.getElementById('parentChildren').textContent = `${dash.total_children} linked`;
                    if (dash.children && dash.children.length){
                        const next = dash.children[0].sessions?.find(s=>s.status==='scheduled');
                        document.getElementById('parentNext').textContent = next? `${next.subject}  ${new Date(next.start).toLocaleString()}` : 'No upcoming session';
                    }
                }
            } catch {}
        }
    })();
    </script>
</body>
</html>